<div class="frente-edit-container">
  <mat-card class="frente-edit-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>edit_location</mat-icon>
        Editar Frente
      </mat-card-title>
      <mat-card-subtitle *ngIf="frente">
        Modificando: {{ frente.nombre }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="frenteForm" (ngSubmit)="onSubmit()" class="frente-form">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nombre del Frente</mat-label>
            <input matInput formControlName="nombre" placeholder="Ej: Frente Norte">
            <mat-icon matSuffix>label</mat-icon>
            <mat-error *ngIf="frenteForm.get('nombre')?.invalid && frenteForm.get('nombre')?.touched">
              {{ getErrorMessage('nombre') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descripción</mat-label>
            <textarea matInput formControlName="descripcion" rows="3" 
                      placeholder="Descripción detallada del frente de trabajo"></textarea>
            <mat-icon matSuffix>description</mat-icon>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Obra</mat-label>
            <mat-select formControlName="obra_id">
              <mat-option *ngFor="let obra of obras" [value]="obra.id">
                {{ obra.nombre }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>business</mat-icon>
            <mat-error *ngIf="frenteForm.get('obra_id')?.invalid && frenteForm.get('obra_id')?.touched">
              {{ getErrorMessage('obra_id') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="estado">
              <mat-option *ngFor="let estado of estadosFrente" [value]="estado.value">
                {{ estado.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>flag</mat-icon>
            <mat-error *ngIf="frenteForm.get('estado')?.invalid && frenteForm.get('estado')?.touched">
              {{ getErrorMessage('estado') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Fecha de Inicio</mat-label>
            <input matInput [matDatepicker]="startPicker" formControlName="fecha_inicio">
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
            <mat-error *ngIf="frenteForm.get('fecha_inicio')?.invalid && frenteForm.get('fecha_inicio')?.touched">
              {{ getErrorMessage('fecha_inicio') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Fecha Fin Estimada</mat-label>
            <input matInput [matDatepicker]="endPicker" formControlName="fecha_fin_estimada">
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Latitud</mat-label>
            <input matInput type="number" formControlName="ubicacion_lat" 
                   placeholder="Ej: 4.5709" step="0.000001">
            <mat-icon matSuffix>place</mat-icon>
            <mat-error *ngIf="frenteForm.get('ubicacion_lat')?.invalid && frenteForm.get('ubicacion_lat')?.touched">
              {{ getErrorMessage('ubicacion_lat') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Longitud</mat-label>
            <input matInput type="number" formControlName="ubicacion_lng" 
                   placeholder="Ej: -74.2973" step="0.000001">
            <mat-icon matSuffix>place</mat-icon>
            <mat-error *ngIf="frenteForm.get('ubicacion_lng')?.invalid && frenteForm.get('ubicacion_lng')?.touched">
              {{ getErrorMessage('ubicacion_lng') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Progreso General (%)</mat-label>
            <input matInput type="number" formControlName="progreso_general" 
                   placeholder="0-100" min="0" max="100">
            <mat-icon matSuffix>trending_up</mat-icon>
            <mat-error *ngIf="frenteForm.get('progreso_general')?.invalid && frenteForm.get('progreso_general')?.touched">
              {{ getErrorMessage('progreso_general') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>straighten</mat-icon>
            Información Kilométrica
          </h3>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Kilómetro Inicial</mat-label>
              <input matInput type="number" formControlName="km_inicial" 
                     placeholder="Ej: 0.0" step="0.1" min="0">
              <mat-icon matSuffix>start</mat-icon>
              <mat-error *ngIf="frenteForm.get('km_inicial')?.invalid && frenteForm.get('km_inicial')?.touched">
                {{ getErrorMessage('km_inicial') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Kilómetro Final</mat-label>
              <input matInput type="number" formControlName="km_final" 
                     placeholder="Ej: 5.0" step="0.1" min="0">
              <mat-icon matSuffix>flag</mat-icon>
              <mat-error *ngIf="frenteForm.get('km_final')?.invalid && frenteForm.get('km_final')?.touched">
                {{ getErrorMessage('km_final') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Coordenadas de Inicio</mat-label>
              <input matInput formControlName="coordenadas_inicio" 
                     placeholder="Ej: -74.2973,4.5709">
              <mat-icon matSuffix>my_location</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Coordenadas de Fin</mat-label>
              <input matInput formControlName="coordenadas_fin" 
                     placeholder="Ej: -74.2980,4.5715">
              <mat-icon matSuffix>location_on</mat-icon>
            </mat-form-field>
          </div>
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button type="button" (click)="onCancel()" [disabled]="loading">
        <mat-icon>cancel</mat-icon>
        Cancelar
      </button>
      <button mat-raised-button color="primary" (click)="onSubmit()" 
              [disabled]="loading || frenteForm.invalid">
        <mat-icon>save</mat-icon>
        {{ loading ? 'Guardando...' : 'Actualizar Frente' }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>