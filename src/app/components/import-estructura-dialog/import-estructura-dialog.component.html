<div class="import-dialog">
  <h2 mat-dialog-title class="text-xl font-semibold text-gray-800 mb-4">
    <mat-icon class="mr-2 text-bitepoint-teal">upload</mat-icon>
    Importar Partidas de Estructura
  </h2>

  <mat-dialog-content class="min-h-[300px]">
    <!-- Estado inicial -->
    <div *ngIf="!importing && !completed" class="text-center py-8">
      <mat-icon class="text-6xl text-bitepoint-teal mb-4">construction</mat-icon>
      <h3 class="text-lg font-medium text-gray-800 mb-2">¿Importar partidas de estructura?</h3>
      <p class="text-gray-600 mb-4">
        Se importarán {{totalPartidas}} partidas desde el archivo partestr.txt
      </p>
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
        <div class="flex items-start">
          <mat-icon class="text-blue-600 mr-2 mt-1">info</mat-icon>
          <div class="text-sm text-blue-800">
            <p class="font-medium mb-1">Información importante:</p>
            <ul class="list-disc list-inside space-y-1">
              <li>Las partidas se agregarán a la especialidad "Estructura"</li>
              <li>Se procesarán códigos, descripciones, unidades y materiales</li>
              <li>El proceso puede tomar unos minutos</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado de importación -->
    <div *ngIf="importing" class="text-center py-8">
      <mat-spinner class="mx-auto mb-4" aria-label="Importando partidas de estructura"></mat-spinner>
      <h3 class="text-lg font-medium text-gray-800 mb-2">Importando partidas...</h3>
      <p class="text-gray-600 mb-4">{{currentMessage}}</p>
      
      <!-- Barra de progreso -->
      <div class="w-full bg-gray-200 rounded-full h-2 mb-4" role="progressbar" [attr.aria-valuenow]="progress" aria-valuemin="0" aria-valuemax="100" [attr.aria-label]="'Progreso de importación: ' + progress + '%'">
        <div class="bg-bitepoint-teal h-2 rounded-full transition-all duration-300" 
             [style.width.%]="progress"></div>
      </div>
      <p class="text-sm text-gray-500">{{processedCount}} de {{totalPartidas}} partidas procesadas</p>
    </div>

    <!-- Estado completado -->
    <div *ngIf="completed" class="text-center py-8">
      <div *ngIf="importResult.success" class="text-center">
        <mat-icon class="text-6xl text-green-600 mb-4">check_circle</mat-icon>
        <h3 class="text-lg font-medium text-gray-800 mb-2">¡Importación completada!</h3>
        <p class="text-gray-600 mb-4">
          Se importaron exitosamente {{importResult.importedCount}} partidas de estructura
        </p>
        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
          <div class="flex items-center justify-center">
            <mat-icon class="text-green-600 mr-2">done</mat-icon>
            <span class="text-sm text-green-800 font-medium">
              Las partidas están disponibles en la pestaña "Estructura"
            </span>
          </div>
        </div>
      </div>

      <div *ngIf="!importResult.success" class="text-center">
        <mat-icon class="text-6xl text-red-600 mb-4">error</mat-icon>
        <h3 class="text-lg font-medium text-gray-800 mb-2">Error en la importación</h3>
        <p class="text-gray-600 mb-4">{{importResult.error}}</p>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <div class="flex items-start">
            <mat-icon class="text-red-600 mr-2 mt-1">warning</mat-icon>
            <div class="text-sm text-red-800">
              <p class="font-medium mb-1">Posibles soluciones:</p>
              <ul class="list-disc list-inside space-y-1">
                <li>Verificar que el archivo partestr.txt existe</li>
                <li>Comprobar la conexión a la base de datos</li>
                <li>Intentar nuevamente</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions class="flex justify-end space-x-3 p-6 border-t">
    <button *ngIf="!importing && !completed" 
            mat-button 
            (click)="onCancel()" 
            class="text-gray-600 hover:text-gray-800">
      Cancelar
    </button>
    
    <button *ngIf="!importing && !completed" 
            mat-raised-button 
            color="primary" 
            (click)="startImport()" 
            class="bg-bitepoint-teal hover:bg-bitepoint-teal-dark">
      <mat-icon class="mr-2">upload</mat-icon>
      Importar Partidas
    </button>

    <button *ngIf="completed" 
            mat-raised-button 
            color="primary" 
            (click)="onClose()" 
            class="bg-bitepoint-teal hover:bg-bitepoint-teal-dark">
      <mat-icon class="mr-2">done</mat-icon>
      Cerrar
    </button>
  </mat-dialog-actions>
</div>