import{c as Ie}from"./chunk-T2B3FFAI.js";import{a as Pe}from"./chunk-4W4CX7QI.js";import{h as we}from"./chunk-BRP3ETBH.js";import{a as xe,b as he}from"./chunk-ZOXEDHNH.js";import{d as fe}from"./chunk-ZBUPANVT.js";import"./chunk-F5X5MWHG.js";import{a as Oe}from"./chunk-6YTEXIFY.js";import{a as Ce,b as Me}from"./chunk-WI2E4B7N.js";import{a as ye,b as Ee}from"./chunk-ETWKG4WA.js";import"./chunk-CSWWTQFU.js";import{a as be}from"./chunk-IMDEVWQ5.js";import{a as ue,b as _e}from"./chunk-MVE6Y23E.js";import"./chunk-GOBT7UBB.js";import{a as ge,b as ve}from"./chunk-AZ2U4T3U.js";import"./chunk-SGYCFQGT.js";import"./chunk-2GVF4P32.js";import"./chunk-WFXXN3GR.js";import{a as pe,b as me}from"./chunk-YC5WDUOT.js";import{a as W,c as X}from"./chunk-YMTLAEZG.js";import"./chunk-G7YPFBNB.js";import{a as G,b as J,c as K,d as Y,f as Z,h as ee}from"./chunk-SNSQLCH6.js";import{b as ae,c as re}from"./chunk-BXKJ5BTH.js";import"./chunk-3RK6DDJD.js";import{F as ie,G as ne,w as q,y as te}from"./chunk-UJ3DDJ5Q.js";import{h as L,i as R,j,m as N,n as Q,p as H,sa as oe,ua as se,va as de,wa as ce,xa as le}from"./chunk-4WMI5X77.js";import{Cb as B,Cc as $,Db as c,Eb as T,Fb as D,Nb as n,Ob as i,Pb as M,Tb as C,X as S,Xb as u,Yb as l,bb as k,db as o,f as F,gc as U,hc as s,ib as P,ic as h,jc as f,kc as A,o as z,pa as g,pb as V,qa as v,uc as w,vb as _,vc as E,wc as O}from"./chunk-B6672ACT.js";import"./chunk-X5YLR3NI.js";import{i as x}from"./chunk-ODN5LVDJ.js";function Se(r,p){r&1&&(n(0,"div",6)(1,"mat-card")(2,"mat-card-content")(3,"p"),s(4,"Cargando actividad..."),i()()()())}function ke(r,p){if(r&1&&(n(0,"div",12)(1,"mat-icon"),s(2,"event"),i(),n(3,"span"),s(4),w(5,"date"),i()()),r&2){let e=l(2);o(4),h(O(5,1,e.actividad.fecha,"dd/MM/yyyy"))}}function Te(r,p){if(r&1&&(n(0,"div",37)(1,"mat-icon"),s(2,"info"),i(),n(3,"p"),s(4,"No hay tareas definidas para esta actividad"),i(),n(5,"p",38),s(6),i()()),r&2){let e=l(3);o(6),f("Actividad ID: ",e.actividadId,"")}}function De(r,p){if(r&1&&(n(0,"p",47),s(1),i()),r&2){let e=l().$implicit;o(),f(" ",e.descripcion," ")}}function Ae(r,p){if(r&1&&(n(0,"div",48)(1,"mat-icon"),s(2,"check_circle"),i(),n(3,"span"),s(4),w(5,"date"),i()()),r&2){let e=l().$implicit;o(4),f("Completada el ",O(5,1,e.fecha_completado,"dd/MM/yyyy HH:mm"),"")}}function Fe(r,p){if(r&1){let e=C();n(0,"div",39)(1,"mat-checkbox",40),u("change",function(){let t=g(e).$implicit,d=l(3);return v(d.toggleTareaCompletada(t))}),i(),n(2,"div",41)(3,"div",42)(4,"span",43),s(5),i(),n(6,"span",44),s(7),i()(),_(8,De,2,1,"p",45)(9,Ae,6,4,"div",46),i()()}if(r&2){let e=p.$implicit;o(),c("checked",e.completada)("color","primary"),o(3),D("completed",e.completada),o(),f(" ",e.nombre," "),o(2),f("#",e.orden,""),o(),c("ngIf",e.descripcion),o(),c("ngIf",e.fecha_completado)}}function ze(r,p){if(r&1){let e=C();n(0,"div",32)(1,"div",33)(2,"h3"),s(3,"Tareas y Progreso"),i(),n(4,"button",34),u("click",function(){g(e);let t=l(2);return v(t.refreshTareas())}),n(5,"mat-icon"),s(6,"refresh"),i()()(),_(7,Te,7,1,"div",35)(8,Fe,10,8,"div",36),i()}if(r&2){let e=l(2);o(7),c("ngIf",e.tareas.length===0),o(),c("ngForOf",e.tareas)}}function Ve(r,p){r&1&&(n(0,"div",49)(1,"p"),s(2,"Cargando tareas..."),i()())}function Be(r,p){if(r&1&&M(0,"mat-progress-bar",73),r&2){let e=l().$implicit;c("value",e.progress)}}function Ue(r,p){if(r&1&&(n(0,"div",74)(1,"small"),s(2),i()()),r&2){let e=l().$implicit;o(2),h(e.error)}}function $e(r,p){if(r&1){let e=C();n(0,"button",75),u("click",function(){g(e);let t=l().$implicit,d=l(3);return v(d.removePreviewImage(t.id))}),n(1,"mat-icon"),s(2,"close"),i()()}}function Le(r,p){if(r&1){let e=C();n(0,"button",76),u("click",function(){g(e);let t=l().$implicit,d=l(3);return v(d.retryUpload(t.id))}),n(1,"mat-icon"),s(2,"refresh"),i()()}}function Re(r,p){if(r&1){let e=C();n(0,"button",77),u("click",function(){g(e);let t=l().$implicit,d=l(3);return v(d.uploadSingleImage(t.id))}),n(1,"mat-icon"),s(2,"upload"),i()()}}function je(r,p){if(r&1){let e=C();n(0,"mat-form-field",78)(1,"mat-label"),s(2,"Descripci\xF3n (opcional)"),i(),n(3,"input",79),u("input",function(t){g(e);let d=l().$implicit,m=l(3);return v(m.updatePreviewDescription(d.id,t.target.value))}),i()()}if(r&2){let e=l().$implicit;o(3),c("value",e.descripcion||"")("disabled",e.status==="uploading")}}function Ne(r,p){if(r&1&&(n(0,"div",56)(1,"div",57),M(2,"img",58),n(3,"div",59)(4,"div",60)(5,"mat-icon"),s(6),i(),n(7,"span",61),s(8),i()(),_(9,Be,1,1,"mat-progress-bar",62)(10,Ue,3,1,"div",63),i(),n(11,"div",64),_(12,$e,3,0,"button",65)(13,Le,3,0,"button",66)(14,Re,3,0,"button",67),i()(),n(15,"div",68)(16,"div",69)(17,"span",70),s(18),i(),n(19,"span",71),s(20),i()(),_(21,je,4,2,"mat-form-field",72),i()()),r&2){let e=p.$implicit,a=l(3);B("data-status",e.status),o(2),c("src",e.url,k)("alt",e.file.name),o(),c("ngClass","status-"+e.status),o(2),T("color",a.getStatusColor(e.status)),o(),h(a.getStatusIcon(e.status)),o(2),h(a.getStatusText(e.status)),o(),c("ngIf",e.status==="uploading"&&e.progress!==void 0),o(),c("ngIf",e.status==="error"&&e.error),o(2),c("ngIf",e.status==="pending"||e.status==="error"),o(),c("ngIf",e.status==="error"),o(),c("ngIf",e.status==="pending"),o(4),h(e.file.name),o(2),f("(",(e.file.size/1024/1024).toFixed(2)," MB)"),o(),c("ngIf",e.status!=="success")}}function Qe(r,p){r&1&&M(0,"mat-spinner",80)}function He(r,p){r&1&&(n(0,"mat-icon"),s(1,"upload"),i())}function We(r,p){if(r&1){let e=C();n(0,"div",50)(1,"h4"),s(2),i(),n(3,"div",51),_(4,Ne,22,16,"div",52),i(),n(5,"div",53)(6,"button",27),u("click",function(){g(e);let t=l(2);return v(t.uploadFiles())}),_(7,Qe,1,0,"mat-spinner",54)(8,He,2,0,"mat-icon",5),s(9),i(),n(10,"button",55),u("click",function(){g(e);let t=l(2);return v(t.clearAllPreviews())}),n(11,"mat-icon"),s(12,"clear_all"),i(),s(13," Limpiar Todo "),i()()()}if(r&2){let e=l(2);o(2),A("Im\xE1genes seleccionadas (",e.previewImages.length,"/",e.maxFiles,"):"),o(2),c("ngForOf",e.previewImages),o(2),c("disabled",e.uploadingFile||!e.hasPendingImages()),o(),c("ngIf",e.uploadingFile),o(),c("ngIf",!e.uploadingFile),o(),f(" ",e.uploadingFile?"Subiendo...":"Subir Todas ("+e.getPendingCount()+")"," "),o(),c("disabled",e.uploadingFile)}}function Xe(r,p){r&1&&M(0,"mat-divider")}function qe(r,p){if(r&1){let e=C();n(0,"div",84)(1,"div",85),M(2,"img",86),n(3,"div",87)(4,"button",88),u("click",function(){let t=g(e).$implicit,d=l(3);return v(d.eliminarEvidencia(t))}),n(5,"mat-icon"),s(6,"delete"),i()()()(),n(7,"div",89)(8,"mat-form-field",78)(9,"mat-label"),s(10,"Descripci\xF3n"),i(),n(11,"input",90),u("blur",function(t){let d=g(e).$implicit,m=l(3);return v(m.actualizarDescripcion(d,t.target.value))}),i()(),n(12,"div",91)(13,"small",92)(14,"mat-icon"),s(15,"schedule"),i(),s(16),w(17,"date"),i()()()()}if(r&2){let e=p.$implicit;o(2),c("src",e.url_imagen,k)("alt",e.descripcion||"Evidencia fotogr\xE1fica"),o(9),c("value",e.descripcion||""),o(5),f(" ",O(17,4,e.fecha_subida,"dd/MM/yyyy HH:mm")," ")}}function Ge(r,p){if(r&1&&(n(0,"div",81)(1,"h4"),s(2,"Evidencias Subidas:"),i(),n(3,"div",82),_(4,qe,18,7,"div",83),i()()),r&2){let e=l(2);o(4),c("ngForOf",e.evidencias)}}function Je(r,p){r&1&&(n(0,"div",93),M(1,"mat-spinner",94),n(2,"p"),s(3,"Cargando evidencias..."),i()())}function Ke(r,p){r&1&&(n(0,"div",95)(1,"mat-icon"),s(2,"photo_library"),i(),n(3,"p"),s(4,"No hay evidencias fotogr\xE1ficas subidas"),i(),n(5,"p",96),s(6,"Sube fotos para documentar el progreso de esta actividad"),i()())}function Ye(r,p){if(r&1){let e=C();n(0,"div")(1,"mat-card",7)(2,"mat-card-header")(3,"mat-card-title"),s(4),w(5,"titlecase"),i(),n(6,"mat-card-subtitle")(7,"span",8),s(8),w(9,"titlecase"),i()()(),n(10,"mat-card-content")(11,"p",9),s(12),i(),n(13,"div",10)(14,"div",11)(15,"div",12)(16,"mat-icon"),s(17,"category"),i(),n(18,"span"),s(19),i()(),n(20,"div",12)(21,"mat-icon"),s(22,"flag"),i(),n(23,"span"),s(24),w(25,"titlecase"),i()()(),n(26,"div",11)(27,"div",12)(28,"mat-icon"),s(29,"person"),i(),n(30,"span"),s(31),i()(),_(32,ke,6,4,"div",13),i()()()(),n(33,"mat-card",14)(34,"mat-card-header")(35,"mat-card-title")(36,"mat-icon"),s(37,"assignment"),i(),s(38," Tareas y Progreso "),i(),n(39,"mat-card-subtitle"),s(40),i()(),n(41,"mat-card-content")(42,"div",15)(43,"div",16)(44,"span",17),s(45,"Progreso General"),i(),n(46,"span",18),s(47),i()(),M(48,"mat-progress-bar",19),i(),M(49,"mat-divider"),_(50,ze,9,2,"div",20)(51,Ve,3,0,"div",21),i()(),n(52,"mat-card",22)(53,"mat-card-header")(54,"mat-card-title")(55,"mat-icon"),s(56,"photo_camera"),i(),s(57," Evidencia Fotogr\xE1fica "),i(),n(58,"mat-card-subtitle"),s(59),i()(),n(60,"mat-card-content")(61,"div",23),u("dragover",function(t){g(e);let d=l();return v(d.onDragOver(t))})("dragleave",function(t){g(e);let d=l();return v(d.onDragLeave(t))})("drop",function(t){g(e);let d=l();return v(d.onDrop(t))}),n(62,"div",24)(63,"mat-icon",25),s(64,"cloud_upload"),i(),n(65,"p"),s(66,"Arrastra las im\xE1genes aqu\xED o haz clic para seleccionar"),i(),n(67,"input",26,0),u("change",function(t){g(e);let d=l();return v(d.onFileSelected(t))}),i(),n(69,"button",27),u("click",function(){g(e);let t=U(68);return v(t.click())}),n(70,"mat-icon"),s(71,"add_photo_alternate"),i(),s(72," Seleccionar Fotos "),i()()(),_(73,We,14,8,"div",28)(74,Xe,1,0,"mat-divider",5)(75,Ge,5,1,"div",29)(76,Je,4,0,"div",30)(77,Ke,7,0,"div",31),i()()()}if(r&2){let e=l();o(4),h(E(5,25,e.actividad.tipo_actividad)),o(3),T("background-color",e.getEstadoColor(e.actividad.estado)),o(),f(" ",E(9,27,e.actividad.estado)," "),o(4),h(e.actividad.observaciones),o(7),h(e.actividad.tipo_actividad),o(5),h(E(25,29,e.actividad.tipo_actividad)),o(7),h(e.actividad.responsable),o(),c("ngIf",e.actividad.fecha),o(8),A(" ",e.tareas.length," tarea(s) - ",e.progreso,"% completado "),o(7),f("",e.progreso,"%"),o(),c("value",e.progreso)("color",e.getProgresoColor()),o(2),c("ngIf",!e.loadingTareas),o(),c("ngIf",e.loadingTareas),o(8),f(" ",e.evidencias.length," foto(s) subida(s) "),o(2),D("drag-over",e.dragOver),o(8),c("disabled",e.uploadingFile),o(4),c("ngIf",e.previewImages.length>0),o(),c("ngIf",e.selectedFiles.length>0),o(),c("ngIf",!e.loadingEvidencias&&e.evidencias.length>0),o(),c("ngIf",e.loadingEvidencias),o(),c("ngIf",!e.loadingEvidencias&&e.evidencias.length===0)}}var Ft=(()=>{class r{constructor(e,a,t,d,m,b,y){this.route=e,this.router=a,this.actividadesService=t,this.evidenciaService=d,this.tareasService=m,this.snackBar=b,this.cdr=y,this.destroy$=new F,this.actividadId=null,this.actividad=null,this.tareas=[],this.progreso=0,this.loading=!0,this.loadingTareas=!1,this.evidencias=[],this.loadingEvidencias=!1,this.uploadingFile=!1,this.selectedFiles=[],this.dragOver=!1,this.previewImages=[],this.uploadProgress={},this.maxFiles=10,this.MAX_CONCURRENT_UPLOADS=2,this.currentUploads=0,this.uploadQueue=[],this.uploadLock=!1,this.actividadId=this.route.snapshot.paramMap.get("id")}ngOnInit(){this.route.params.pipe(S(this.destroy$)).subscribe(e=>{this.actividadId=e.id,this.actividadId&&(this.loadActividad(),setTimeout(()=>{this.loadTareas(),this.loadEvidencias()},100),this.subscribeToProgresoUpdates())})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}subscribeToProgresoUpdates(){this.actividadesService.progresoUpdated$.pipe(S(this.destroy$)).subscribe(({actividadId:e,progreso:a})=>{e===this.actividadId&&this.actividad&&(this.actividad.progreso_porcentaje=a,this.progreso=a)})}loadActividad(){return x(this,null,function*(){try{if(this.loading=!0,this.actividad=yield this.actividadesService.getActividadById(this.actividadId),!this.actividad){this.snackBar.open("Actividad no encontrada","Cerrar",{duration:3e3}),this.router.navigate(["/actividades"]);return}}catch{this.snackBar.open("Error cargando actividad","Cerrar",{duration:3e3})}finally{this.loading=!1}})}loadTareas(){return x(this,null,function*(){try{if(this.loadingTareas=!0,!this.actividadId)return;this.tareas=yield this.actividadesService.getTareasByActividad(this.actividadId),this.calcularProgreso()}catch{this.snackBar.open("Error cargando tareas","Cerrar",{duration:3e3})}finally{this.loadingTareas=!1}})}calcularProgreso(){if(this.tareas.length===0){this.progreso=0;return}let e=this.tareas.filter(a=>a.completada).length;this.progreso=Math.round(e/this.tareas.length*100)}toggleTareaCompletada(e){return x(this,null,function*(){let a=e.completada,t=!e.completada;e.completada=t,t?e.fecha_completado=new Date().toISOString():e.fecha_completado=void 0,this.calcularProgreso();try{yield this.actividadesService.updateTareaEstado(e.id,t);let d=t?"Tarea marcada como completada":"Tarea marcada como pendiente";this.snackBar.open(d,"Cerrar",{duration:2e3})}catch{e.completada=a,a?e.fecha_completado=new Date().toISOString():e.fecha_completado=void 0,this.calcularProgreso(),this.snackBar.open("Error actualizando tarea","Cerrar",{duration:3e3})}})}getEstadoColor(e){return{programado:"#2196F3",ejecucion:"#FF9800",finalizado:"#4CAF50",pausado:"#9E9E9E",cancelado:"#F44336"}[e]||"#9E9E9E"}getProgresoColor(){return this.progreso===100?"primary":this.progreso>=50?"accent":"warn"}refreshTareas(){return x(this,null,function*(){yield this.loadTareas()})}loadEvidencias(){return x(this,null,function*(){if(this.actividadId)try{this.loadingEvidencias=!0;let e=yield z(this.evidenciaService.obtenerEvidenciasPorActividad(this.actividadId));e?this.evidencias=e:this.evidencias=[]}catch{this.evidencias=[],this.snackBar.open("Error cargando evidencias fotogr\xE1ficas","Cerrar",{duration:3e3})}finally{this.loadingEvidencias=!1}})}onDragOver(e){e.preventDefault(),this.dragOver=!0}onDragLeave(e){e.preventDefault(),this.dragOver=!1}onDrop(e){e.preventDefault(),this.dragOver=!1;let a=Array.from(e.dataTransfer?.files||[]);this.handleFiles(a)}onFileSelected(e){let a=e.target.files;a&&a.length>0&&this.handleFiles(Array.from(a))}handleFiles(e){if(this.previewImages.length+e.length>this.maxFiles){this.snackBar.open(`M\xE1ximo ${this.maxFiles} archivos permitidos`,"Cerrar",{duration:3e3});return}let t=e.filter(d=>{let m=d.type.startsWith("image/"),b=d.size<=5*1024*1024;return m?b?!0:(this.snackBar.open(`${d.name} es muy grande (m\xE1ximo 5MB)`,"Cerrar",{duration:3e3}),!1):(this.snackBar.open(`${d.name} no es una imagen v\xE1lida`,"Cerrar",{duration:3e3}),!1)});t.forEach(d=>{let m=new FileReader,b=this.generateId();m.onload=y=>{let I={id:b,file:d,url:y.target?.result,status:"pending",descripcion:""};this.previewImages.push(I),this.cdr.detectChanges()},m.onerror=y=>{this.snackBar.open(`Error cargando ${d.name}`,"Cerrar",{duration:3e3})},m.readAsDataURL(d)}),this.selectedFiles=[...this.selectedFiles,...t]}uploadFiles(){return x(this,null,function*(){if(!(!this.actividadId||this.previewImages.length===0||this.uploadLock)){this.uploadingFile=!0,this.uploadLock=!0;try{let e=this.previewImages.filter(t=>t.status==="pending");this.uploadQueue.push(...e),yield this.processUploadQueue(),setTimeout(()=>{this.previewImages=this.previewImages.filter(t=>t.status!=="success"),this.selectedFiles=[]},2e3),yield this.loadEvidencias();let a=e.filter(t=>t.status==="success").length;a>0&&this.snackBar.open(`${a} evidencia(s) subida(s) correctamente`,"Cerrar",{duration:3e3})}finally{this.uploadingFile=!1,this.uploadLock=!1}}})}processUploadQueue(){return x(this,null,function*(){let e=[];for(;this.uploadQueue.length>0&&this.currentUploads<this.MAX_CONCURRENT_UPLOADS;){let a=this.uploadQueue.shift();if(a){this.currentUploads++;let t=this.uploadWithConcurrencyControl(a).finally(()=>{this.currentUploads--});e.push(t)}}e.length>0&&(yield Promise.all(e),this.uploadQueue.length>0&&(yield this.processUploadQueue()))})}uploadWithConcurrencyControl(e){return x(this,null,function*(){try{e.status="uploading",e.progress=0;let a=setInterval(()=>{e.progress<90&&(e.progress+=10)},200),t=this.evidenciaService.subirEvidencia(e.file,this.actividadId,e.descripcion),d=new Promise((m,b)=>{setTimeout(()=>b(new Error("Upload timeout")),3e4)});yield Promise.race([t,d]),clearInterval(a),e.progress=100,e.status="success"}catch(a){e.status="error",e.error=this.getErrorMessage(a)}})}getErrorMessage(e){return e?.message?.includes("timeout")?"Tiempo de espera agotado. Intenta de nuevo.":e?.message?.includes("NavigatorLockAcquireTimeoutError")?"Sistema ocupado. Intenta de nuevo en unos segundos.":e?.message?.includes("Bucket not found")?"Error de configuraci\xF3n. Contacta al administrador.":"Error al subir la imagen. Intenta de nuevo."}removeSelectedFile(e){this.selectedFiles.splice(e,1)}generateId(){return Math.random().toString(36).substr(2,9)}removePreviewImage(e){let a=this.previewImages.findIndex(t=>t.id===e);if(a>-1){let t=this.previewImages[a];t.url.startsWith("blob:")&&URL.revokeObjectURL(t.url),this.previewImages.splice(a,1);let d=this.selectedFiles.findIndex(m=>m.name===t.file.name);d>-1&&this.selectedFiles.splice(d,1),this.cdr.detectChanges()}}updatePreviewDescription(e,a){let t=this.previewImages.find(d=>d.id===e);t&&(t.descripcion=a)}retryUpload(e){let a=this.previewImages.find(t=>t.id===e);a&&a.status==="error"&&(a.status="pending",a.error=void 0,a.progress=0)}uploadSingleImage(e){let a=this.previewImages.find(t=>t.id===e);if(!a||!this.actividadId||this.currentUploads>=this.MAX_CONCURRENT_UPLOADS){this.currentUploads>=this.MAX_CONCURRENT_UPLOADS&&this.snackBar.open("M\xE1ximo de subidas simult\xE1neas alcanzado. Espera un momento.","Cerrar",{duration:3e3});return}this.uploadSinglePreviewImage(a)}uploadSinglePreviewImage(e){return x(this,null,function*(){this.currentUploads++;let a=e.file.name;try{e.status="uploading",e.progress=0;let t=setInterval(()=>{e.progress<90&&(e.progress+=10)},200),d=this.evidenciaService.subirEvidencia(e.file,this.actividadId,e.descripcion),m=new Promise((y,I)=>{setTimeout(()=>I(new Error("Upload timeout")),3e4)}),b=yield Promise.race([d,m]);clearInterval(t),e.progress=100,e.status="success",setTimeout(()=>{this.removePreviewImage(e.id)},2e3),yield this.loadEvidencias(),this.snackBar.open("Evidencia subida correctamente","Cerrar",{duration:2e3})}catch(t){e.status="error",e.error=this.getErrorMessage(t);let d=this.getErrorMessage(t);this.snackBar.open(`Error subiendo "${a}": ${d}`,"Cerrar",{duration:3e3})}finally{this.currentUploads--}})}getStatusIcon(e){switch(e){case"pending":return"schedule";case"uploading":return"cloud_upload";case"success":return"check_circle";case"error":return"error";default:return"help"}}getStatusColor(e){switch(e){case"pending":return"#FF9800";case"uploading":return"#2196F3";case"success":return"#4CAF50";case"error":return"#F44336";default:return"#9E9E9E"}}getStatusText(e){switch(e){case"pending":return"Pendiente";case"uploading":return"Subiendo...";case"success":return"Subida exitosa";case"error":return"Error";default:return"Desconocido"}}hasPendingImages(){return this.previewImages.some(e=>e.status==="pending")}getPendingCount(){return this.previewImages.filter(e=>e.status==="pending").length}clearAllPreviews(){this.previewImages.forEach(e=>{e.url.startsWith("blob:")&&URL.revokeObjectURL(e.url)}),this.previewImages=[],this.selectedFiles=[],this.cdr.detectChanges()}eliminarEvidencia(e){if(!e.id){this.snackBar.open("Error: ID de evidencia no v\xE1lido","Cerrar",{duration:3e3});return}let a=`\xBFEst\xE1s seguro de que deseas eliminar esta evidencia?

Archivo: ${e.nombre_archivo||"Sin nombre"}
Descripci\xF3n: ${e.descripcion||"Sin descripci\xF3n"}`;confirm(a)&&(this.snackBar.open("Eliminando evidencia...","",{duration:1e3}),this.evidenciaService.eliminarEvidencia(e.id).subscribe({next:t=>{t?(this.evidencias=this.evidencias.filter(d=>d.id!==e.id),this.loadEvidencias(),this.snackBar.open("Evidencia eliminada correctamente","Cerrar",{duration:3e3,panelClass:["success-snackbar"]})):this.snackBar.open("Error: La eliminaci\xF3n no fue exitosa","Cerrar",{duration:5e3,panelClass:["error-snackbar"]})},error:t=>{let d="Error eliminando evidencia";t?.message&&(t.message.includes("permission")?d="No tienes permisos para eliminar esta evidencia":t.message.includes("not found")?(d="La evidencia ya no existe",this.evidencias=this.evidencias.filter(m=>m.id!==e.id)):t.message.includes("storage")?d="Error eliminando el archivo. El registro fue eliminado.":d=`Error: ${t.message}`),this.snackBar.open(d,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}}))}actualizarDescripcion(e,a){return x(this,null,function*(){if(e.id)try{yield this.evidenciaService.actualizarEvidencia(e.id,{descripcion:a}),e.descripcion=a,this.snackBar.open("Descripci\xF3n actualizada","Cerrar",{duration:2e3})}catch{this.snackBar.open("Error actualizando descripci\xF3n","Cerrar",{duration:3e3})}})}volver(){this.router.navigate(["/actividades"])}static{this.\u0275fac=function(a){return new(a||r)(P(W),P(X),P(be),P(Pe),P(Oe),P(ge),P($))}}static{this.\u0275cmp=V({type:r,selectors:[["app-detalle-actividad"]],decls:9,vars:2,consts:[["fileInput",""],[1,"detalle-actividad-container"],[1,"header-section"],["mat-icon-button","",1,"back-button",3,"click"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],[1,"activity-info"],[1,"estado-badge"],[1,"description"],[1,"activity-details"],[1,"detail-row"],[1,"detail-item"],["class","detail-item",4,"ngIf"],[1,"tasks-section"],[1,"progress-container"],[1,"progress-info"],[1,"progress-label"],[1,"progress-percentage"],["mode","determinate",3,"value","color"],["class","tasks-list",4,"ngIf"],["class","loading-tasks",4,"ngIf"],[1,"evidence-section"],[1,"upload-zone",3,"dragover","dragleave","drop"],[1,"upload-content"],[1,"upload-icon"],["type","file","multiple","","accept","image/*",2,"display","none",3,"change"],["mat-raised-button","","color","primary",3,"click","disabled"],["class","preview-section",4,"ngIf"],["class","evidence-gallery",4,"ngIf"],["class","loading-evidence",4,"ngIf"],["class","no-evidence",4,"ngIf"],[1,"tasks-list"],[1,"tasks-header"],["mat-icon-button","","title","Refrescar tareas",3,"click"],["class","no-tasks",4,"ngIf"],["class","task-item",4,"ngFor","ngForOf"],[1,"no-tasks"],[1,"debug-info"],[1,"task-item"],[3,"change","checked","color"],[1,"task-content"],[1,"task-header"],[1,"task-name"],[1,"task-order"],["class","task-description",4,"ngIf"],["class","task-meta",4,"ngIf"],[1,"task-description"],[1,"task-meta"],[1,"loading-tasks"],[1,"preview-section"],[1,"preview-grid"],["class","preview-item",4,"ngFor","ngForOf"],[1,"upload-actions"],["diameter","20","style","margin-right: 8px;",4,"ngIf"],["mat-button","",3,"click","disabled"],[1,"preview-item"],[1,"preview-image-container"],[1,"preview-image",3,"src","alt"],[1,"preview-overlay",3,"ngClass"],[1,"status-indicator"],[1,"status-text"],["mode","determinate","class","upload-progress",3,"value",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"preview-actions"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Reintentar",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Subir esta imagen",3,"click",4,"ngIf"],[1,"preview-info"],[1,"file-details"],[1,"file-name"],[1,"file-size"],["appearance","outline","class","description-field",4,"ngIf"],["mode","determinate",1,"upload-progress",3,"value"],[1,"error-message"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-icon-button","","color","primary","matTooltip","Reintentar",3,"click"],["mat-icon-button","","color","primary","matTooltip","Subir esta imagen",3,"click"],["appearance","outline",1,"description-field"],["matInput","","placeholder","Describe esta imagen...",3,"input","value","disabled"],["diameter","20",2,"margin-right","8px"],[1,"evidence-gallery"],[1,"gallery-grid"],["class","evidence-item",4,"ngFor","ngForOf"],[1,"evidence-item"],[1,"image-container"],[1,"evidence-image",3,"src","alt"],[1,"image-overlay"],["mat-icon-button","","color","warn","matTooltip","Eliminar evidencia",3,"click"],[1,"evidence-info"],["matInput","","placeholder","Agregar descripci\xF3n...",3,"blur","value"],[1,"evidence-meta"],[1,"upload-date"],[1,"loading-evidence"],["diameter","40"],[1,"no-evidence"],[1,"hint"]],template:function(a,t){a&1&&(n(0,"div",1)(1,"div",2)(2,"button",3),u("click",function(){return t.volver()}),n(3,"mat-icon"),s(4,"arrow_back"),i()(),n(5,"h1"),s(6,"Detalle de Actividad"),i()(),_(7,Se,5,0,"div",4)(8,Ye,78,31,"div",5),i()),a&2&&(o(7),c("ngIf",t.loading),o(),c("ngIf",!t.loading&&t.actividad))},dependencies:[H,L,R,j,N,Q,ee,G,K,Z,Y,J,de,se,oe,le,ce,Ie,we,xe,fe,Ee,ye,_e,ue,ve,he,me,pe,re,ae,ie,te,ne,Me,Ce,q],styles:['@charset "UTF-8";.detalle-actividad-container[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}.header-section[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px;gap:16px}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500}.back-button[_ngcontent-%COMP%]{color:#666}.activity-info[_ngcontent-%COMP%]{margin-bottom:20px}.estado-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:12px;color:#fff;font-size:12px;font-weight:500;text-transform:uppercase}.description[_ngcontent-%COMP%]{margin:16px 0;color:#666;line-height:1.5}.activity-details[_ngcontent-%COMP%]{margin-top:16px}.detail-row[_ngcontent-%COMP%]{display:flex;gap:32px;margin-bottom:12px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#666}.detail-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.tasks-section[_ngcontent-%COMP%], .progress-container[_ngcontent-%COMP%]{margin-bottom:20px}.progress-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.progress-label[_ngcontent-%COMP%]{font-weight:500;color:#333}.progress-percentage[_ngcontent-%COMP%]{font-weight:600;color:#1976d2}mat-divider[_ngcontent-%COMP%]{margin:20px 0}.tasks-list[_ngcontent-%COMP%]{margin-top:20px}.tasks-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.tasks-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}.no-tasks[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.debug-info[_ngcontent-%COMP%]{font-size:12px;color:#999;margin-top:8px}.no-tasks[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.5}.task-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px;padding:16px 0;border-bottom:1px solid #eee}.task-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.task-content[_ngcontent-%COMP%]{flex:1}.task-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.task-name[_ngcontent-%COMP%]{font-weight:500;color:#333;transition:all .3s ease}.task-name.completed[_ngcontent-%COMP%]{text-decoration:line-through;color:#999}.task-order[_ngcontent-%COMP%]{background:#f5f5f5;padding:2px 8px;border-radius:12px;font-size:12px;color:#666}.task-description[_ngcontent-%COMP%]{margin:8px 0;color:#666;font-size:14px;line-height:1.4}.task-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#4caf50;font-size:12px;margin-top:8px}.task-meta[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.loading-container[_ngcontent-%COMP%], .loading-tasks[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#666}.evidence-section[_ngcontent-%COMP%]{margin-bottom:20px}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:8px;padding:40px 20px;text-align:center;transition:all .3s ease;cursor:pointer;margin-bottom:20px}.upload-zone[_ngcontent-%COMP%]:hover, .upload-zone.drag-over[_ngcontent-%COMP%]{border-color:#1976d2;background-color:#f3f8ff}.upload-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px}.upload-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#666}.upload-zone[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:16px}.selected-files[_ngcontent-%COMP%]{margin-bottom:20px;padding:16px;background-color:#f9f9f9;border-radius:8px}.selected-files[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;font-weight:500}.file-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}.file-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 12px;background-color:#fff;border-radius:6px;border:1px solid #e0e0e0}.file-name[_ngcontent-%COMP%]{flex:1;font-weight:500}.file-size[_ngcontent-%COMP%]{color:#666;font-size:12px}.upload-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.preview-section[_ngcontent-%COMP%]{margin-top:20px}.preview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin:16px 0}.preview-item[_ngcontent-%COMP%]{border:2px solid #e0e0e0;border-radius:8px;overflow:hidden;background:#fff;transition:all .3s ease}.preview-item[data-status=pending][_ngcontent-%COMP%]{border-color:#ff9800}.preview-item[data-status=uploading][_ngcontent-%COMP%]{border-color:#2196f3}.preview-item[data-status=success][_ngcontent-%COMP%]{border-color:#4caf50}.preview-item[data-status=error][_ngcontent-%COMP%]{border-color:#f44336}.preview-image-container[_ngcontent-%COMP%]{position:relative;width:100%;height:150px;overflow:hidden}.preview-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.preview-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000b3;display:flex;flex-direction:column;justify-content:center;align-items:center;opacity:0;transition:opacity .3s ease}.preview-item[_ngcontent-%COMP%]:hover   .preview-overlay[_ngcontent-%COMP%], .preview-overlay.status-uploading[_ngcontent-%COMP%], .preview-overlay.status-error[_ngcontent-%COMP%]{opacity:1}.status-indicator[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;color:#fff}.status-text[_ngcontent-%COMP%]{font-size:12px;font-weight:500}.upload-progress[_ngcontent-%COMP%]{width:80%;margin-top:8px}.error-message[_ngcontent-%COMP%]{color:#ffcdd2;text-align:center;margin-top:8px;padding:0 8px}.preview-actions[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:flex;gap:4px;opacity:0;transition:opacity .3s ease}.preview-item[_ngcontent-%COMP%]:hover   .preview-actions[_ngcontent-%COMP%]{opacity:1}.preview-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#ffffffe6;width:32px;height:32px;min-width:unset}.preview-info[_ngcontent-%COMP%]{padding:12px}.file-details[_ngcontent-%COMP%]{margin-bottom:8px}.file-name[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:14px;color:#333;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-size[_ngcontent-%COMP%]{font-size:12px;color:#666}.description-field[_ngcontent-%COMP%]{width:100%;margin-top:8px}.description-field[_ngcontent-%COMP%]   .mat-mdc-form-field-wrapper[_ngcontent-%COMP%]{padding-bottom:0}@media (max-width: 768px){.preview-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px}.preview-image-container[_ngcontent-%COMP%]{height:120px}.preview-info[_ngcontent-%COMP%]{padding:8px}.upload-actions[_ngcontent-%COMP%]{flex-direction:column}.upload-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}.evidence-gallery[_ngcontent-%COMP%]{margin-top:20px}.evidence-gallery[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;font-weight:500}.gallery-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}.evidence-item[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;overflow:hidden;background-color:#fff}.image-container[_ngcontent-%COMP%]{position:relative;width:100%;height:200px;overflow:hidden}.evidence-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.evidence-image[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.image-overlay[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;opacity:0;transition:opacity .3s ease}.image-container[_ngcontent-%COMP%]:hover   .image-overlay[_ngcontent-%COMP%]{opacity:1}.evidence-info[_ngcontent-%COMP%]{padding:16px}.description-field[_ngcontent-%COMP%]{width:100%;margin-bottom:12px}.evidence-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.upload-date[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:12px}.upload-date[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.loading-evidence[_ngcontent-%COMP%], .no-evidence[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.loading-evidence[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px}.no-evidence[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.5}.no-evidence[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:14px;color:#999;margin-top:8px}@media (max-width: 768px){.detalle-actividad-container[_ngcontent-%COMP%]{padding:16px}.detail-row[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.task-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:8px}.gallery-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.upload-zone[_ngcontent-%COMP%]{padding:20px 16px}.upload-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}']})}}return r})();export{Ft as DetalleActividadComponent};
