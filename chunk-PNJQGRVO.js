import{b as oe}from"./chunk-JK5PCMVN.js";import{a as X,b as Y}from"./chunk-7ORSVDA5.js";import{a as T,b as O,c as B,d as D,e as N,f as z,g as G,h as q}from"./chunk-Q7IKAR2H.js";import"./chunk-MS4AQ6UA.js";import{a as re,b as ne}from"./chunk-4WQTEZOQ.js";import{c as ie}from"./chunk-T4G463S7.js";import{a as te}from"./chunk-4SALBWPR.js";import"./chunk-SGFNFZY3.js";import{a as Z,b as ee}from"./chunk-ZJYJPMQY.js";import{b as H,c as $}from"./chunk-5ME2OED7.js";import{C as L,F as U,G as R,b,d as s,g as E,h as F,l as I,n as y,q as k,v as w,x as V,y as j,z as A}from"./chunk-GGGSXGOB.js";import{j as P,p as S,ra as J,sa as K,ta as Q,ua as W}from"./chunk-MD4YSZKI.js";import{Db as m,Mb as r,Nb as t,Ob as u,Sb as v,Wb as h,Xb as p,db as l,gc as n,ib as x,ic as C,pa as g,pb as M,qa as _,vb as d}from"./chunk-OYRL5FJJ.js";import"./chunk-X5YLR3NI.js";import"./chunk-ODN5LVDJ.js";function ae(i,c){i&1&&(r(0,"div",5),u(1,"mat-spinner",6),r(2,"p"),n(3,"Cargando perfil..."),t()())}function le(i,c){i&1&&(r(0,"mat-error"),n(1," El nombre es requerido "),t())}function me(i,c){i&1&&(r(0,"mat-error"),n(1," El correo es requerido "),t())}function ce(i,c){i&1&&(r(0,"mat-error"),n(1," Ingresa un correo v\xE1lido "),t())}function de(i,c){if(i&1&&(r(0,"div",19)(1,"mat-icon"),n(2,"update"),t(),r(3,"span"),n(4),t()()),i&2){let e=p(3);l(4),C("\xDAltima actualizaci\xF3n: ",e.formatDate(e.currentProfile.updated_at),"")}}function pe(i,c){if(i&1&&(r(0,"div",18)(1,"div",19)(2,"mat-icon"),n(3,"schedule"),t(),r(4,"span"),n(5),t()(),d(6,de,5,1,"div",20),t()),i&2){let e=p(2);l(5),C("Cuenta creada: ",e.formatDate(e.currentProfile.created_at),""),l(),m("ngIf",e.currentProfile.updated_at)}}function se(i,c){if(i&1){let e=v();r(0,"form",7),h("ngSubmit",function(){g(e);let a=p();return _(a.updateProfile())}),r(1,"div",8)(2,"mat-form-field",9)(3,"mat-label"),n(4,"Nombre completo"),t(),u(5,"input",10),r(6,"mat-icon",11),n(7,"person"),t(),d(8,le,2,0,"mat-error",12),t()(),r(9,"div",8)(10,"mat-form-field",9)(11,"mat-label"),n(12,"Correo electr\xF3nico"),t(),u(13,"input",13),r(14,"mat-icon",11),n(15,"email"),t(),d(16,me,2,0,"mat-error",12)(17,ce,2,0,"mat-error",12),t()(),r(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),n(21,"Rol"),t(),r(22,"mat-select",14)(23,"mat-option",15),n(24,"Residente"),t(),r(25,"mat-option",16),n(26,"Log\xEDstica"),t()(),r(27,"mat-icon",11),n(28,"work"),t()()(),d(29,pe,7,2,"div",17),t()}if(i&2){let e,o,a,f=p();m("formGroup",f.profileForm),l(8),m("ngIf",(e=f.profileForm.get("nombre"))==null?null:e.hasError("required")),l(8),m("ngIf",(o=f.profileForm.get("email"))==null?null:o.hasError("required")),l(),m("ngIf",(a=f.profileForm.get("email"))==null?null:a.hasError("email")),l(12),m("ngIf",f.currentProfile)}}function fe(i,c){i&1&&u(0,"mat-spinner",25)}function ue(i,c){i&1&&(r(0,"mat-icon"),n(1,"save"),t())}function ge(i,c){if(i&1){let e=v();r(0,"mat-card-actions",21)(1,"button",22),h("click",function(){g(e);let a=p();return _(a.cancelChanges())}),r(2,"mat-icon"),n(3,"cancel"),t(),n(4," Cancelar "),t(),r(5,"button",23),h("click",function(){g(e);let a=p();return _(a.updateProfile())}),d(6,fe,1,0,"mat-spinner",24)(7,ue,2,0,"mat-icon",12),n(8),t()()}if(i&2){let e=p();l(),m("disabled",e.saving),l(4),m("disabled",!(e.profileForm!=null&&e.profileForm.valid)||e.saving),l(),m("ngIf",e.saving),l(),m("ngIf",!e.saving),l(),C(" ",e.saving?"Guardando...":"Guardar cambios"," ")}}var qe=(()=>{class i{constructor(e,o,a){this.authService=e,this.formBuilder=o,this.snackBar=a,this.profileForm=null,this.currentProfile=null,this.loading=!0,this.saving=!1,this.originalFormValue=null}ngOnInit(){this.loadProfile()}loadProfile(){this.loading=!0,this.authService.currentProfile$.subscribe(e=>{e?(this.currentProfile=e,this.initializeForm(e),this.loading=!1):this.authService.getCurrentUser()?setTimeout(()=>{let a=this.authService.getCurrentProfile();a&&(this.currentProfile=a,this.initializeForm(a)),this.loading=!1},1e3):(this.loading=!1,this.snackBar.open("Error: Usuario no autenticado","Cerrar",{duration:3e3}))})}initializeForm(e){this.profileForm=this.formBuilder.group({nombre:[e.nombre,[s.required,s.minLength(2)]],email:[e.email,[s.required,s.email]],rol:[e.rol,[s.required]]}),this.originalFormValue=this.profileForm.value}updateProfile(){if(!this.profileForm||!this.profileForm.valid){this.snackBar.open("Por favor, completa todos los campos correctamente","Cerrar",{duration:3e3});return}this.saving=!0;let e=this.profileForm.value;this.authService.updateProfile(e).subscribe({next:o=>{o.error?(console.error("Error updating profile:",o.error),this.snackBar.open("Error al actualizar el perfil: "+o.error.message,"Cerrar",{duration:5e3})):(this.snackBar.open("Perfil actualizado correctamente","Cerrar",{duration:3e3}),this.originalFormValue=e),this.saving=!1},error:o=>{console.error("Error updating profile:",o),this.snackBar.open("Error al actualizar el perfil","Cerrar",{duration:3e3}),this.saving=!1}})}cancelChanges(){this.profileForm&&this.originalFormValue&&(this.profileForm.patchValue(this.originalFormValue),this.snackBar.open("Cambios cancelados","Cerrar",{duration:2e3}))}formatDate(e){return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}static{this.\u0275fac=function(o){return new(o||i)(x(te),x(w),x(Z))}}static{this.\u0275cmp=M({type:i,selectors:[["app-perfil"]],decls:14,vars:3,consts:[[1,"perfil-container"],["mat-card-avatar","",1,"profile-avatar"],["class","loading-container",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],["align","end",4,"ngIf"],[1,"loading-container"],["diameter","40"],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","nombre","placeholder","Ingresa tu nombre completo"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","email","type","email","placeholder","correo@ejemplo.com"],["formControlName","rol"],["value","residente"],["value","logistica"],["class","profile-info",4,"ngIf"],[1,"profile-info"],[1,"info-item"],["class","info-item",4,"ngIf"],["align","end"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20","class","button-spinner",4,"ngIf"],["diameter","20",1,"button-spinner"]],template:function(o,a){o&1&&(r(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"div",1)(4,"mat-icon"),n(5,"person"),t()(),r(6,"mat-card-title"),n(7,"Mi Perfil"),t(),r(8,"mat-card-subtitle"),n(9,"Gestiona tu informaci\xF3n personal"),t()(),r(10,"mat-card-content"),d(11,ae,4,0,"div",2)(12,se,30,5,"form",3),t(),d(13,ge,9,5,"mat-card-actions",4),t()()),o&2&&(l(11),m("ngIf",a.loading),l(),m("ngIf",!a.loading&&a.profileForm),l(),m("ngIf",!a.loading))},dependencies:[S,P,V,I,b,E,F,y,k,q,T,N,G,B,z,D,O,K,J,W,Q,oe,R,U,j,A,L,$,H,ne,re,ie,Y,X,ee],styles:[".perfil-container[_ngcontent-%COMP%]{padding:20px;max-width:600px;margin:0 auto}.profile-avatar[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;display:flex;align-items:center;justify-content:center}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:40px 20px;text-align:center}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.form-row[_ngcontent-%COMP%]{margin-bottom:16px}.full-width[_ngcontent-%COMP%]{width:100%}.profile-info[_ngcontent-%COMP%]{margin-top:24px;padding:16px;background-color:#f5f5f5;border-radius:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:8px;color:#666}.info-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.info-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px;width:18px;height:18px}.button-spinner[_ngcontent-%COMP%]{margin-right:8px}mat-card-actions[_ngcontent-%COMP%]{padding:16px 24px}"]})}}return i})();export{qe as PerfilComponent};
