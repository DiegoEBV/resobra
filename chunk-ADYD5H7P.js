import{a as Ce}from"./chunk-AIW24H5D.js";import"./chunk-MS4AQ6UA.js";import{a as he,b as be}from"./chunk-DMZJ7K26.js";import{c as _e}from"./chunk-7BCONPA6.js";import"./chunk-F5X5MWHG.js";import{b as ge}from"./chunk-WI2E4B7N.js";import"./chunk-GOBT7UBB.js";import{a as pe,b as fe}from"./chunk-AZ2U4T3U.js";import"./chunk-SGYCFQGT.js";import"./chunk-2GVF4P32.js";import{a as ce,b as ue}from"./chunk-YC5WDUOT.js";import{c as z}from"./chunk-YMTLAEZG.js";import"./chunk-G7YPFBNB.js";import{a as Z,b as J,c as K,d as Q,f as W,h as X}from"./chunk-SNSQLCH6.js";import{b as oe,c as ne}from"./chunk-BXKJ5BTH.js";import"./chunk-3RK6DDJD.js";import{C as te,F as re,G as ie,b as A,d as c,g as j,h as B,l as G,n as R,q as V,v as $,x as H,y as Y,z as ee}from"./chunk-UJ3DDJ5Q.js";import{i as N,j as D,p as L,sa as ae,ua as se,va as le,wa as me,xa as de}from"./chunk-4WMI5X77.js";import{Cb as C,Db as l,Fb as p,Gb as v,Nb as r,Ob as e,Pb as f,Xb as g,Yb as q,db as s,hc as i,ib as _,ic as x,jc as b,pb as T,vb as d}from"./chunk-B6672ACT.js";import"./chunk-X5YLR3NI.js";import{i as h}from"./chunk-ODN5LVDJ.js";function ve(n,m){n&1&&(r(0,"mat-error"),i(1," El nombre es requerido "),e())}function xe(n,m){n&1&&(r(0,"mat-error"),i(1," El nombre debe tener al menos 2 caracteres "),e())}function Ee(n,m){n&1&&(r(0,"mat-error"),i(1," El email es requerido "),e())}function Me(n,m){n&1&&(r(0,"mat-error"),i(1," Ingrese un email v\xE1lido "),e())}function Pe(n,m){n&1&&(r(0,"mat-error"),i(1," Seleccione un rol "),e())}function Se(n,m){if(n&1&&(r(0,"mat-option",28)(1,"mat-icon"),i(2,"business"),e(),i(3),e()),n&2){let t=m.$implicit;l("value",t.id),s(3),b(" ",t.nombre," ")}}function we(n,m){n&1&&(r(0,"mat-error"),i(1," Seleccione una obra "),e())}function Fe(n,m){n&1&&(r(0,"mat-error"),i(1," La contrase\xF1a es requerida "),e())}function ye(n,m){n&1&&(r(0,"mat-error"),i(1," La contrase\xF1a debe tener al menos 8 caracteres "),e())}function Oe(n,m){n&1&&(r(0,"mat-error"),i(1," La contrase\xF1a debe incluir may\xFAsculas, min\xFAsculas y n\xFAmeros "),e())}function Ie(n,m){n&1&&(r(0,"mat-error"),i(1," Confirme la contrase\xF1a "),e())}function ke(n,m){n&1&&(r(0,"mat-error"),i(1," Las contrase\xF1as no coinciden "),e())}function Ue(n,m){if(n&1&&(r(0,"div",29)(1,"div",30),i(2,"Fortaleza de la contrase\xF1a:"),e(),r(3,"div",31),f(4,"div",32),e(),r(5,"div",33),i(6),e()()),n&2){let t=q();s(4),v(t.getPasswordStrengthClass()),s(),v(t.getPasswordStrengthClass()),s(),b(" ",t.getPasswordStrengthText()," ")}}function Te(n,m){n&1&&f(0,"mat-spinner",34)}function qe(n,m){n&1&&(r(0,"mat-icon"),i(1,"save"),e())}var nt=(()=>{class n{constructor(t,a,o,u){this.fb=t,this.usuariosService=a,this.router=o,this.snackBar=u,this.guardando=!1,this.hidePassword=!0,this.hideConfirmPassword=!0,this.obrasDisponibles=[],this.cargandoObras=!1,this.usuarioForm=this.createForm()}ngOnInit(){this.verificarPermisos(),this.cargarObrasDisponibles()}createForm(){return this.fb.group({nombre:["",[c.required,c.minLength(2)]],email:["",[c.required,c.email]],rol:["",c.required],obra_id:[""],password:["",[c.required,c.minLength(8),c.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,}$/)]],confirmPassword:["",c.required]},{validators:this.passwordMatchValidator})}passwordMatchValidator(t){let a=t.get("password"),o=t.get("confirmPassword");return a&&o&&a.value!==o.value?{passwordMismatch:!0}:null}verificarPermisos(){return h(this,null,function*(){try{(yield this.usuariosService.verificarPermisosResidente())||(this.mostrarError("No tiene permisos para crear usuarios"),this.volver())}catch(t){console.error("Error al verificar permisos:",t),this.mostrarError("Error al verificar permisos"),this.volver()}})}cargarObrasDisponibles(){return h(this,null,function*(){try{this.cargandoObras=!0;let t=yield this.usuariosService.getObrasDisponibles();this.obrasDisponibles=t,console.log("Obras cargadas:",this.obrasDisponibles)}catch(t){console.error("Error al cargar obras:",t),this.mostrarError("Error al cargar las obras disponibles")}finally{this.cargandoObras=!1}})}onSubmit(){return h(this,null,function*(){if(this.usuarioForm.valid&&!this.guardando)try{this.guardando=!0;let t=this.usuarioForm.value,a={nombre:t.nombre.trim(),email:t.email.trim().toLowerCase(),rol:t.rol,obra_id:t.obra_id,password:t.password,confirmPassword:t.confirmPassword};yield this.usuariosService.createUsuario(a),this.mostrarExito("Usuario creado exitosamente"),this.volver()}catch(t){console.error("Error al crear usuario:",t);let a="Error al crear el usuario";t.message?a=t.message:t.error?.message&&(a=t.error.message),this.mostrarError(a)}finally{this.guardando=!1}else this.markFormGroupTouched()})}markFormGroupTouched(){Object.keys(this.usuarioForm.controls).forEach(t=>{this.usuarioForm.get(t)?.markAsTouched()})}isFieldInvalid(t){let a=this.usuarioForm.get(t);return!!(a&&a.invalid&&(a.dirty||a.touched))}getPasswordStrengthClass(){let t=this.usuarioForm.get("password")?.value||"",a=this.calculatePasswordStrength(t);return a<3?"weak":a<5?"medium":"strong"}getPasswordStrengthText(){let t=this.usuarioForm.get("password")?.value||"",a=this.calculatePasswordStrength(t);return a<3?"D\xE9bil":a<5?"Media":"Fuerte"}calculatePasswordStrength(t){let a=0;return t.length>=8&&a++,t.length>=12&&a++,/[a-z]/.test(t)&&a++,/[A-Z]/.test(t)&&a++,/\d/.test(t)&&a++,/[@$!%*?&]/.test(t)&&a++,a}volver(){this.router.navigate(["/usuarios"])}mostrarExito(t){this.snackBar.open(t,"Cerrar",{duration:3e3,panelClass:["success-snackbar"]})}mostrarError(t){this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(a){return new(a||n)(_($),_(Ce),_(z),_(pe))}}static{this.\u0275cmp=T({type:n,selectors:[["app-crear-usuario"]],decls:108,vars:39,consts:[[1,"crear-usuario-container"],[1,"header-section"],["mat-icon-button","",1,"back-button",3,"click"],[1,"form-card"],[1,"usuario-form",3,"ngSubmit","formGroup"],[1,"form-section"],["appearance","outline",1,"full-width"],["matInput","","formControlName","nombre","placeholder","Ingrese el nombre completo"],["matSuffix",""],[4,"ngIf"],["matInput","","type","email","formControlName","email","placeholder","usuario@ejemplo.com"],["formControlName","rol"],["value","residente"],["value","logistica"],["formControlName","obra_id"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","password","placeholder","M\xEDnimo 8 caracteres",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","confirmPassword","placeholder","Repita la contrase\xF1a",3,"type"],["class","password-strength",4,"ngIf"],[1,"form-actions"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],[1,"info-card"],[1,"info-section"],["color","primary"],[1,"info-text"],[3,"value"],[1,"password-strength"],[1,"strength-label"],[1,"strength-bar"],[1,"strength-fill"],[1,"strength-text"],["diameter","20"]],template:function(a,o){if(a&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return o.volver()}),r(3,"mat-icon"),i(4,"arrow_back"),e()(),r(5,"h1"),i(6,"Crear Nuevo Usuario"),e()(),r(7,"mat-card",3)(8,"mat-card-header")(9,"mat-card-title")(10,"mat-icon"),i(11,"person_add"),e(),i(12," Informaci\xF3n del Usuario "),e(),r(13,"mat-card-subtitle"),i(14," Complete los datos para crear un nuevo usuario en el sistema "),e()(),r(15,"mat-card-content")(16,"form",4),g("ngSubmit",function(){return o.onSubmit()}),r(17,"div",5)(18,"h3"),i(19,"Informaci\xF3n Personal"),e(),r(20,"mat-form-field",6)(21,"mat-label"),i(22,"Nombre completo"),e(),f(23,"input",7),r(24,"mat-icon",8),i(25,"person"),e(),d(26,ve,2,0,"mat-error",9)(27,xe,2,0,"mat-error",9),e(),r(28,"mat-form-field",6)(29,"mat-label"),i(30,"Email"),e(),f(31,"input",10),r(32,"mat-icon",8),i(33,"email"),e(),d(34,Ee,2,0,"mat-error",9)(35,Me,2,0,"mat-error",9),e(),r(36,"mat-form-field",6)(37,"mat-label"),i(38,"Rol"),e(),r(39,"mat-select",11)(40,"mat-option",12)(41,"mat-icon"),i(42,"engineering"),e(),i(43," Residente "),e(),r(44,"mat-option",13)(45,"mat-icon"),i(46,"local_shipping"),e(),i(47," Log\xEDstica "),e()(),r(48,"mat-icon",8),i(49,"work"),e(),d(50,Pe,2,0,"mat-error",9),e(),r(51,"mat-form-field",6)(52,"mat-label"),i(53,"Obra"),e(),r(54,"mat-select",14),d(55,Se,4,2,"mat-option",15),e(),r(56,"mat-icon",8),i(57,"construction"),e(),d(58,we,2,0,"mat-error",9),e()(),r(59,"div",5)(60,"h3"),i(61,"Seguridad"),e(),r(62,"mat-form-field",6)(63,"mat-label"),i(64,"Contrase\xF1a"),e(),f(65,"input",16),r(66,"button",17),g("click",function(){return o.hidePassword=!o.hidePassword}),r(67,"mat-icon"),i(68),e()(),d(69,Fe,2,0,"mat-error",9)(70,ye,2,0,"mat-error",9)(71,Oe,2,0,"mat-error",9),e(),r(72,"mat-form-field",6)(73,"mat-label"),i(74,"Confirmar contrase\xF1a"),e(),f(75,"input",18),r(76,"button",17),g("click",function(){return o.hideConfirmPassword=!o.hideConfirmPassword}),r(77,"mat-icon"),i(78),e()(),d(79,Ie,2,0,"mat-error",9)(80,ke,2,0,"mat-error",9),e(),d(81,Ue,7,5,"div",19),e(),r(82,"div",20)(83,"button",21),g("click",function(){return o.volver()}),r(84,"mat-icon"),i(85,"cancel"),e(),i(86," Cancelar "),e(),r(87,"button",22),d(88,Te,1,0,"mat-spinner",23)(89,qe,2,0,"mat-icon",9),i(90),e()()()()(),r(91,"mat-card",24)(92,"mat-card-content")(93,"div",25)(94,"mat-icon",26),i(95,"info"),e(),r(96,"div",27)(97,"h4"),i(98,"Informaci\xF3n importante"),e(),r(99,"ul")(100,"li"),i(101,"La contrase\xF1a debe tener al menos 8 caracteres con may\xFAsculas, min\xFAsculas y n\xFAmeros"),e(),r(102,"li"),i(103,"El rol determina los permisos y accesos del usuario en el sistema"),e(),r(104,"li"),i(105,"La obra asignada define el proyecto en el que trabajar\xE1 el usuario"),e(),r(106,"li"),i(107,"Los usuarios se crean en estado activo por defecto"),e()()()()()()()),a&2){let u,E,M,P,S,w,F,y,O,I,k,U;s(16),l("formGroup",o.usuarioForm),s(7),p("error",o.isFieldInvalid("nombre")),s(3),l("ngIf",(u=o.usuarioForm.get("nombre"))==null?null:u.hasError("required")),s(),l("ngIf",(E=o.usuarioForm.get("nombre"))==null?null:E.hasError("minlength")),s(4),p("error",o.isFieldInvalid("email")),s(3),l("ngIf",(M=o.usuarioForm.get("email"))==null?null:M.hasError("required")),s(),l("ngIf",(P=o.usuarioForm.get("email"))==null?null:P.hasError("email")),s(4),p("error",o.isFieldInvalid("rol")),s(11),l("ngIf",(S=o.usuarioForm.get("rol"))==null?null:S.hasError("required")),s(4),p("error",o.isFieldInvalid("obra_id")),s(),l("ngForOf",o.obrasDisponibles),s(3),l("ngIf",(w=o.usuarioForm.get("obra_id"))==null?null:w.hasError("required")),s(7),p("error",o.isFieldInvalid("password")),l("type",o.hidePassword?"password":"text"),s(),C("aria-label","Hide password")("aria-pressed",o.hidePassword),s(2),x(o.hidePassword?"visibility_off":"visibility"),s(),l("ngIf",(F=o.usuarioForm.get("password"))==null?null:F.hasError("required")),s(),l("ngIf",(y=o.usuarioForm.get("password"))==null?null:y.hasError("minlength")),s(),l("ngIf",(O=o.usuarioForm.get("password"))==null?null:O.hasError("pattern")),s(4),p("error",o.isFieldInvalid("confirmPassword")),l("type",o.hideConfirmPassword?"password":"text"),s(),C("aria-label","Hide password")("aria-pressed",o.hideConfirmPassword),s(2),x(o.hideConfirmPassword?"visibility_off":"visibility"),s(),l("ngIf",(I=o.usuarioForm.get("confirmPassword"))==null?null:I.hasError("required")),s(),l("ngIf",o.usuarioForm.hasError("passwordMismatch")&&!((k=o.usuarioForm.get("confirmPassword"))!=null&&k.hasError("required"))),s(),l("ngIf",(U=o.usuarioForm.get("password"))==null?null:U.value),s(2),l("disabled",o.guardando),s(4),l("disabled",o.usuarioForm.invalid||o.guardando),s(),l("ngIf",o.guardando),s(),l("ngIf",!o.guardando),s(),b(" ",o.guardando?"Creando...":"Crear Usuario"," ")}},dependencies:[L,N,D,H,G,A,j,B,R,V,X,Z,K,W,Q,J,le,se,ae,de,me,ne,oe,re,Y,ee,te,ie,be,he,_e,fe,ue,ce,ge],styles:[".crear-usuario-container[_ngcontent-%COMP%]{padding:24px;max-width:800px;margin:0 auto}.header-section[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px;gap:16px}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2rem;font-weight:500;color:#333}.back-button[_ngcontent-%COMP%]{color:#666}.form-card[_ngcontent-%COMP%]{margin-bottom:24px}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:24px}.form-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:1.5rem}.usuario-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.form-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:500;color:#333;border-bottom:2px solid #e0e0e0;padding-bottom:8px}.full-width[_ngcontent-%COMP%]{width:100%}.password-strength[_ngcontent-%COMP%]{margin-top:-8px;margin-bottom:8px}.strength-label[_ngcontent-%COMP%]{font-size:.875rem;color:#666;margin-bottom:4px}.strength-bar[_ngcontent-%COMP%]{width:100%;height:4px;background-color:#e0e0e0;border-radius:2px;overflow:hidden;margin-bottom:4px}.strength-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s ease,background-color .3s ease}.strength-fill.weak[_ngcontent-%COMP%]{width:33%;background-color:#f44336}.strength-fill.medium[_ngcontent-%COMP%]{width:66%;background-color:#ff9800}.strength-fill.strong[_ngcontent-%COMP%]{width:100%;background-color:#4caf50}.strength-text[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500}.strength-text.weak[_ngcontent-%COMP%]{color:#f44336}.strength-text.medium[_ngcontent-%COMP%]{color:#ff9800}.strength-text.strong[_ngcontent-%COMP%]{color:#4caf50}.form-actions[_ngcontent-%COMP%]{display:flex;gap:16px;justify-content:flex-end;margin-top:24px;padding-top:24px;border-top:1px solid #e0e0e0}.info-card[_ngcontent-%COMP%]{background-color:#f8f9fa}.info-section[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start}.info-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-size:1rem;font-weight:500;color:#333}.info-text[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:20px;color:#666}.info-text[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px;font-size:.875rem}.error[_ngcontent-%COMP%]{border-color:#f44336!important}@media (max-width: 768px){.crear-usuario-container[_ngcontent-%COMP%]{padding:16px}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.info-section[_ngcontent-%COMP%]{flex-direction:column;gap:8px}}"]})}}return n})();export{nt as CrearUsuarioComponent};
