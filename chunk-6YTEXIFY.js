import{a as p}from"./chunk-WFXXN3GR.js";import{ba as h,g as d,ga as l}from"./chunk-B6672ACT.js";import{a as c,b as n,i as s}from"./chunk-ODN5LVDJ.js";var m=(()=>{class i{constructor(a){this.supabase=a,this.tareasSubject=new d([]),this.tareas$=this.tareasSubject.asObservable()}createTarea(a){return s(this,null,function*(){try{let t={actividad_id:a.actividad_id,nombre:a.nombre,descripcion:a.descripcion,orden:a.orden||0,completada:a.completada||!1,fecha_creacion:new Date().toISOString()},{data:e,error:r}=yield this.supabase.client.from("tareas").insert([t]).select().single();if(r)throw r;return e}catch(t){throw t}})}getTareasByActividad(a){return s(this,null,function*(){try{let{data:t,error:e}=yield this.supabase.client.from("tareas").select("*").eq("actividad_id",a).order("orden",{ascending:!0});if(e)throw e;return t||[]}catch(t){throw t}})}updateTareaEstado(a,t){return s(this,null,function*(){try{let e={completada:t,fecha_completado:t?new Date().toISOString():null,updated_at:new Date().toISOString()},{data:r,error:o}=yield this.supabase.client.from("tareas").update(e).eq("id",a).select().single();if(o)throw o;return r}catch(e){throw e}})}updateTarea(a,t){return s(this,null,function*(){try{let e=n(c({},t),{updated_at:new Date().toISOString()}),{data:r,error:o}=yield this.supabase.client.from("tareas").update(e).eq("id",a).select().single();if(o)throw o;return r}catch(e){throw e}})}deleteTarea(a){return s(this,null,function*(){try{let{error:t}=yield this.supabase.client.from("tareas").delete().eq("id",a);if(t)throw t}catch(t){throw t}})}calcularProgresoActividad(a){return s(this,null,function*(){try{let t=yield this.getTareasByActividad(a);if(t.length===0)return 0;let e=t.filter(o=>o.completada).length;return Math.round(e/t.length*100)}catch{return 0}})}getEstadisticasTareas(a){return s(this,null,function*(){try{let t=yield this.getTareasByActividad(a),e=t.filter(u=>u.completada).length,r=t.length-e,o=t.length>0?Math.round(e/t.length*100):0;return{total:t.length,completadas:e,pendientes:r,progreso:o}}catch{return{total:0,completadas:0,pendientes:0,progreso:0}}})}reorderTareas(a,t){return s(this,null,function*(){try{for(let e of t)yield this.supabase.client.from("tareas").update({orden:e.orden}).eq("id",e.id)}catch(e){throw e}})}static{this.\u0275fac=function(t){return new(t||i)(l(p))}}static{this.\u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{m as a};
