import{a as Ie}from"./chunk-5XK2YORY.js";import{a as R,b as Zt}from"./chunk-GJB63F4V.js";import{a as Bt,b as Gt,c as Wt,d as Vt,e as $t,f as Ht}from"./chunk-ZRWTJLBH.js";import{a as an}from"./chunk-2VCPFRHH.js";import{c as rn}from"./chunk-ZLVJQ2UH.js";import"./chunk-SXXER37Y.js";import{a as qt,b as Yt,c as Jt,e as Xt,f as Qt,g as en}from"./chunk-JUW7GNWS.js";import"./chunk-7BCONPA6.js";import{a as on}from"./chunk-4W4CX7QI.js";import{a as Nt,b as Ut}from"./chunk-ZOXEDHNH.js";import{a as Oe,d as Ee}from"./chunk-ZBUPANVT.js";import"./chunk-F5X5MWHG.js";import{a as we,b as ke}from"./chunk-WI2E4B7N.js";import"./chunk-CSWWTQFU.js";import{a as nn}from"./chunk-6DYBOFBA.js";import{a as jt,b as Kt}from"./chunk-MVE6Y23E.js";import{a as A}from"./chunk-GOBT7UBB.js";import{a as zt,b as Lt}from"./chunk-AZ2U4T3U.js";import"./chunk-SGYCFQGT.js";import{a as tn}from"./chunk-WFXXN3GR.js";import{a as Rt,b as Ft}from"./chunk-YC5WDUOT.js";import{b as ut,c as H,d as xe,e as ht,f as ft,g as vt}from"./chunk-YMTLAEZG.js";import"./chunk-G7YPFBNB.js";import{a as _e,b as Pe,c as Me,d as Se,f as ye,h as ie}from"./chunk-SNSQLCH6.js";import{b as At,c as Tt}from"./chunk-BXKJ5BTH.js";import"./chunk-3RK6DDJD.js";import{C as kt,F as It,G as Dt,b as bt,d as pe,g as Ct,h as xt,l as _t,n as Pt,q as Mt,t as St,v as yt,x as Ot,y as Et,z as wt}from"./chunk-UJ3DDJ5Q.js";import{a as st,i as dt,j as V,n as Ce,o as ct,p as $,r as lt,s as pt,sa as oe,u as Le,ua as re,va as Z,w as je,wa as q,x as mt,xa as Y,y as gt}from"./chunk-4WMI5X77.js";import{$ as Je,B as Q,Ba as T,Bb as ze,Bc as rt,C as Re,Cc as ae,Db as u,E as Ze,F as qe,Fb as ve,Gb as j,I as L,Ma as Qe,Nb as i,Ob as n,Pa as et,Pb as x,Q as Ye,Tb as ee,W as le,X as Fe,Xb as D,Yb as S,_ as N,ba as w,c as K,db as c,ea as ue,f as X,g as Te,ga as k,gb as tt,gc as it,ha as U,hc as r,ib as P,ic as E,jb as nt,jc as b,ka as he,kc as be,l as de,lc as ot,p as $e,pa as B,pb as W,q as ce,qa as G,uc as te,va as fe,vb as O,wc as ne,y as He,ya as Xe,zb as at}from"./chunk-B6672ACT.js";import"./chunk-X5YLR3NI.js";import{a as Ve,i as f}from"./chunk-ODN5LVDJ.js";function _n(o,d){o&1&&(i(0,"mat-error"),r(1," El email es requerido "),n())}function Pn(o,d){o&1&&(i(0,"mat-error"),r(1," Ingrese un email v\xE1lido "),n())}function Mn(o,d){o&1&&(i(0,"mat-error"),r(1," La contrase\xF1a es requerida "),n())}function Sn(o,d){o&1&&x(0,"mat-spinner",10)}function yn(o,d){o&1&&(i(0,"span"),r(1,"Iniciar Sesi\xF3n"),n())}var sn=(()=>{class o{constructor(e,a,t,s,l,p){this.fb=e,this.directAuthService=a,this.router=t,this.snackBar=s,this.ngZone=l,this.cdr=p,this.hidePassword=!0,this.isLoading=!1,this.loginForm=this.fb.group({email:["",[pe.required,pe.email]],password:["",[pe.required,pe.minLength(6)]]})}onSubmit(){return f(this,null,function*(){if(this.loginForm.valid){this.isLoading=!0;let{email:e,password:a}=this.loginForm.value;console.log("\u{1F4E4} Usando DirectAuthService para login...");try{let t=yield this.directAuthService.login(e,a);if(this.isLoading=!1,t.user&&!t.error)this.snackBar.open("Inicio de sesi\xF3n exitoso","Cerrar",{duration:3e3,panelClass:["success-snackbar"]}),console.log("\u2705 Login exitoso, navegando al dashboard..."),this.router.navigate(["/dashboard"]);else{let s=t.error?.message||"Error al iniciar sesi\xF3n";s.includes("Invalid login credentials")&&(s="Credenciales inv\xE1lidas. Por favor verifique su email y contrase\xF1a."),this.snackBar.open(s,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}}catch(t){this.isLoading=!1,console.error("\u274C Error de conexi\xF3n:",t),this.snackBar.open("Error de conexi\xF3n. Intente nuevamente m\xE1s tarde.","Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}}else console.log("\u26A0\uFE0F Formulario de login inv\xE1lido")})}static{this.\u0275fac=function(a){return new(a||o)(P(yt),P(A),P(H),P(zt),P(T),P(ae))}}static{this.\u0275cmp=W({type:o,selectors:[["app-login"]],decls:26,vars:9,consts:[[1,"login-container"],[1,"login-card"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","password","required","",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",1,"full-width","login-button",3,"disabled"],["diameter","20",4,"ngIf"],["diameter","20"]],template:function(a,t){if(a&1&&(i(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Sistema de Gesti\xF3n de Carreteras"),n(),i(5,"mat-card-subtitle"),r(6,"Iniciar Sesi\xF3n"),n()(),i(7,"mat-card-content")(8,"form",2),D("ngSubmit",function(){return t.onSubmit()}),i(9,"mat-form-field",3)(10,"mat-label"),r(11,"Email"),n(),x(12,"input",4),O(13,_n,2,0,"mat-error",5)(14,Pn,2,0,"mat-error",5),n(),i(15,"mat-form-field",3)(16,"mat-label"),r(17,"Contrase\xF1a"),n(),x(18,"input",6),i(19,"button",7),D("click",function(){return t.hidePassword=!t.hidePassword}),i(20,"mat-icon"),r(21),n()(),O(22,Mn,2,0,"mat-error",5),n(),i(23,"button",8),O(24,Sn,1,0,"mat-spinner",9)(25,yn,2,0,"span",5),n()()()()()),a&2){let s,l,p;c(8),u("formGroup",t.loginForm),c(5),u("ngIf",(s=t.loginForm.get("email"))==null?null:s.hasError("required")),c(),u("ngIf",(l=t.loginForm.get("email"))==null?null:l.hasError("email")),c(4),u("type",t.hidePassword?"password":"text"),c(3),E(t.hidePassword?"visibility_off":"visibility"),c(),u("ngIf",(p=t.loginForm.get("password"))==null?null:p.hasError("required")),c(),u("disabled",t.loginForm.invalid||t.isLoading),c(),u("ngIf",t.isLoading),c(),u("ngIf",!t.isLoading)}},dependencies:[$,V,Ot,_t,bt,Ct,xt,St,Pt,Mt,ie,_e,Me,ye,Se,Pe,Dt,It,Et,wt,kt,Tt,At,Z,re,oe,Y,q,Ft,Rt,Lt],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px}.login-card[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:20px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.login-button[_ngcontent-%COMP%]{height:48px;margin-top:16px}mat-card-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}"]})}}return o})();function wn(o,d){if(o&1&&(i(0,"div",19)(1,"mat-icon"),r(2,"business"),n(),i(3,"span")(4,"strong"),r(5,"Obra:"),n(),r(6),n()()),o&2){let e=S(2);c(6),b(" ",e.data.alerta.obra_nombre,"")}}function kn(o,d){if(o&1&&(i(0,"div",19)(1,"mat-icon"),r(2,"construction"),n(),i(3,"span")(4,"strong"),r(5,"Tipo de Actividad:"),n(),r(6),n()()),o&2){let e=S(2);c(6),b(" ",e.data.alerta.actividad_tipo,"")}}function In(o,d){if(o&1&&(i(0,"div",19)(1,"mat-icon"),r(2,"location_on"),n(),i(3,"span")(4,"strong"),r(5,"Ubicaci\xF3n:"),n(),r(6),n()()),o&2){let e=S(2);c(6),b(" ",e.data.alerta.actividad_ubicacion,"")}}function Dn(o,d){if(o&1&&(i(0,"div",17)(1,"h3"),r(2,"Informaci\xF3n Adicional"),n(),O(3,wn,7,1,"div",18)(4,kn,7,1,"div",18)(5,In,7,1,"div",18),n()),o&2){let e=S();c(3),u("ngIf",e.data.alerta.obra_nombre),c(),u("ngIf",e.data.alerta.actividad_tipo),c(),u("ngIf",e.data.alerta.actividad_ubicacion)}}var dn=(()=>{class o{constructor(e,a){this.dialogRef=e,this.data=a}onClose(){this.dialogRef.close()}onDelete(){this.dialogRef.close({action:"delete",alerta:this.data.alerta})}static{this.\u0275fac=function(a){return new(a||o)(P(qt),P(Yt))}}static{this.\u0275cmp=W({type:o,selectors:[["app-alert-detail-modal"]],decls:44,vars:14,consts:[[1,"alert-detail-modal"],[1,"modal-header"],[1,"alert-icon"],["color","warn"],[1,"alert-title"],[1,"alert-date"],[1,"alert-content"],[1,"kpi-metrics"],[1,"metric-card"],[1,"metric-label"],[1,"metric-value"],["class","alert-details",4,"ngIf"],[1,"alert-status"],["color","warn","selected",""],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","warn",3,"click"],[1,"alert-details"],["class","detail-item",4,"ngIf"],[1,"detail-item"]],template:function(a,t){a&1&&(i(0,"div",0)(1,"mat-dialog-content")(2,"div",1)(3,"div",2)(4,"mat-icon",3),r(5,"warning"),n()(),i(6,"div",4)(7,"h2"),r(8,"Detalle de Alerta KPI"),n(),i(9,"p",5),r(10),te(11,"date"),n()()(),i(12,"div",6)(13,"div",7)(14,"div",8)(15,"div",9),r(16,"Avance F\xEDsico"),n(),i(17,"div",10),r(18),n()(),i(19,"div",8)(20,"div",9),r(21,"Productividad"),n(),i(22,"div",10),r(23),n()(),i(24,"div",8)(25,"div",9),r(26,"Calidad"),n(),i(27,"div",10),r(28),n()()(),O(29,Dn,6,3,"div",11),i(30,"div",12)(31,"mat-chip",13)(32,"mat-icon"),r(33,"priority_high"),n(),r(34," Requiere Atenci\xF3n "),n()()()(),i(35,"mat-dialog-actions",14)(36,"button",15),D("click",function(){return t.onClose()}),i(37,"mat-icon"),r(38,"close"),n(),r(39," Cerrar "),n(),i(40,"button",16),D("click",function(){return t.onDelete()}),i(41,"mat-icon"),r(42,"delete"),n(),r(43," Eliminar Alerta "),n()()()),a&2&&(c(10),E(ne(11,11,t.data.alerta.fecha,"dd/MM/yyyy HH:mm")),c(7),ve("critical",t.data.alerta.avance_fisico<50),c(),b(" ",t.data.alerta.avance_fisico,"% "),c(4),ve("critical",t.data.alerta.productividad<50),c(),b(" ",t.data.alerta.productividad,"% "),c(4),ve("critical",t.data.alerta.calidad<50),c(),b(" ",t.data.alerta.calidad,"% "),c(),u("ngIf",t.data.alerta.obra_nombre||t.data.alerta.actividad_tipo))},dependencies:[$,V,Ce,en,Qt,Xt,Z,re,Y,q,ie,Ee,Oe],styles:[".alert-detail-modal[_ngcontent-%COMP%]{min-width:500px;max-width:600px}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #e0e0e0}.alert-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}.alert-title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500;color:#333}.alert-date[_ngcontent-%COMP%]{margin:4px 0 0;color:#666;font-size:14px}.alert-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.kpi-metrics[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}.metric-card[_ngcontent-%COMP%]{background:#f5f5f5;border-radius:8px;padding:16px;text-align:center;border:2px solid transparent;transition:all .3s ease}.metric-card[_ngcontent-%COMP%]:hover{background:#eee}.metric-label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;font-weight:500;margin-bottom:8px}.metric-value[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#2196f3}.metric-value.critical[_ngcontent-%COMP%]{color:#f44336}.alert-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:18px;color:#333}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:12px;padding:8px;background:#fafafa;border-radius:4px}.detail-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#666;font-size:20px;width:20px;height:20px}.detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:#333}.alert-status[_ngcontent-%COMP%]{display:flex;justify-content:center;padding-top:16px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 0 0;margin:0}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}@media (max-width: 600px){.alert-detail-modal[_ngcontent-%COMP%]{min-width:90vw}.kpi-metrics[_ngcontent-%COMP%]{grid-template-columns:1fr}.modal-header[_ngcontent-%COMP%]{flex-direction:column;text-align:center}}"]})}}return o})();var cn=(()=>{class o{constructor(e,a,t,s,l){this.supabase=e,this.directAuthService=a,this.evaluacionesService=t,this.evidenciaService=s,this.kpisService=l,this.statsSubject=new Te({totalEvaluaciones:0,evaluacionesCompletadas:0,evaluacionesPendientes:0,totalEvidencias:0,evidenciasEstesMes:0,evidenciasPorObra:{},promedioKPIs:0,kpisCriticos:0,tendenciaGeneral:"estable",actividadesCompletadas:0,actividadesTotales:0,actividadesEnProgreso:0,obrasActivas:0,progresoPromedio:0}),this.chartsSubject=new Te({evaluacionesPorMes:{labels:[],datasets:[]},evidenciasPorObra:{labels:[],datasets:[]},kpisPorCategoria:{labels:[],datasets:[]},progresoActividades:{labels:[],datasets:[]},tendenciaCalidad:{labels:[],datasets:[]}}),this.stats$=this.statsSubject.asObservable(),this.charts$=this.chartsSubject.asObservable()}loadDashboardData(){return f(this,null,function*(){try{if(!this.directAuthService.getCurrentUser())return;let[a,t]=yield Promise.all([this.loadDashboardStats(),this.loadDashboardCharts()]);this.statsSubject.next(a),this.chartsSubject.next(t)}catch(e){throw e}})}loadDashboardStats(){return f(this,null,function*(){try{let e=this.directAuthService.getCurrentUser(),a=this.directAuthService.getAccessToken();if(!e||!a)throw new Error("Usuario no autenticado");let{data:t}=yield this.supabase.client.from("user_obras").select("obra_id").eq("user_id",e.id),s=t?.map(v=>v.obra_id)||[];if(s.length===0)return this.getEmptyStats();let[l,p,g,m,C]=yield Promise.all([this.getEvaluacionesStats(),this.getEvidenciasStats(s),this.getKPIsStats(s),this.getActividadesStats(s),this.getObrasStats(s)]);return{totalEvaluaciones:l.totalEvaluaciones||0,evaluacionesCompletadas:l.evaluacionesCompletadas||0,evaluacionesPendientes:l.evaluacionesPendientes||0,totalEvidencias:p.totalEvidencias||0,evidenciasEstesMes:p.evidenciasEstesMes||0,evidenciasPorObra:p.evidenciasPorObra||{},promedioKPIs:g.promedioKPIs||0,kpisCriticos:g.kpisCriticos||0,tendenciaGeneral:g.tendenciaGeneral||"estable",actividadesCompletadas:m.actividadesCompletadas||0,actividadesTotales:m.actividadesTotales||0,actividadesEnProgreso:m.actividadesEnProgreso||0,obrasActivas:C.obrasActivas||0,progresoPromedio:C.progresoPromedio||0}}catch{return this.getEmptyStats()}})}getEvaluacionesStats(){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:a,error:t}=yield this.supabase.client.from("evaluaciones").select("id, estado, created_at");if(t)throw t;let s=a?.length||0,l=a?.filter(g=>g.estado==="completada"||g.estado==="aprobada").length||0,p=s-l;return{totalEvaluaciones:s,evaluacionesCompletadas:l,evaluacionesPendientes:p}}catch{return{totalEvaluaciones:0,evaluacionesCompletadas:0,evaluacionesPendientes:0}}})}getEvidenciasStats(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t}=yield this.supabase.client.from("actividades").select("id, obra_id").in("obra_id",e),s=t?.map(v=>v.id)||[];if(s.length===0)return{totalEvidencias:0,evidenciasEstesMes:0,evidenciasPorObra:{}};let{data:l,error:p}=yield this.supabase.client.from("evidencia_fotografica").select("id, actividad_id, created_at").in("actividad_id",s);if(p)throw p;let g=l?.length||0,m=new Date;m.setDate(1),m.setHours(0,0,0,0);let C=l?.filter(v=>new Date(v.created_at||"")>=m).length||0,h={};return t?.forEach(v=>{let y=v.obra_id,M=l?.filter(I=>I.actividad_id===v.id).length||0;h[y]=(h[y]||0)+M}),{totalEvidencias:g,evidenciasEstesMes:C,evidenciasPorObra:h}}catch{return{totalEvidencias:0,evidenciasEstesMes:0,evidenciasPorObra:{}}}})}getKPIsStats(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t,error:s}=yield this.supabase.client.from("kpis").select("avance_fisico, productividad, calidad, desviacion_cronograma, created_at").in("obra_id",e).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString());if(s)throw s;if(console.log("KPIs stats data:",t),!t||t.length===0)return console.log("No KPIs found, returning empty stats"),{promedioKPIs:0,kpisCriticos:0,tendenciaGeneral:"estable"};let l=t.map(h=>{let v=[h.avance_fisico||0,h.productividad||0,h.calidad||0,100-(h.desviacion_cronograma||0)].filter(y=>y>0);return v.length>0?v.reduce((y,M)=>y+M,0)/v.length:0}),p=l.length>0?l.reduce((h,v)=>h+v,0)/l.length:0,g=l.filter(h=>h<70).length,m="estable";if(t.length>=4){let h=Math.floor(t.length/2),v=l.slice(0,h),y=l.slice(h),M=v.reduce((J,Ae)=>J+Ae,0)/v.length,z=y.reduce((J,Ae)=>J+Ae,0)/y.length-M;z>5?m="subiendo":z<-5&&(m="bajando")}let C={promedioKPIs:Math.round(p),kpisCriticos:g,tendenciaGeneral:m};return console.log("KPIs stats calculated:",C),C}catch(a){return console.error("Error obteniendo estad\xEDsticas de KPIs:",a),{promedioKPIs:0,kpisCriticos:0,tendenciaGeneral:"estable"}}})}getActividadesStats(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t,error:s}=yield this.supabase.client.from("actividades").select("id, estado, progreso_porcentaje").in("obra_id",e);if(s)throw s;let l=t?.length||0,p=t?.filter(m=>m.estado==="finalizado").length||0,g=t?.filter(m=>m.estado==="ejecucion").length||0;return console.log("\u{1F4CA} [DashboardService] Estad\xEDsticas de actividades:",{total:l,completadas:p,enProgreso:g,actividades:t?.map(m=>({estado:m.estado,progreso:m.progreso_porcentaje}))}),{actividadesTotales:l,actividadesCompletadas:p,actividadesEnProgreso:g}}catch(a){return console.error("\u274C [DashboardService] Error obteniendo estad\xEDsticas de actividades:",a),{actividadesTotales:0,actividadesCompletadas:0,actividadesEnProgreso:0}}})}getObrasStats(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t,error:s}=yield this.supabase.client.from("obras").select("id, estado, progreso").in("id",e);if(s)throw s;console.log("Obras stats data:",t);let l=t?.filter(m=>m.estado==="activa").length||0,p=t&&t.length>0?t.reduce((m,C)=>m+(C.progreso||0),0)/t.length:0,g={obrasActivas:l,progresoPromedio:Math.round(p)};return console.log("Obras stats calculated:",g),g}catch(a){return console.error("Error obteniendo estad\xEDsticas de obras:",a),{obrasActivas:0,progresoPromedio:0}}})}loadDashboardCharts(){return f(this,null,function*(){try{let e=this.directAuthService.getCurrentUser(),a=this.directAuthService.getAccessToken();if(!e||!a)throw new Error("Usuario no autenticado");let{data:t}=yield this.supabase.client.from("user_obras").select("obra_id").eq("user_id",e.id),s=t?.map(h=>h.obra_id)||[];if(s.length===0)return this.getEmptyCharts();let[l,p,g,m,C]=yield Promise.all([this.getEvaluacionesPorMesChart(),this.getEvidenciasPorObraChart(s),this.getKPIsPorCategoriaChart(s),this.getProgresoActividadesChart(s),this.getTendenciaCalidadChart(s)]);return{evaluacionesPorMes:l,evidenciasPorObra:p,kpisPorCategoria:g,progresoActividades:m,tendenciaCalidad:C}}catch{return this.getEmptyCharts()}})}getEvaluacionesPorMesChart(){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:a,error:t}=yield this.supabase.client.from("evaluaciones").select("created_at, estado").gte("created_at",new Date(Date.now()-6*30*24*60*60*1e3).toISOString());if(t)throw t;let s=[],l=[],p=[];for(let g=5;g>=0;g--){let m=new Date;m.setMonth(m.getMonth()-g);let C=m.toLocaleDateString("es-ES",{month:"short"});s.push(C);let h=new Date(m.getFullYear(),m.getMonth(),1),v=new Date(m.getFullYear(),m.getMonth()+1,0),y=a?.filter(z=>{let J=new Date(z.created_at||"");return J>=h&&J<=v})||[],M=y.filter(z=>z.estado==="completada"||z.estado==="aprobada").length,I=y.length-M;l.push(M),p.push(I)}return{labels:s,datasets:[{label:"Completadas",data:l,backgroundColor:"#4caf50",borderColor:"#4caf50",borderWidth:1},{label:"Pendientes",data:p,backgroundColor:"#ff9800",borderColor:"#ff9800",borderWidth:1}]}}catch{return this.getEmptyChart(["Ene","Feb","Mar","Abr","May","Jun"])}})}getEvidenciasPorObraChart(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t}=yield this.supabase.client.from("obras").select("id, nombre").in("id",e),{data:s}=yield this.supabase.client.from("actividades").select("id, obra_id").in("obra_id",e),l=s?.map(h=>h.id)||[];if(l.length===0){let h=t?.map(v=>v.nombre)||["Sin obras"];return this.getEmptyChart(h)}let{data:p}=yield this.supabase.client.from("evidencia_fotografica").select("actividad_id").in("actividad_id",l),g=[],m=[],C=["#2196f3","#4caf50","#ff9800","#f44336","#9c27b0","#00bcd4"];return t?.forEach((h,v)=>{g.push(h.nombre);let y=s?.filter(I=>I.obra_id===h.id)||[],M=p?.filter(I=>y.some(z=>z.id===I.actividad_id)).length||0;m.push(M)}),{labels:g,datasets:[{label:"Evidencias",data:m,backgroundColor:C.slice(0,g.length),borderWidth:1}]}}catch{return this.getEmptyChart(["Obra 1","Obra 2","Obra 3"])}})}getKPIsPorCategoriaChart(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t,error:s}=yield this.supabase.client.from("kpis").select("avance_fisico, productividad, calidad, desviacion_cronograma").in("obra_id",e).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString());if(s)throw s;let l=["Avance F\xEDsico","Productividad","Calidad","Cronograma"];if(!t||t.length===0)return{labels:l,datasets:[{label:"Promedio (%)",data:[0,0,0,0],backgroundColor:["#2196f3","#4caf50","#ff9800","#f44336"],borderWidth:1}]};let p=t.reduce((h,v)=>h+(v.avance_fisico||0),0)/t.length,g=t.reduce((h,v)=>h+(v.productividad||0),0)/t.length,m=t.reduce((h,v)=>h+(v.calidad||0),0)/t.length,C=100-t.reduce((h,v)=>h+(v.desviacion_cronograma||0),0)/t.length;return{labels:l,datasets:[{label:"Promedio (%)",data:[Math.round(p),Math.round(g),Math.round(m),Math.round(C)],backgroundColor:["#2196f3","#4caf50","#ff9800","#f44336"],borderWidth:1}]}}catch{return this.getEmptyChart(["Avance F\xEDsico","Productividad","Calidad","Cronograma"])}})}getProgresoActividadesChart(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t,error:s}=yield this.supabase.client.from("actividades").select("estado").in("obra_id",e);if(s)throw s;let l=t?.filter(m=>m.estado==="finalizado").length||0,p=t?.filter(m=>m.estado==="ejecucion").length||0,g=t?.filter(m=>m.estado==="programado").length||0;return{labels:["Completadas","En Progreso","Pendientes"],datasets:[{data:[l,p,g],backgroundColor:["#4caf50","#2196f3","#ff9800"],borderWidth:2,borderColor:"#fff"}]}}catch{return{labels:["Completadas","En Progreso","Pendientes"],datasets:[{data:[0,0,0],backgroundColor:["#4caf50","#2196f3","#ff9800"],borderWidth:2,borderColor:"#fff"}]}}})}getTendenciaCalidadChart(e){return f(this,null,function*(){try{if(!this.directAuthService.getAccessToken())throw new Error("Token de autenticaci\xF3n no disponible");let{data:t,error:s}=yield this.supabase.client.from("kpis").select("calidad, created_at").in("obra_id",e).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()).order("created_at");if(s)throw s;let l=[],p=[];for(let g=6;g>=0;g--){let m=new Date;m.setDate(m.getDate()-g),l.push(m.toLocaleDateString("es-ES",{weekday:"short"}));let C=new Date(m);C.setHours(0,0,0,0);let h=new Date(m);h.setHours(23,59,59,999);let v=t?.filter(M=>{let I=new Date(M.created_at||"");return I>=C&&I<=h})||[],y=v.length>0?v.reduce((M,I)=>M+(I.calidad||0),0)/v.length:0;p.push(Math.round(y))}return{labels:l,datasets:[{label:"Calidad (%)",data:p,borderColor:"#2196f3",backgroundColor:"rgba(33, 150, 243, 0.1)",borderWidth:2,fill:!0,tension:.4}]}}catch{return{labels:["Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b","Dom"],datasets:[{label:"Calidad (%)",data:[0,0,0,0,0,0,0],borderColor:"#2196f3",backgroundColor:"rgba(33, 150, 243, 0.1)",borderWidth:2,fill:!0,tension:.4}]}}})}getEmptyStats(){return{totalEvaluaciones:0,evaluacionesCompletadas:0,evaluacionesPendientes:0,totalEvidencias:0,evidenciasEstesMes:0,evidenciasPorObra:{},promedioKPIs:0,kpisCriticos:0,tendenciaGeneral:"estable",actividadesCompletadas:0,actividadesTotales:0,actividadesEnProgreso:0,obrasActivas:0,progresoPromedio:0}}getEmptyCharts(){return{evaluacionesPorMes:this.getEmptyChart(["Ene","Feb","Mar","Abr","May","Jun"]),evidenciasPorObra:this.getEmptyChart(["Sin obras"]),kpisPorCategoria:this.getEmptyChart(["Avance F\xEDsico","Productividad","Calidad","Cronograma"]),progresoActividades:{labels:["Completadas","En Progreso","Pendientes"],datasets:[{data:[0,0,0],backgroundColor:["#4caf50","#2196f3","#ff9800"],borderWidth:2,borderColor:"#fff"}]},tendenciaCalidad:{labels:["Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b","Dom"],datasets:[{label:"Calidad (%)",data:[0,0,0,0,0,0,0],borderColor:"#2196f3",backgroundColor:"rgba(33, 150, 243, 0.1)",borderWidth:2,fill:!0,tension:.4}]}}}getEmptyChart(e){return{labels:e,datasets:[{label:"Sin datos",data:new Array(e.length).fill(0),backgroundColor:"#e0e0e0",borderColor:"#bdbdbd",borderWidth:1}]}}refreshDashboard(){return f(this,null,function*(){yield this.loadDashboardData()})}getCurrentStats(){return this.statsSubject.value}getCurrentCharts(){return this.chartsSubject.value}static{this.\u0275fac=function(a){return new(a||o)(k(tn),k(A),k(an),k(on),k(Ie))}}static{this.\u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Fn(o,d){o&1&&(i(0,"div",17)(1,"mat-icon"),r(2,"check_circle"),n(),i(3,"span"),r(4,"No hay alertas activas"),n()())}function zn(o,d){if(o&1){let e=ee();i(0,"div",18)(1,"div",19)(2,"div",20),r(3,"Alerta de KPI"),n(),i(4,"div",21),r(5),n(),i(6,"div",22),r(7),te(8,"date"),n()(),i(9,"div",23)(10,"button",24),D("click",function(){let t=B(e).$implicit,s=S();return G(s.resolveAlert(t))}),i(11,"mat-icon"),r(12,"visibility"),n()(),i(13,"button",25),D("click",function(){let t=B(e).$implicit,s=S();return G(s.deleteAlert(t))}),i(14,"mat-icon"),r(15,"delete"),n()()()()}if(o&2){let e=d.$implicit;c(5),be("Avance F\xEDsico: ",e.avance_fisico,"% | Calidad: ",e.calidad,"%"),c(2),E(ne(8,3,e.fecha,"short"))}}function Ln(o,d){o&1&&x(0,"mat-divider")}function jn(o,d){o&1&&(i(0,"div",26)(1,"span"),r(2,"Ver todas las alertas"),n()())}function Kn(o,d){o&1&&(i(0,"div",27),x(1,"mat-progress-bar",28),i(2,"p"),r(3,"Cargando datos del dashboard..."),n()())}function Nn(o,d){if(o&1&&(i(0,"div",40)(1,"mat-card",41)(2,"mat-card-content")(3,"div",42)(4,"mat-icon"),r(5,"engineering"),n()(),i(6,"div",43)(7,"div",44),r(8),n(),i(9,"div",45),r(10,"Actividades de Campo"),n()()()(),i(11,"mat-card",46)(12,"mat-card-content")(13,"div",42)(14,"mat-icon"),r(15,"rate_review"),n()(),i(16,"div",43)(17,"div",44),r(18),n(),i(19,"div",45),r(20,"Evaluaciones Realizadas"),n()()()(),i(21,"mat-card",47)(22,"mat-card-content")(23,"div",42)(24,"mat-icon"),r(25,"construction"),n()(),i(26,"div",43)(27,"div",44),r(28),n(),i(29,"div",45),r(30,"Progreso de Obra"),n()()()(),i(31,"mat-card",48)(32,"mat-card-content")(33,"div",42)(34,"mat-icon"),r(35,"security"),n()(),i(36,"div",43)(37,"div",44),r(38),n(),i(39,"div",45),r(40,"Incidentes de Seguridad"),n()()()()()),o&2){let e=S(2);c(8),E(e.stats.actividadesCampo),c(10),E(e.stats.evaluacionesPersonal),c(10),b("",e.stats.progresoObra,"%"),c(10),E(e.stats.incidentesSeguridad)}}function Un(o,d){if(o&1&&(i(0,"div",40)(1,"mat-card",41)(2,"mat-card-content")(3,"div",42)(4,"mat-icon"),r(5,"business"),n()(),i(6,"div",43)(7,"div",44),r(8),n(),i(9,"div",45),r(10,"Obras Activas"),n()()()(),i(11,"mat-card",46)(12,"mat-card-content")(13,"div",42)(14,"mat-icon"),r(15,"attach_money"),n()(),i(16,"div",43)(17,"div",44),r(18),te(19,"number"),n(),i(20,"div",45),r(21,"Presupuesto Ejecutado"),n()()()(),i(22,"mat-card",47)(23,"mat-card-content")(24,"div",42)(25,"mat-icon"),r(26,"inventory"),n()(),i(27,"div",43)(28,"div",44),r(29),n(),i(30,"div",45),r(31,"Recursos Asignados"),n()()()(),i(32,"mat-card",48)(33,"mat-card-content")(34,"div",42)(35,"mat-icon"),r(36,"schedule"),n()(),i(37,"div",43)(38,"div",44),r(39),n(),i(40,"div",45),r(41,"Proyectos Retrasados"),n()()()()()),o&2){let e=S(2);c(8),E(e.stats.obrasActivas),c(10),b("$",ne(19,4,e.stats.presupuestoEjecutado,"1.0-0"),""),c(11),E(e.stats.recursosAsignados),c(10),E(e.stats.proyectosRetrasados)}}function Bn(o,d){o&1&&(i(0,"div",49)(1,"mat-card",50)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Actividades de Campo"),n(),i(5,"mat-card-subtitle"),r(6,"Estado de actividades en terreno"),n()(),i(7,"mat-card-content")(8,"div",51),x(9,"canvas",52),n()()(),i(10,"mat-card",50)(11,"mat-card-header")(12,"mat-card-title"),r(13,"Evaluaciones de Personal"),n(),i(14,"mat-card-subtitle"),r(15,"Desempe\xF1o del equipo de trabajo"),n()(),i(16,"mat-card-content")(17,"div",51),x(18,"canvas",53),n()()(),i(19,"mat-card",54)(20,"mat-card-header")(21,"mat-card-title"),r(22,"Progreso Semanal de Obra"),n(),i(23,"mat-card-subtitle"),r(24,"Avance de construcci\xF3n por semana"),n()(),i(25,"mat-card-content")(26,"div",51),x(27,"canvas",55),n()()()())}function Gn(o,d){o&1&&(i(0,"div",49)(1,"mat-card",50)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Estado de Actividades"),n(),i(5,"mat-card-subtitle"),r(6,"Distribuci\xF3n por estado de actividades"),n()(),i(7,"mat-card-content")(8,"div",51),x(9,"canvas",56),n()()(),i(10,"mat-card",50)(11,"mat-card-header")(12,"mat-card-title"),r(13,"An\xE1lisis de Costos"),n(),i(14,"mat-card-subtitle"),r(15,"Presupuesto vs Ejecutado"),n()(),i(16,"mat-card-content")(17,"div",51),x(18,"canvas",57),n()()(),i(19,"mat-card",54)(20,"mat-card-header")(21,"mat-card-title"),r(22,"Cronograma de Proyectos"),n(),i(23,"mat-card-subtitle"),r(24,"Planificaci\xF3n vs Ejecuci\xF3n mensual"),n()(),i(25,"mat-card-content")(26,"div",51),x(27,"canvas",58),n()()()())}function Wn(o,d){if(o&1&&(i(0,"mat-card",59)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Indicadores de Campo"),n(),i(4,"mat-card-subtitle"),r(5,"KPIs relevantes para actividades de obra"),n()(),i(6,"mat-card-content")(7,"div",60)(8,"div",61)(9,"div",62)(10,"mat-icon",63),r(11,"verified"),n(),i(12,"span",64),r(13,"Calidad de Obra"),n()(),i(14,"div",65)(15,"span",66),r(16),n(),i(17,"mat-icon",67),r(18),n()(),i(19,"div",68),x(20,"mat-progress-bar",69),n()(),i(21,"div",61)(22,"div",62)(23,"mat-icon",63),r(24,"security"),n(),i(25,"span",64),r(26,"Seguridad"),n()(),i(27,"div",65)(28,"span",66),r(29),n(),i(30,"mat-icon",67),r(31),n()(),i(32,"div",68),x(33,"mat-progress-bar",69),n()(),i(34,"div",61)(35,"div",62)(36,"mat-icon",63),r(37,"speed"),n(),i(38,"span",64),r(39,"Productividad"),n()(),i(40,"div",65)(41,"span",66),r(42),n(),i(43,"mat-icon",67),r(44),n()(),i(45,"div",68),x(46,"mat-progress-bar",69),n()(),i(47,"div",61)(48,"div",62)(49,"mat-icon",63),r(50,"schedule"),n(),i(51,"span",64),r(52,"Cumplimiento"),n()(),i(53,"div",65)(54,"span",66),r(55),n(),i(56,"mat-icon",67),r(57),n()(),i(58,"div",68),x(59,"mat-progress-bar",69),n()()()()()),o&2){let e=S(2);c(16),b("",e.dashboardKPIs.calidad.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.calidad.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.calidad.tendencia)," "),c(2),u("value",e.dashboardKPIs.calidad.promedio)("color",e.getProgressColor(e.dashboardKPIs.calidad.promedio)),c(9),b("",e.dashboardKPIs.seguridad.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.seguridad.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.seguridad.tendencia)," "),c(2),u("value",e.dashboardKPIs.seguridad.promedio)("color",e.getProgressColor(e.dashboardKPIs.seguridad.promedio)),c(9),b("",e.dashboardKPIs.rendimiento.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.rendimiento.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.rendimiento.tendencia)," "),c(2),u("value",e.dashboardKPIs.rendimiento.promedio)("color",e.getProgressColor(e.dashboardKPIs.rendimiento.promedio)),c(9),b("",e.dashboardKPIs.tiempo.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.tiempo.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.tiempo.tendencia)," "),c(2),u("value",e.dashboardKPIs.tiempo.promedio)("color",e.getProgressColor(e.dashboardKPIs.tiempo.promedio))}}function Vn(o,d){if(o&1&&(i(0,"mat-card",59)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Indicadores de Gesti\xF3n"),n(),i(4,"mat-card-subtitle"),r(5,"KPIs relevantes para planificaci\xF3n y recursos"),n()(),i(6,"mat-card-content")(7,"div",60)(8,"div",61)(9,"div",62)(10,"mat-icon",63),r(11,"attach_money"),n(),i(12,"span",64),r(13,"Control de Costos"),n()(),i(14,"div",65)(15,"span",66),r(16),n(),i(17,"mat-icon",67),r(18),n()(),i(19,"div",68),x(20,"mat-progress-bar",69),n()(),i(21,"div",61)(22,"div",62)(23,"mat-icon",63),r(24,"schedule"),n(),i(25,"span",64),r(26,"Cronograma"),n()(),i(27,"div",65)(28,"span",66),r(29),n(),i(30,"mat-icon",67),r(31),n()(),i(32,"div",68),x(33,"mat-progress-bar",69),n()(),i(34,"div",61)(35,"div",62)(36,"mat-icon",63),r(37,"speed"),n(),i(38,"span",64),r(39,"Eficiencia"),n()(),i(40,"div",65)(41,"span",66),r(42),n(),i(43,"mat-icon",67),r(44),n()(),i(45,"div",68),x(46,"mat-progress-bar",69),n()(),i(47,"div",61)(48,"div",62)(49,"mat-icon",63),r(50,"inventory"),n(),i(51,"span",64),r(52,"Recursos"),n()(),i(53,"div",65)(54,"span",66),r(55),n(),i(56,"mat-icon",67),r(57),n()(),i(58,"div",68),x(59,"mat-progress-bar",69),n()()()()()),o&2){let e=S(2);c(16),b("",e.dashboardKPIs.costo.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.costo.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.costo.tendencia)," "),c(2),u("value",e.dashboardKPIs.costo.promedio)("color",e.getProgressColor(e.dashboardKPIs.costo.promedio)),c(9),b("",e.dashboardKPIs.tiempo.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.tiempo.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.tiempo.tendencia)," "),c(2),u("value",e.dashboardKPIs.tiempo.promedio)("color",e.getProgressColor(e.dashboardKPIs.tiempo.promedio)),c(9),b("",e.dashboardKPIs.rendimiento.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.rendimiento.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.rendimiento.tendencia)," "),c(2),u("value",e.dashboardKPIs.rendimiento.promedio)("color",e.getProgressColor(e.dashboardKPIs.rendimiento.promedio)),c(9),b("",e.dashboardKPIs.calidad.promedio,"%"),c(),j("trend-"+e.dashboardKPIs.calidad.tendencia),c(),b(" ",e.getTrendIcon(e.dashboardKPIs.calidad.tendencia)," "),c(2),u("value",e.dashboardKPIs.calidad.promedio)("color",e.getProgressColor(e.dashboardKPIs.calidad.promedio))}}function $n(o,d){o&1&&(i(0,"mat-card",70)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Acciones de Campo"),n(),i(4,"mat-card-subtitle"),r(5,"Funciones para actividades de obra"),n()(),i(6,"mat-card-content")(7,"div",71)(8,"button",72)(9,"mat-icon"),r(10,"add_task"),n(),i(11,"span"),r(12,"Registrar Actividad"),n()(),i(13,"button",73)(14,"mat-icon"),r(15,"assessment"),n(),i(16,"span"),r(17,"Evaluar Personal"),n()(),i(18,"button",74)(19,"mat-icon"),r(20,"map"),n(),i(21,"span"),r(22,"Ubicar Frentes"),n()(),i(23,"button",75)(24,"mat-icon"),r(25,"analytics"),n(),i(26,"span"),r(27,"Reportes de Obra"),n()(),i(28,"button",76)(29,"mat-icon"),r(30,"camera_alt"),n(),i(31,"span"),r(32,"Subir Evidencias"),n()(),i(33,"button",77)(34,"mat-icon"),r(35,"security"),n(),i(36,"span"),r(37,"Control Seguridad"),n()(),i(38,"button",78)(39,"mat-icon"),r(40,"straighten"),n(),i(41,"span"),r(42,"Vista Kilom\xE9trica"),n()()()()())}function Hn(o,d){o&1&&(i(0,"mat-card",70)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Acciones de Gesti\xF3n"),n(),i(4,"mat-card-subtitle"),r(5,"Funciones para planificaci\xF3n y control"),n()(),i(6,"mat-card-content")(7,"div",71)(8,"button",79)(9,"mat-icon"),r(10,"business"),n(),i(11,"span"),r(12,"Gestionar Obras"),n()(),i(13,"button",80)(14,"mat-icon"),r(15,"analytics"),n(),i(16,"span"),r(17,"An\xE1lisis de Costos"),n()(),i(18,"button",81)(19,"mat-icon"),r(20,"schedule"),n(),i(21,"span"),r(22,"Planificaci\xF3n"),n()(),i(23,"button",82)(24,"mat-icon"),r(25,"map"),n(),i(26,"span"),r(27,"Vista General"),n()(),i(28,"button",75)(29,"mat-icon"),r(30,"inventory"),n(),i(31,"span"),r(32,"Control Recursos"),n()(),i(33,"button",83)(34,"mat-icon"),r(35,"trending_up"),n(),i(36,"span"),r(37,"KPIs Globales"),n()(),i(38,"button",78)(39,"mat-icon"),r(40,"straighten"),n(),i(41,"span"),r(42,"Vista Kilom\xE9trica"),n()()()()())}function Zn(o,d){if(o&1){let e=ee();i(0,"div",88)(1,"div",89)(2,"mat-icon",90),r(3,"warning"),n()(),i(4,"div",19)(5,"div",20),r(6),n(),i(7,"div",21),r(8),n(),i(9,"div",91)(10,"span",22),r(11),te(12,"date"),n(),i(13,"mat-chip",92),r(14," Revisar "),n()()(),i(15,"div",93)(16,"button",24),D("click",function(){let t=B(e).$implicit,s=S(3);return G(s.resolveAlert(t))}),i(17,"mat-icon"),r(18,"visibility"),n()(),i(19,"button",25),D("click",function(){let t=B(e).$implicit,s=S(3);return G(s.deleteAlert(t))}),i(20,"mat-icon"),r(21,"delete"),n()()()()}if(o&2){let e=d.$implicit;c(6),E(e.obra_nombre||"KPI de Obra"),c(2),ot("Avance: ",e.avance_fisico,"% | Productividad: ",e.productividad,"% | Calidad: ",e.calidad,"%"),c(3),E(ne(12,5,e.fecha,"short"))}}function qn(o,d){if(o&1&&(i(0,"div",94)(1,"button",95),r(2),i(3,"mat-icon"),r(4,"arrow_forward"),n()()()),o&2){let e=S(3);c(2),b(" Ver todas las alertas (",e.alertas.length,") ")}}function Yn(o,d){if(o&1&&(i(0,"mat-card",84)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Alertas Recientes"),n(),i(4,"mat-card-subtitle"),r(5,"Requieren tu atenci\xF3n"),n()(),i(6,"mat-card-content")(7,"div",85),O(8,Zn,22,8,"div",86),n(),O(9,qn,5,1,"div",87),n()()),o&2){let e=S(2);c(8),u("ngForOf",e.alertas.slice(0,3)),c(),u("ngIf",e.alertas.length>3)}}function Jn(o,d){if(o&1&&(i(0,"div",29),O(1,Nn,41,4,"div",30)(2,Un,42,7,"div",30),i(3,"mat-card",31)(4,"mat-card-header")(5,"mat-card-title"),r(6,"Progreso General del Proyecto"),n()(),i(7,"mat-card-content")(8,"div",32)(9,"div",33),r(10),n(),i(11,"div",34),r(12),n()(),x(13,"mat-progress-bar",35),n()(),O(14,Bn,28,0,"div",36)(15,Gn,28,0,"div",36)(16,Wn,60,24,"mat-card",37)(17,Vn,60,24,"mat-card",37)(18,$n,43,0,"mat-card",38)(19,Hn,43,0,"mat-card",38)(20,Yn,10,2,"mat-card",39),n()),o&2){let e=S();c(),u("ngIf",(e.userProfile==null?null:e.userProfile.rol)==="residente"),c(),u("ngIf",(e.userProfile==null?null:e.userProfile.rol)==="logistica"),c(8),b("",e.getOverallProgress(),"%"),c(2),be(" ",e.stats.actividadesCompletadas," de ",e.stats.totalActividades," actividades completadas "),c(),u("value",e.getOverallProgress())("color",e.getProgressColor()),c(),u("ngIf",(e.userProfile==null?null:e.userProfile.rol)==="residente"),c(),u("ngIf",(e.userProfile==null?null:e.userProfile.rol)==="logistica"),c(),u("ngIf",e.dashboardKPIs&&(e.userProfile==null?null:e.userProfile.rol)==="residente"),c(),u("ngIf",e.dashboardKPIs&&(e.userProfile==null?null:e.userProfile.rol)==="logistica"),c(),u("ngIf",(e.userProfile==null?null:e.userProfile.rol)==="residente"),c(),u("ngIf",(e.userProfile==null?null:e.userProfile.rol)==="logistica"),c(),u("ngIf",e.alertas.length>0)}}R.register(...Zt);var ln=(()=>{class o{constructor(e,a,t,s,l,p,g){this.directAuthService=e,this.kpisService=a,this.actividadesService=t,this.dashboardService=s,this.cdr=l,this.ngZone=p,this.dialog=g,this.destroy$=new X,this.isLoading=!0,this.currentUser=null,this.userProfile=null,this.stats={totalActividades:0,actividadesCompletadas:0,actividadesEnProgreso:0,progresoPromedio:0,alertasActivas:0,kpisCriticos:0},this.dashboardKPIs=null,this.alertas=[],this.progressChart=null,this.kpiChart=null,this.activityChart=null,this.costChart=null,this.planificacionChart=null,this.campoChart=null,this.evaluacionChart=null,this.obrasChart=null,this.progressChartData={labels:[],datasets:[]},this.kpiChartData={labels:[],datasets:[]},this.activityChartData={labels:[],datasets:[]},this.costChartData={labels:[],datasets:[]},this.planificacionChartData={labels:[],datasets:[]}}ngOnInit(){return f(this,null,function*(){console.log("\u{1F680} [DashboardComponent] Inicializando dashboard...");try{this.isLoading=!0,this.cdr.detectChanges(),yield this.loadDataWithErrorHandling(),this.runDebugDiagnostic().catch(e=>{console.warn("\u26A0\uFE0F [DashboardComponent] Diagn\xF3stico fall\xF3, continuando:",e)}),this.ngZone.run(()=>{this.isLoading=!1,this.cdr.detectChanges()}),setTimeout(()=>{this.ngZone.run(()=>{this.initializeCharts(),this.cdr.detectChanges()})},500)}catch(e){console.error("\u274C [DashboardComponent] Error cr\xEDtico inicializando dashboard:",e),this.ngZone.run(()=>{this.isLoading=!1,this.loadFallbackData(),this.cdr.detectChanges(),setTimeout(()=>this.initializeCharts(),500)})}this.directAuthService.isAuthenticated()&&(console.log("\u2705 [Dashboard] Usuario autenticado, inicializando servicios..."),yield this.initializeServices())})}initializeServices(){return f(this,null,function*(){try{console.log("\u{1F527} [Dashboard] Inicializando servicio KpisService..."),yield this.kpisService.initialize(),console.log("\u2705 [Dashboard] Servicio KpisService inicializado correctamente"),this.loadDashboardDataSafely()}catch(e){console.error("\u274C [Dashboard] Error inicializando servicio KpisService:",e),this.loadDashboardDataSafely()}this.refreshKPIsData(),this.runDebugDiagnostic()})}runDebugDiagnostic(){return f(this,null,function*(){try{console.log("\u{1F527} [DASHBOARD] Ejecutando diagn\xF3stico de debug..."),yield this.actividadesService.debugUserData()}catch(e){console.error("\u274C [DASHBOARD] Error en diagn\xF3stico:",e)}})}refreshKPIsData(){return f(this,null,function*(){try{console.log("\u{1F504} Refrescando datos de KPIs desde Supabase..."),yield this.kpisService.refresh(),console.log("\u2705 Datos de KPIs actualizados correctamente")}catch(e){console.error("\u274C Error refrescando datos de KPIs:",e)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.destroyCharts()}loadUserDataSafely(){return f(this,null,function*(){try{console.log("\u{1F464} [DashboardComponent] Cargando datos del usuario...");let e=this.directAuthService.getCurrentUser();if(e){this.ngZone.run(()=>{this.currentUser=e,this.cdr.detectChanges()}),console.log("\u2705 [DashboardComponent] Usuario actual cargado:",e.email);let a=this.directAuthService.getCurrentProfile();a?(this.ngZone.run(()=>{this.userProfile=a,this.cdr.detectChanges()}),console.log("\u2705 [DashboardComponent] Perfil del usuario cargado:",a.rol),this.loadRoleSpecificData()):(console.warn("\u26A0\uFE0F [DashboardComponent] No se pudo cargar el perfil del usuario"),this.loadFallbackUserData())}else console.warn("\u26A0\uFE0F [DashboardComponent] No hay usuario autenticado - usando datos por defecto"),this.loadFallbackUserData()}catch(e){console.error("\u274C [DashboardComponent] Error cargando datos del usuario:",e),this.loadFallbackUserData()}})}loadDataWithErrorHandling(){return f(this,null,function*(){let e=[this.loadUserDataSafely(),this.loadRealDashboardDataSafely()];(yield Promise.allSettled(e)).forEach((t,s)=>{t.status==="rejected"&&console.warn(`\u26A0\uFE0F [DashboardComponent] Error cargando ${s===0?"datos de usuario":"datos del dashboard"}:`,t.reason)})})}loadRealDashboardDataSafely(){return f(this,null,function*(){try{console.log("\u{1F4CA} [Dashboard] Cargando datos reales del dashboard..."),yield this.dashboardService.loadDashboardData(),this.dashboardService.stats$.subscribe({next:e=>{this.ngZone.run(()=>{this.updateStatsFromService(e),this.cdr.detectChanges()})},error:e=>{console.error("\u274C [DashboardComponent] Error en stats$:",e),this.loadFallbackStats()}}),this.dashboardService.charts$.subscribe({next:e=>{this.ngZone.run(()=>{console.log("\u{1F4C8} [Dashboard] Datos de gr\xE1ficos recibidos:",e),this.updateChartsFromService(e),setTimeout(()=>this.initializeCharts(),100),this.cdr.detectChanges()})},error:e=>{console.error("\u274C [DashboardComponent] Error en charts$:",e),this.loadFallbackCharts(),setTimeout(()=>this.initializeCharts(),100)}}),console.log("\u2705 [Dashboard] Datos reales del dashboard cargados")}catch(e){console.error("\u274C [Dashboard] Error cargando datos reales del dashboard:",e),yield this.loadDashboardDataSafely()}})}loadDashboardDataSafely(){return f(this,null,function*(){try{this.kpisService.isServiceInitialized()?console.log("\u2705 [Dashboard] Servicio ya inicializado, suscribiendo a datos..."):(console.warn("\u26A0\uFE0F [Dashboard] Servicio KpisService no est\xE1 inicializado, esperando..."),yield this.kpisService.initialize().then(()=>{console.log("\u2705 [Dashboard] Servicio inicializado, cargando datos...")}).catch(e=>{throw console.error("\u274C [Dashboard] Error en inicializaci\xF3n tard\xEDa:",e),e})),this.kpisService.dashboardKPIs$.pipe(Fe(this.destroy$)).subscribe({next:e=>{this.dashboardKPIs=e,this.updateStats(),this.updateCharts()},error:e=>{console.error("\u274C [Dashboard] Error en dashboardKPIs$:",e),this.loadFallbackStats()}}),this.kpisService.alertas$.pipe(Fe(this.destroy$)).subscribe({next:e=>{this.alertas=e,this.stats.alertasActivas=e.length},error:e=>{console.error("\u274C [Dashboard] Error en alertas$:",e),this.alertas=[],this.stats.alertasActivas=0}}),yield this.loadActivityStatsSafely()}catch(e){throw this.loadFallbackData(),e}})}loadRoleSpecificData(){if(!this.userProfile?.rol){console.warn("\u26A0\uFE0F [DashboardComponent] No se puede cargar datos espec\xEDficos del rol: perfil no disponible");return}console.log("\u{1F4CB} [DashboardComponent] Cargando datos espec\xEDficos para el rol:",this.userProfile.rol)}loadActivityStatsSafely(){return f(this,null,function*(){try{console.log("\u{1F50D} [DASHBOARD] Iniciando carga de estad\xEDsticas de actividades..."),console.log("\u{1F50D} [DASHBOARD] Estado del observable actividades$:",this.actividadesService.actividades$);let e=yield this.actividadesService.actividades$.pipe(L(1)).toPromise();console.log("\u{1F50D} [DASHBOARD] Actividades recibidas del observable:",e),console.log("\u{1F50D} [DASHBOARD] Tipo de datos:",typeof e),console.log("\u{1F50D} [DASHBOARD] Es array:",Array.isArray(e)),console.log("\u{1F50D} [DASHBOARD] Longitud:",e?e.length:"null/undefined"),e?(this.stats.totalActividades=e.length,this.stats.actividadesCompletadas=e.filter(a=>a.estado==="finalizado").length,this.stats.actividadesEnProgreso=e.filter(a=>a.estado==="ejecucion").length,console.log("\u{1F50D} [DASHBOARD] Estad\xEDsticas calculadas:",{total:this.stats.totalActividades,completadas:this.stats.actividadesCompletadas,enProgreso:this.stats.actividadesEnProgreso}),e.length>0&&(this.stats.progresoPromedio=Math.round(this.stats.actividadesCompletadas/e.length*100),console.log("\u{1F50D} [DASHBOARD] Progreso promedio calculado:",this.stats.progresoPromedio+"%"))):(console.warn("\u26A0\uFE0F [DASHBOARD] No se recibieron actividades del observable"),this.loadFallbackActivityStats())}catch(e){console.error("\u274C [DASHBOARD] Error loading activity stats:",e),this.loadFallbackActivityStats()}})}loadFallbackData(){console.log("\u{1F504} [Dashboard] Cargando datos de respaldo..."),this.loadFallbackUserData(),this.loadFallbackStats(),this.loadFallbackCharts()}loadFallbackUserData(){this.currentUser={email:"usuario@ejemplo.com"},this.userProfile={rol:"residente",nombre:"Usuario"}}loadFallbackStats(){this.stats={totalActividades:0,actividadesCompletadas:0,actividadesEnProgreso:0,progresoPromedio:0,alertasActivas:0,kpisCriticos:0,actividadesCampo:0,evaluacionesPersonal:0,progresoObra:0,incidentesSeguridad:0}}loadFallbackActivityStats(){this.stats.totalActividades=0,this.stats.actividadesCompletadas=0,this.stats.actividadesEnProgreso=0,this.stats.progresoPromedio=0}loadFallbackCharts(){this.progressChartData={labels:["Sin datos"],datasets:[]},this.kpiChartData={labels:["Sin datos"],datasets:[]},this.activityChartData={labels:["Sin datos"],datasets:[]},this.costChartData={labels:["Sin datos"],datasets:[]},this.planificacionChartData={labels:["Sin datos"],datasets:[]}}updateStats(){this.dashboardKPIs?(this.stats.kpisCriticos=this.dashboardKPIs.rendimiento.criticos+this.dashboardKPIs.calidad.criticos+this.dashboardKPIs.seguridad.criticos+this.dashboardKPIs.costo.criticos+this.dashboardKPIs.tiempo.criticos,console.log("\u{1F4CA} Estad\xEDsticas actualizadas con datos reales:",{kpisCriticos:this.stats.kpisCriticos,alertasActivas:this.stats.alertasActivas,rendimiento:this.dashboardKPIs.rendimiento.promedio,calidad:this.dashboardKPIs.calidad.promedio})):(console.warn("\u26A0\uFE0F No hay datos de KPIs disponibles en la base de datos"),console.log("\u{1F4A1} Esto puede ocurrir si:"),console.log("   - No hay obras asignadas al usuario"),console.log("   - No hay actividades registradas en las obras"),console.log("   - Los KPIs autom\xE1ticos a\xFAn no se han calculado"),this.stats.kpisCriticos=0,console.log("\u{1F4CA} Estad\xEDsticas inicializadas con valores por defecto:",this.stats))}initializeCharts(){return f(this,null,function*(){console.log("\u{1F4CA} [Dashboard] Inicializando gr\xE1ficos..."),this.destroyCharts(),setTimeout(()=>f(this,null,function*(){try{this.userProfile?.rol==="residente"?(this.createCampoChart(),this.createEvaluacionChart(),yield this.createProgressChart()):this.userProfile?.rol==="logistica"&&(this.createObrasChart(),this.createCostChart(),this.createPlanificacionChart()),console.log("\u2705 [Dashboard] Gr\xE1ficos inicializados correctamente")}catch(e){console.error("\u274C [Dashboard] Error inicializando gr\xE1ficos:",e)}}),100)})}updateCharts(){return f(this,null,function*(){console.log("\u{1F504} [Dashboard] Actualizando gr\xE1ficos..."),yield this.initializeCharts()})}createProgressChart(){return f(this,null,function*(){let e=document.getElementById("progresoChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas progresoChart no encontrado");return}this.progressChart&&this.progressChart.destroy();let a=e.getContext("2d");if(!a)return;let t=yield this.getProgresoSemanalData();t.labels.length||(t=yield this.generateProgressFromActivities()),this.progressChart=new R(a,{type:"line",data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(s){return s+"%"}}}},plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(s){return`${s.dataset.label}: ${s.parsed.y}%`}}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de progreso semanal creado con datos reales")})}getProgresoSemanalData(){return f(this,null,function*(){try{return this.progressChartData&&this.progressChartData.labels.length>0?this.progressChartData:yield this.generateProgressFromActivities()}catch(e){return console.error("\u274C [Dashboard] Error obteniendo datos de progreso semanal:",e),yield this.generateProgressFromActivities()}})}generateProgressFromActivities(){return f(this,null,function*(){try{let e=yield this.actividadesService.actividades$.pipe(L(1)).toPromise();if(!e||e.length===0)return{labels:["Sin datos"],datasets:[{label:"Progreso de Obra (%)",data:[0],borderColor:"#4caf50",backgroundColor:"rgba(76, 175, 80, 0.1)",borderWidth:3,fill:!0,tension:.4}]};let a=[],t=[],s=new Date;for(let l=7;l>=0;l--){let p=new Date(s);p.setDate(s.getDate()-l*7);let g=new Date(p);g.setDate(p.getDate()-p.getDay()),g.setHours(0,0,0,0);let m=new Date(g);m.setDate(g.getDate()+6),m.setHours(23,59,59,999);let C=`Sem ${8-l}`;a.push(C);let h=e.filter(M=>new Date(M.fecha_fin||M.updated_at||M.created_at)<=m),v=h.filter(M=>M.estado==="finalizado").length,y=h.length>0?Math.round(v/e.length*100):0;t.push(y)}return{labels:a,datasets:[{label:"Progreso de Obra (%)",data:t,borderColor:"#4caf50",backgroundColor:"rgba(76, 175, 80, 0.1)",borderWidth:3,fill:!0,tension:.4}]}}catch(e){console.error("\u274C [Dashboard] Error generando progreso desde actividades:",e);let a=this.getOverallProgress(),t=["Sem 1","Sem 2","Sem 3","Sem 4","Sem 5","Sem 6","Sem 7","Sem 8"],s=[];for(let l=0;l<8;l++){let p=Math.round(a/8*(l+1));s.push(Math.min(p,a))}return{labels:t,datasets:[{label:"Progreso de Obra (%)",data:s,borderColor:"#4caf50",backgroundColor:"rgba(76, 175, 80, 0.1)",borderWidth:3,fill:!0,tension:.4}]}}})}createKPIChart(){let e=document.getElementById("kpiChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas kpiChart no encontrado");return}this.kpiChart&&this.kpiChart.destroy();let a=e.getContext("2d");if(!a)return;let t=this.kpiChartData;if(!t.labels.length){let s=["Calidad","Tiempo","Costo","Seguridad"],l=[85,78,92,88],p=["#4caf50","#2196f3","#ff9800","#f44336"];t={labels:s,datasets:[{label:"KPI (%)",data:l,backgroundColor:p,borderColor:p,borderWidth:1}]}}this.kpiChart=new R(a,{type:"doughnut",data:t,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de KPIs creado")}createActivityChart(){let e=document.getElementById("actividadesChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas actividadesChart no encontrado");return}this.activityChart&&this.activityChart.destroy();let a=e.getContext("2d");if(!a)return;let t=this.activityChartData;t.labels.length||(t={labels:["Ene","Feb","Mar","Abr","May","Jun"],datasets:[{label:"Completadas",data:[12,18,25,32,28,35],backgroundColor:"#4caf50",borderColor:"#4caf50",borderWidth:1},{label:"Pendientes",data:[8,12,15,18,22,15],backgroundColor:"#ff9800",borderColor:"#ff9800",borderWidth:1}]}),this.activityChart=new R(a,{type:"bar",data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},plugins:{legend:{position:"top",labels:{padding:20,usePointStyle:!0}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de actividades creado")}createCostChart(){let e=document.getElementById("costosChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas costosChart no encontrado");return}this.costChart&&this.costChart.destroy();let a=e.getContext("2d");if(!a)return;let t=this.costChartData;t.labels.length||(t={labels:["Ene","Feb","Mar","Abr","May","Jun"],datasets:[{label:"Presupuestado",data:[85e4,92e4,11e5,125e4,14e5,155e4],backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"Ejecutado",data:[78e4,89e4,105e4,118e4,132e4,148e4],backgroundColor:"rgba(255, 99, 132, 0.6)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]}),this.costChart=new R(a,{type:"bar",data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(s){return"$"+(Number(s)/1e3).toFixed(0)+"K"}}}},plugins:{legend:{position:"top",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(s){return s.dataset.label+": $"+s.parsed.y.toLocaleString()}}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de costos creado")}createPlanificacionChart(){let e=document.getElementById("planificacionChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas planificacionChart no encontrado");return}this.planificacionChart&&this.planificacionChart.destroy();let a=e.getContext("2d");if(!a)return;let t=this.planificacionChartData;t.labels.length||(t={labels:["Ene","Feb","Mar","Abr","May","Jun"],datasets:[{label:"Avance Planificado",data:[15,28,42,58,75,90],borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:2,fill:!1,tension:.4},{label:"Avance Real",data:[12,25,38,52,68,85],borderColor:"rgba(255, 159, 64, 1)",backgroundColor:"rgba(255, 159, 64, 0.2)",borderWidth:2,fill:!1,tension:.4}]}),this.planificacionChart=new R(a,{type:"line",data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(s){return s+"%"}}}},plugins:{legend:{position:"top",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(s){return s.dataset.label+": "+s.parsed.y+"%"}}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de planificaci\xF3n creado")}createCampoChart(){let e=document.getElementById("campoChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas campoChart no encontrado");return}this.campoChart&&this.campoChart.destroy();let a=e.getContext("2d");if(!a)return;let t={labels:["Excavaci\xF3n","Cimentaci\xF3n","Estructura","Acabados"],datasets:[{label:"Actividades Completadas",data:[12,8,15,6],backgroundColor:["rgba(76, 175, 80, 0.8)","rgba(33, 150, 243, 0.8)","rgba(255, 152, 0, 0.8)","rgba(156, 39, 176, 0.8)"],borderColor:["rgba(76, 175, 80, 1)","rgba(33, 150, 243, 1)","rgba(255, 152, 0, 1)","rgba(156, 39, 176, 1)"],borderWidth:2}]};this.campoChart=new R(a,{type:"doughnut",data:t,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(s){return s.label+": "+s.parsed+" actividades"}}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de campo creado")}createEvaluacionChart(){let e=document.getElementById("evaluacionChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas evaluacionChart no encontrado");return}this.evaluacionChart&&this.evaluacionChart.destroy();let a=e.getContext("2d");if(!a)return;let t={labels:["Excelente","Bueno","Regular","Deficiente"],datasets:[{label:"Evaluaciones",data:[25,45,20,10],backgroundColor:["rgba(76, 175, 80, 0.8)","rgba(33, 150, 243, 0.8)","rgba(255, 193, 7, 0.8)","rgba(244, 67, 54, 0.8)"],borderColor:["rgba(76, 175, 80, 1)","rgba(33, 150, 243, 1)","rgba(255, 193, 7, 1)","rgba(244, 67, 54, 1)"],borderWidth:2}]};this.evaluacionChart=new R(a,{type:"bar",data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{callback:function(s){return s+"%"}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(s){return s.label+": "+s.parsed.y+"%"}}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de evaluaciones creado")}createObrasChart(){let e=document.getElementById("obrasChart");if(!e){console.warn("\u26A0\uFE0F [Dashboard] Canvas obrasChart no encontrado");return}this.obrasChart&&this.obrasChart.destroy();let a=e.getContext("2d");if(!a)return;let t={labels:["En Progreso","Completadas","Pausadas","Planificadas"],datasets:[{label:"Actividades",data:[8,12,3,5],backgroundColor:["rgba(33, 150, 243, 0.8)","rgba(76, 175, 80, 0.8)","rgba(255, 193, 7, 0.8)","rgba(156, 39, 176, 0.8)"],borderColor:["rgba(33, 150, 243, 1)","rgba(76, 175, 80, 1)","rgba(255, 193, 7, 1)","rgba(156, 39, 176, 1)"],borderWidth:2}]};this.obrasChart=new R(a,{type:"pie",data:t,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(s){return s.label+": "+s.parsed+" actividades"}}}}}}),console.log("\u2705 [Dashboard] Gr\xE1fico de actividades creado")}destroyCharts(){this.progressChart&&(this.progressChart.destroy(),this.progressChart=null),this.kpiChart&&(this.kpiChart.destroy(),this.kpiChart=null),this.activityChart&&(this.activityChart.destroy(),this.activityChart=null),this.costChart&&(this.costChart.destroy(),this.costChart=null),this.planificacionChart&&(this.planificacionChart.destroy(),this.planificacionChart=null),this.campoChart&&(this.campoChart.destroy(),this.campoChart=null),this.evaluacionChart&&(this.evaluacionChart.destroy(),this.evaluacionChart=null),this.obrasChart&&(this.obrasChart.destroy(),this.obrasChart=null)}getStatusColor(e){switch(e){case"excelente":return"success";case"normal":return"primary";case"alerta":return"warn";case"critico":return"danger";default:return"primary"}}getStatusIcon(e){switch(e){case"excelente":return"trending_up";case"normal":return"trending_flat";case"alerta":return"warning";case"critico":return"error";default:return"info"}}getGreeting(){let e=new Date().getHours();return e<12?"Buenos d\xEDas":e<18?"Buenas tardes":"Buenas noches"}refreshData(){return f(this,null,function*(){try{this.isLoading=!0,yield this.dashboardService.refreshDashboard(),yield this.refreshKPIsData()}catch{yield this.loadDashboardDataSafely()}finally{this.isLoading=!1}})}navigateToSection(e){console.log("Navigating to:",e)}resolveAlert(e){console.log("Abriendo modal de detalle para alerta:",e),this.dialog.open(dn,{width:"600px",data:{alerta:e}}).afterClosed().subscribe(t=>{t&&t.action==="delete"&&this.deleteAlert(t.alerta)})}deleteAlert(e){console.log("Deleting alert:",e),this.alertas=this.alertas.filter(a=>a!==e),this.stats.alertasActivas=this.alertas.length}getOverallProgress(){return this.stats.totalActividades===0?0:Math.round(this.stats.actividadesCompletadas/this.stats.totalActividades*100)}getProgressColor(e){let a=e!==void 0?e:this.getOverallProgress();return a>=80?"primary":a>=60?"accent":"warn"}updateStatsFromService(e){this.stats={totalActividades:e.actividadesTotales||0,actividadesCompletadas:e.actividadesCompletadas||0,actividadesEnProgreso:e.actividadesEnProgreso||0,progresoPromedio:e.progresoPromedio||0,alertasActivas:0,kpisCriticos:e.kpisCriticos||0,actividadesCampo:e.actividadesTotales||0,evaluacionesPersonal:e.totalEvaluaciones||0,progresoObra:Math.round(e.progresoPromedio||0),incidentesSeguridad:0,obrasActivas:e.obrasActivas||0,presupuestoEjecutado:0,recursosAsignados:0,proyectosRetrasados:0},console.log("\u{1F4CA} Estad\xEDsticas actualizadas desde servicio:",this.stats)}updateChartsFromService(e){this.activityChartData=e.evaluacionesPorMes,this.costChartData=e.evidenciasPorObra,this.kpiChartData=e.kpisPorCategoria,this.progressChartData=e.progresoActividades,this.planificacionChartData=e.tendenciaCalidad,this.ngZone.runOutsideAngular(()=>{setTimeout(()=>f(this,null,function*(){this.ngZone.run(()=>f(this,null,function*(){this.destroyCharts(),this.createActivityChart(),this.createCostChart(),this.createKPIChart(),yield this.createProgressChart(),this.createPlanificacionChart(),this.cdr.detectChanges()}))}),200)}),console.log("\u{1F4C8} Gr\xE1ficos actualizados desde servicio")}getTrendIcon(e){switch(e){case"subiendo":return"trending_up";case"bajando":return"trending_down";case"estable":return"trending_flat";default:return"trending_flat"}}static{this.\u0275fac=function(a){return new(a||o)(P(A),P(Ie),P(nn),P(cn),P(ae),P(T),P(Jt))}}static{this.\u0275cmp=W({type:o,selectors:[["app-dashboard"]],decls:26,vars:13,consts:[["alertMenu","matMenu"],[1,"dashboard-container"],[1,"dashboard-header"],[1,"welcome-section"],[1,"welcome-title"],[1,"welcome-subtitle"],[1,"header-actions"],["mat-icon-button","","matTooltip","Actualizar datos",3,"click"],["mat-icon-button","","matBadgeColor","warn","matTooltip","Alertas",3,"matMenuTriggerFor","matBadge","matBadgeHidden"],[1,"alert-menu"],["mat-menu-item","","disabled","",1,"alert-header"],["mat-menu-item","","disabled","","class","no-alerts",4,"ngIf"],["mat-menu-item","","class","alert-item",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-menu-item","","routerLink","/alertas",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","dashboard-content",4,"ngIf"],["mat-menu-item","","disabled","",1,"no-alerts"],["mat-menu-item","",1,"alert-item"],[1,"alert-content"],[1,"alert-title"],[1,"alert-description"],[1,"alert-time"],[1,"alert-menu-actions"],["mat-icon-button","","matTooltip","Ver detalles",3,"click"],["mat-icon-button","","matTooltip","Eliminar alerta","color","warn",3,"click"],["mat-menu-item","","routerLink","/alertas"],[1,"loading-container"],["mode","indeterminate"],[1,"dashboard-content"],["class","stats-grid",4,"ngIf"],[1,"progress-card"],[1,"progress-info"],[1,"progress-value"],[1,"progress-description"],[1,"progress-bar",3,"value","color"],["class","charts-grid",4,"ngIf"],["class","kpis-card",4,"ngIf"],["class","actions-card",4,"ngIf"],["class","alerts-card",4,"ngIf"],[1,"stats-grid"],[1,"stat-card","primary"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"stat-card","success"],[1,"stat-card","info"],[1,"stat-card","warning"],[1,"charts-grid"],[1,"chart-card"],[1,"chart-container"],["id","campoChart"],["id","evaluacionChart"],[1,"chart-card","full-width"],["id","progresoChart"],["id","obrasChart"],["id","costosChart"],["id","planificacionChart"],[1,"kpis-card"],[1,"kpis-grid"],[1,"kpi-item"],[1,"kpi-header"],[1,"kpi-icon"],[1,"kpi-title"],[1,"kpi-value"],[1,"value"],[1,"trend-icon"],[1,"kpi-progress"],["mode","determinate",3,"value","color"],[1,"actions-card"],[1,"actions-grid"],["mat-raised-button","","color","primary","routerLink","/actividades",1,"action-button"],["mat-raised-button","","color","accent","routerLink","/evaluaciones",1,"action-button"],["mat-raised-button","","color","warn","routerLink","/mapa",1,"action-button"],["mat-raised-button","","routerLink","/reportes",1,"action-button"],["mat-raised-button","","routerLink","/actividades",1,"action-button"],["mat-raised-button","","routerLink","/evaluaciones",1,"action-button"],["mat-raised-button","","routerLink","/dashboard-kilometrico",1,"action-button"],["mat-raised-button","","color","primary","routerLink","/obras",1,"action-button"],["mat-raised-button","","color","accent","routerLink","/reportes",1,"action-button"],["mat-raised-button","","color","warn","routerLink","/actividades",1,"action-button"],["mat-raised-button","","routerLink","/mapa",1,"action-button"],["mat-raised-button","","routerLink","/obras",1,"action-button"],[1,"alerts-card"],[1,"alerts-list"],["class","alert-item-card",4,"ngFor","ngForOf"],["class","alerts-footer",4,"ngIf"],[1,"alert-item-card"],[1,"alert-icon"],[1,"alert-warning"],[1,"alert-meta"],["color","warn","selected","","size","small"],[1,"alert-actions"],[1,"alerts-footer"],["mat-button","","routerLink","/alertas"]],template:function(a,t){if(a&1){let s=ee();i(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),r(4),n(),i(5,"p",5),r(6),n()(),i(7,"div",6)(8,"button",7),D("click",function(){return B(s),G(t.refreshData())}),i(9,"mat-icon"),r(10,"refresh"),n()(),i(11,"button",8)(12,"mat-icon"),r(13,"notifications"),n()(),i(14,"mat-menu",9,0)(16,"div",10)(17,"strong"),r(18),n()(),x(19,"mat-divider"),O(20,Fn,5,0,"div",11)(21,zn,16,6,"div",12)(22,Ln,1,0,"mat-divider",13)(23,jn,3,0,"div",14),n()()(),O(24,Kn,4,0,"div",15)(25,Jn,21,14,"div",16),n()}if(a&2){let s=it(15);c(4),be(" ",t.getGreeting(),", ",(t.userProfile==null?null:t.userProfile.nombre)||(t.currentUser==null?null:t.currentUser.email)||"Usuario"," "),c(2),b(" ",(t.userProfile==null?null:t.userProfile.rol)==="residente"?"Residente de Obra":"Produccion"," "),c(5),u("matMenuTriggerFor",s)("matBadge",t.alertas.length)("matBadgeHidden",t.alertas.length===0),c(7),b("Alertas Activas (",t.alertas.length,")"),c(2),u("ngIf",t.alertas.length===0),c(),u("ngForOf",t.alertas.slice(0,5)),c(),u("ngIf",t.alertas.length>0),c(),u("ngIf",t.alertas.length>5),c(),u("ngIf",t.isLoading),c(),u("ngIf",!t.isLoading)}},dependencies:[$,dt,V,ct,Ce,ie,_e,Me,ye,Se,Pe,Z,re,oe,Y,q,Kt,jt,Ee,Oe,Ut,Nt,Vt,Gt,Bt,Wt,ke,we,Ht,$t,vt,xe],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:24px;background-color:#f8f9fa;min-height:100vh}.dashboard-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;background:#fff;color:#1e3a8a;padding:24px;border-radius:12px;box-shadow:0 4px 20px #0000001a;border:1px solid #e5e7eb}.welcome-section[_ngcontent-%COMP%]{flex:1}.welcome-title[_ngcontent-%COMP%]{font-size:28px;font-weight:600;margin:0 0 8px;text-shadow:0 2px 4px rgba(0,0,0,.2)}.welcome-subtitle[_ngcontent-%COMP%]{font-size:16px;opacity:.9;margin:0;font-weight:300}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#1e3a8a}.alert-menu[_ngcontent-%COMP%]{max-width:400px}.alert-header[_ngcontent-%COMP%]{padding:16px!important;font-weight:600;color:#333}.no-alerts[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#666;padding:16px!important}.alert-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;padding:12px 16px!important;border-bottom:1px solid #eee}.alert-title[_ngcontent-%COMP%]{font-weight:600;font-size:14px;margin-bottom:4px}.alert-description[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-bottom:4px}.alert-time[_ngcontent-%COMP%]{font-size:11px;color:#999}.resolve-btn[_ngcontent-%COMP%]{width:24px;height:24px;line-height:24px}.alert-menu-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.alert-menu-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#666;transition:color .3s ease}.alert-menu-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#2196f3}.alert-menu-actions[_ngcontent-%COMP%]   button[color=warn][_ngcontent-%COMP%]:hover{color:#f44336}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:48px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.dashboard-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}.stat-card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease;cursor:pointer}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #00000026}.stat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:20px!important}.stat-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px;color:#fff}.stat-info[_ngcontent-%COMP%]{flex:1}.stat-value[_ngcontent-%COMP%]{font-size:32px;font-weight:700;line-height:1;margin-bottom:4px}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:#666;font-weight:500}.stat-card.primary[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:#1e3a8a}.stat-card.primary[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#1e3a8a}.stat-card.success[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:#059669}.stat-card.success[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#059669}.stat-card.info[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:#0284c7}.stat-card.info[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#0284c7}.stat-card.warning[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:#dc2626}.stat-card.warning[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#dc2626}.progress-card[_ngcontent-%COMP%]{background:#fff;color:#1e3a8a;border:1px solid #e5e7eb}.progress-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{color:#1e3a8a}.progress-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{color:#1e3a8a!important;font-size:20px;font-weight:600}.progress-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.progress-value[_ngcontent-%COMP%]{font-size:48px;font-weight:700;line-height:1}.progress-description[_ngcontent-%COMP%]{font-size:14px;opacity:.9;text-align:right}.progress-bar[_ngcontent-%COMP%]{height:8px;border-radius:4px;background-color:#e5e7eb}.charts-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(300px,1fr));gap:24px}.chart-card[_ngcontent-%COMP%]{overflow:hidden;transition:all .3s ease}.chart-card.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.chart-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:20px!important;overflow:hidden}.chart-container[_ngcontent-%COMP%]{position:relative;height:350px;width:100%;min-height:250px;max-height:500px;overflow:hidden}.kpis-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}.kpi-item[_ngcontent-%COMP%]{padding:20px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;transition:all .2s ease;box-shadow:0 1px 3px #0000001a}.kpi-item[_ngcontent-%COMP%]:hover{background:#f8f9fa;border-color:#1e3a8a;box-shadow:0 4px 6px #0000001a}.kpi-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.kpi-name[_ngcontent-%COMP%]{font-weight:600;font-size:16px}.kpi-values[_ngcontent-%COMP%]{margin-bottom:12px}.kpi-current[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#1e3a8a;margin-bottom:4px}.kpi-target[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.kpi-progress[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.kpi-progress[_ngcontent-%COMP%]   mat-progress-bar[_ngcontent-%COMP%]{flex:1;height:6px;border-radius:3px}.kpi-percentage[_ngcontent-%COMP%]{font-size:12px;font-weight:600;color:#666;min-width:40px;text-align:right}.actions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}.action-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;padding:20px 16px!important;height:auto!important;min-height:80px;border-radius:12px!important;transition:all .2s ease}.action-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #00000026}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px}.action-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;font-weight:500;text-align:center}.alerts-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.alert-item-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px;padding:16px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;transition:all .2s ease}.alert-item-card[_ngcontent-%COMP%]:hover{background:#f8f9fa;border-color:#1e3a8a}.alert-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}.alert-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:#fff}.alert-critico[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{background-color:#f44336}.alert-alerta[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{background-color:#ff9800}.alert-normal[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{background-color:#4caf50}.alert-content[_ngcontent-%COMP%]{flex:1}.alert-title[_ngcontent-%COMP%]{font-weight:600;font-size:16px;margin-bottom:4px;color:#333}.alert-description[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:8px;line-height:1.4}.alert-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.alert-time[_ngcontent-%COMP%]{font-size:12px;color:#999}.alert-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.alerts-footer[_ngcontent-%COMP%]{margin-top:16px;text-align:center;border-top:1px solid #e5e7eb;padding-top:16px}.alerts-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 2px 8px #0000001a!important;border-radius:12px!important}.mat-mdc-progress-bar[_ngcontent-%COMP%]{--mdc-linear-progress-track-height: 6px}mat-card[_ngcontent-%COMP%]{border-radius:12px!important;box-shadow:0 2px 12px #00000014!important;transition:all .2s ease}mat-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 20px #0000001f!important}mat-card-header[_ngcontent-%COMP%]{padding-bottom:16px!important}mat-card-title[_ngcontent-%COMP%]{font-size:18px!important;font-weight:600!important;color:#1e3a8a!important}mat-card-subtitle[_ngcontent-%COMP%]{font-size:14px!important;color:#6b7280!important;margin-top:4px!important}@media (max-width: 1024px) and (min-width: 769px){.charts-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}.chart-container[_ngcontent-%COMP%]{height:320px;min-height:220px;max-height:400px}.chart-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:18px!important}}@media (max-width: 768px){.dashboard-container[_ngcontent-%COMP%]{padding:16px;overflow-x:hidden}.dashboard-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px;text-align:center;padding:20px 16px;margin-bottom:24px}.header-actions[_ngcontent-%COMP%]{justify-content:center;flex-wrap:wrap}.welcome-title[_ngcontent-%COMP%]{font-size:22px}.welcome-subtitle[_ngcontent-%COMP%]{font-size:14px}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px}.stat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px!important}.stat-icon[_ngcontent-%COMP%]{width:50px;height:50px}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.stat-value[_ngcontent-%COMP%]{font-size:28px}.stat-label[_ngcontent-%COMP%]{font-size:13px}.charts-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}.chart-container[_ngcontent-%COMP%]{height:280px;min-height:200px;max-height:320px}.chart-card[_ngcontent-%COMP%]{margin-bottom:12px}.chart-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px!important}.kpis-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px}.kpi-item[_ngcontent-%COMP%]{padding:16px}.actions-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}.action-btn[_ngcontent-%COMP%]{padding:16px 12px!important;min-height:70px}.progress-info[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:12px}.progress-value[_ngcontent-%COMP%]{font-size:40px}.progress-description[_ngcontent-%COMP%]{text-align:center;font-size:13px}}@media (max-width: 480px){.dashboard-container[_ngcontent-%COMP%]{padding:12px;overflow-x:hidden}.dashboard-header[_ngcontent-%COMP%]{padding:16px 12px;margin-bottom:20px}.welcome-title[_ngcontent-%COMP%]{font-size:20px}.welcome-subtitle[_ngcontent-%COMP%]{font-size:13px}.header-actions[_ngcontent-%COMP%]{gap:8px}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.stat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:14px!important;gap:12px}.stat-icon[_ngcontent-%COMP%]{width:45px;height:45px}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px;width:22px;height:22px}.stat-value[_ngcontent-%COMP%]{font-size:24px}.stat-label[_ngcontent-%COMP%]{font-size:12px}.charts-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.chart-container[_ngcontent-%COMP%]{height:250px;min-height:180px;max-height:300px}.chart-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:12px!important}.chart-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:16px!important}.kpis-grid[_ngcontent-%COMP%]{gap:12px}.kpi-item[_ngcontent-%COMP%]{padding:14px}.kpi-name[_ngcontent-%COMP%]{font-size:14px}.kpi-current[_ngcontent-%COMP%]{font-size:20px}.kpi-target[_ngcontent-%COMP%]{font-size:11px}.actions-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:10px}.action-btn[_ngcontent-%COMP%]{padding:14px 10px!important;min-height:60px}.action-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.action-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px}.progress-value[_ngcontent-%COMP%]{font-size:36px}.progress-description[_ngcontent-%COMP%]{font-size:12px}.alert-item-card[_ngcontent-%COMP%]{flex-direction:column;text-align:center;padding:12px}.alert-meta[_ngcontent-%COMP%]{justify-content:center}.alert-title[_ngcontent-%COMP%]{font-size:14px}.alert-description[_ngcontent-%COMP%]{font-size:12px}button[_ngcontent-%COMP%]{min-height:44px}*[_ngcontent-%COMP%]{max-width:100%;box-sizing:border-box}}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.dashboard-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .6s ease-out}.dashboard-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){animation-delay:.1s}.dashboard-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.dashboard-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(3){animation-delay:.3s}.dashboard-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(4){animation-delay:.4s}.dashboard-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(5){animation-delay:.5s}"]})}}return o})();var _=(()=>{class o{constructor(e,a){this.directAuthService=e,this.router=a}canActivate(e,a){try{return this.directAuthService.getCurrentUser()?!0:(console.log("\u{1F512} Usuario no autenticado, redirigiendo al login con returnUrl:",a.url),this.router.navigate(["/login"],{queryParams:{returnUrl:a.url}}),!1)}catch(t){return console.error("Error en DirectAuthGuard:",t),this.router.navigate(["/login"],{queryParams:{returnUrl:a.url}}),!1}}static{this.\u0275fac=function(a){return new(a||o)(k(A),k(H))}}static{this.\u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Be=(()=>{class o{constructor(e,a){this.directAuthService=e,this.router=a}canActivate(e){let a=e.data.roles,t=this.directAuthService.getCurrentProfile();return t?a&&!a.includes(t.rol)?(this.router.navigate(["/unauthorized"]),new K(s=>{s.next(!1),s.complete()})):new K(s=>{s.next(!0),s.complete()}):(this.router.navigate(["/login"]),new K(s=>{s.next(!1),s.complete()}))}static{this.\u0275fac=function(a){return new(a||o)(k(A),k(H))}}static{this.\u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var pn=[{path:"",redirectTo:"/login",pathMatch:"full"},{path:"login",component:sn,title:"Sistema de Gesti\xF3n - Iniciar Sesi\xF3n"},{path:"register",loadComponent:()=>import("./chunk-DQFMA7ZA.js").then(o=>o.RegisterComponent),title:"Registro - Sistema de Gesti\xF3n"},{path:"dashboard",component:ln,canActivate:[_],title:"Dashboard - Sistema de Gesti\xF3n de Rendimiento"},{path:"main",loadComponent:()=>import("./chunk-KJIR4ADE.js").then(o=>o.MainComponent),canActivate:[_,Be],data:{roles:["residente"]},title:"Generador de Reportes por Partida"},{path:"actividades",loadComponent:()=>import("./chunk-6IFRXPMC.js").then(o=>o.ActividadesComponent),canActivate:[_],title:"Registro de Actividades"},{path:"actividades/nueva",loadComponent:()=>import("./chunk-RMAHFNCC.js").then(o=>o.NuevaActividadComponent),canActivate:[_],title:"Nueva Actividad"},{path:"actividades/editar/:id",loadComponent:()=>import("./chunk-NVVF77KA.js").then(o=>o.EditarActividadComponent),canActivate:[_],title:"Editar Actividad"},{path:"actividades/:id",loadComponent:()=>import("./chunk-ZQ6U6ITH.js").then(o=>o.DetalleActividadComponent),canActivate:[_],title:"Detalle de Actividad"},{path:"mapa",loadComponent:()=>import("./chunk-UNGNCLIS.js").then(o=>o.MapaComponent),canActivate:[_],title:"Mapa de Frentes"},{path:"frentes",loadComponent:()=>import("./chunk-UNGNCLIS.js").then(o=>o.MapaComponent),canActivate:[_],title:"Gesti\xF3n de Frentes"},{path:"frentes/nuevo",loadComponent:()=>import("./chunk-CZOAKV4K.js").then(o=>o.FrenteFormComponent),canActivate:[_],title:"Crear Nuevo Frente"},{path:"frentes/:id/editar",loadComponent:()=>import("./chunk-QU22C2HJ.js").then(o=>o.FrenteEditComponent),canActivate:[_],title:"Editar Frente"},{path:"evaluaciones",loadComponent:()=>import("./chunk-I5XO255H.js").then(o=>o.EvaluacionesComponent),canActivate:[_],title:"Evaluaciones de Personal"},{path:"evaluaciones/nueva",loadComponent:()=>import("./chunk-T2KY3ZIT.js").then(o=>o.NuevaEvaluacionComponent),canActivate:[_],title:"Nueva Evaluaci\xF3n"},{path:"reportes",loadComponent:()=>import("./chunk-NLFIV6DY.js").then(o=>o.ReportesComponent),canActivate:[_],title:"Reportes y Analytics"},{path:"reportes/exportar",loadComponent:()=>import("./chunk-W52WM7QW.js").then(o=>o.ExportarComponent),canActivate:[_],title:"Exportar Reportes"},{path:"generation",loadComponent:()=>import("./chunk-C6Q76DYA.js").then(o=>o.GenerationComponent),canActivate:[_],title:"Generaci\xF3n de Reportes"},{path:"partidas",loadComponent:()=>import("./chunk-Z3VHWAUS.js").then(o=>o.AdminItemsComponent),canActivate:[_],title:"Administraci\xF3n de Partidas"},{path:"obras",loadComponent:()=>import("./chunk-RAZBOQFM.js").then(o=>o.ObrasComponent),canActivate:[_],title:"Gesti\xF3n de Obras"},{path:"obras/:id",loadComponent:()=>import("./chunk-SXLD26VT.js").then(o=>o.DetalleObraComponent),canActivate:[_],title:"Configuraci\xF3n de Obra"},{path:"perfil",loadComponent:()=>import("./chunk-NBR25TN2.js").then(o=>o.PerfilComponent),canActivate:[_],title:"Perfil de Usuario"},{path:"usuarios",loadComponent:()=>import("./chunk-QSGBA5FS.js").then(o=>o.UsuariosComponent),canActivate:[_],title:"Gesti\xF3n de Usuarios"},{path:"usuarios/crear",loadComponent:()=>import("./chunk-ADYD5H7P.js").then(o=>o.CrearUsuarioComponent),canActivate:[_],title:"Crear Usuario"},{path:"usuarios/editar/:id",loadComponent:()=>import("./chunk-R4POFNIF.js").then(o=>o.EditarUsuarioComponent),canActivate:[_],title:"Editar Usuario"},{path:"kpis",loadComponent:()=>import("./chunk-2DBWFB7A.js").then(o=>o.KpisComponent),canActivate:[_],title:"Gesti\xF3n de KPIs"},{path:"dashboard-kilometrico",loadComponent:()=>import("./chunk-WRKVAITU.js").then(o=>o.DashboardKilometricoComponent),canActivate:[_]},{path:"admin-projects",loadComponent:()=>import("./chunk-O3JHD5W3.js").then(o=>o.AdminProjectsComponent),canActivate:[_,Be],data:{roles:["administrador","logistica"]},title:"Administraci\xF3n de Obras"},{path:"configuracion",loadComponent:()=>import("./chunk-WUUDVGUH.js").then(o=>o.ConfigurationComponent),canActivate:[_],title:"Configuraci\xF3n"},{path:"**",redirectTo:"/dashboard",pathMatch:"full"}];var Xn="@",Qn=(()=>{class o{doc;delegate;zone;animationType;moduleImpl;_rendererFactoryPromise=null;scheduler=null;injector=U(fe);loadingSchedulerFn=U(ea,{optional:!0});_engine;constructor(e,a,t,s,l){this.doc=e,this.delegate=a,this.zone=t,this.animationType=s,this.moduleImpl=l}ngOnDestroy(){this._engine?.flush()}loadImpl(){let e=()=>this.moduleImpl??import("./chunk-5JM7Y6DQ.js").then(t=>t),a;return this.loadingSchedulerFn?a=this.loadingSchedulerFn(e):a=e(),a.catch(t=>{throw new N(5300,!1)}).then(({\u0275createEngine:t,\u0275AnimationRendererFactory:s})=>{this._engine=t(this.animationType,this.doc);let l=new s(this.delegate,this._engine,this.zone);return this.delegate=l,l})}createRenderer(e,a){let t=this.delegate.createRenderer(e,a);if(t.\u0275type===0)return t;typeof t.throwOnSyntheticProps=="boolean"&&(t.throwOnSyntheticProps=!1);let s=new Ge(t);return a?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(l=>{let p=l.createRenderer(e,a);s.use(p),this.scheduler??=this.injector.get(Xe,null,{optional:!0}),this.scheduler?.notify(10)}).catch(l=>{s.use(t)}),s}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}componentReplaced(e){this._engine?.flush(),this.delegate.componentReplaced?.(e)}static \u0275fac=function(a){nt()};static \u0275prov=w({token:o,factory:o.\u0275fac})}return o})(),Ge=class{delegate;replay=[];\u0275type=1;constructor(d){this.delegate=d}use(d){if(this.delegate=d,this.replay!==null){for(let e of this.replay)e(d);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(d,e){return this.delegate.createElement(d,e)}createComment(d){return this.delegate.createComment(d)}createText(d){return this.delegate.createText(d)}get destroyNode(){return this.delegate.destroyNode}appendChild(d,e){this.delegate.appendChild(d,e)}insertBefore(d,e,a,t){this.delegate.insertBefore(d,e,a,t)}removeChild(d,e,a){this.delegate.removeChild(d,e,a)}selectRootElement(d,e){return this.delegate.selectRootElement(d,e)}parentNode(d){return this.delegate.parentNode(d)}nextSibling(d){return this.delegate.nextSibling(d)}setAttribute(d,e,a,t){this.delegate.setAttribute(d,e,a,t)}removeAttribute(d,e,a){this.delegate.removeAttribute(d,e,a)}addClass(d,e){this.delegate.addClass(d,e)}removeClass(d,e){this.delegate.removeClass(d,e)}setStyle(d,e,a,t){this.delegate.setStyle(d,e,a,t)}removeStyle(d,e,a){this.delegate.removeStyle(d,e,a)}setProperty(d,e,a){this.shouldReplay(e)&&this.replay.push(t=>t.setProperty(d,e,a)),this.delegate.setProperty(d,e,a)}setValue(d,e){this.delegate.setValue(d,e)}listen(d,e,a,t){return this.shouldReplay(e)&&this.replay.push(s=>s.listen(d,e,a,t)),this.delegate.listen(d,e,a,t)}shouldReplay(d){return this.replay!==null&&d.startsWith(Xn)}},ea=new ue("");function mn(o="animations"){return et("NgAsyncAnimations"),he([{provide:tt,useFactory:(d,e,a)=>new Qn(d,e,a,o),deps:[st,lt,T]},{provide:Qe,useValue:o==="noop"?"NoopAnimations":"BrowserAnimations"}])}var We="Service workers are disabled or not supported by this browser",se=class{serviceWorker;worker;registration;events;constructor(d,e){if(this.serviceWorker=d,!d)this.worker=this.events=this.registration=new K(a=>a.error(new N(5601,!1)));else{let a=null,t=new X;this.worker=new K(m=>(a!==null&&m.next(a),t.subscribe(C=>m.next(C))));let s=()=>{let{controller:m}=d;m!==null&&(a=m,t.next(a))};d.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(le(()=>d.getRegistration()));let l=new X;this.events=l.asObservable();let p=m=>{let{data:C}=m;C?.type&&l.next(C)};d.addEventListener("message",p),e?.get(ze,null,{optional:!0})?.onDestroy(()=>{d.removeEventListener("controllerchange",s),d.removeEventListener("message",p)})}}postMessage(d,e){return new Promise(a=>{this.worker.pipe(L(1)).subscribe(t=>{t.postMessage(Ve({action:d},e)),a()})})}postMessageWithOperation(d,e,a){let t=this.waitForOperationCompleted(a),s=this.postMessage(d,e);return Promise.all([s,t]).then(([,l])=>l)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(d){let e;return typeof d=="string"?e=a=>a.type===d:e=a=>d.includes(a.type),this.events.pipe(Re(e))}nextEventOfType(d){return this.eventsOfType(d).pipe(L(1))}waitForOperationCompleted(d){return new Promise((e,a)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(Re(t=>t.nonce===d),L(1),ce(t=>{if(t.result!==void 0)return t.result;throw new Error(t.error)})).subscribe({next:e,error:a})})}get isEnabled(){return!!this.serviceWorker}},ta=(()=>{class o{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new X;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=Q,this.notificationClicks=Q,this.subscription=Q;return}this.messages=this.sw.eventsOfType("PUSH").pipe(ce(t=>t.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(ce(t=>t.data)),this.pushManager=this.sw.registration.pipe(ce(t=>t.pushManager));let a=this.pushManager.pipe(le(t=>t.getSubscription()));this.subscription=new K(t=>{let s=a.subscribe(t),l=this.subscriptionChanges.subscribe(t);return()=>{s.unsubscribe(),l.unsubscribe()}})}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(We));let a={userVisibleOnly:!0},t=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(t.length));for(let l=0;l<t.length;l++)s[l]=t.charCodeAt(l);return a.applicationServerKey=s,new Promise((l,p)=>{this.pushManager.pipe(le(g=>g.subscribe(a)),L(1)).subscribe({next:g=>{this.subscriptionChanges.next(g),l(g)},error:p})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(We));let e=a=>{if(a===null)throw new N(5602,!1);return a.unsubscribe().then(t=>{if(!t)throw new N(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((a,t)=>{this.subscription.pipe(L(1),le(e)).subscribe({next:a,error:t})})}decodeBase64(e){return atob(e)}static \u0275fac=function(a){return new(a||o)(k(se))};static \u0275prov=w({token:o,factory:o.\u0275fac})}return o})(),na=(()=>{class o{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=Q,this.unrecoverable=Q;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(We));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new N(5601,!1));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(a){return new(a||o)(k(se))};static \u0275prov=w({token:o,factory:o.\u0275fac})}return o})();var un=new ue("");function aa(){let o=U(ge);if(!("serviceWorker"in navigator&&o.enabled!==!1))return;let d=U(un),e=U(T),a=U(ze);e.runOutsideAngular(()=>{let t=navigator.serviceWorker,s=()=>t.controller?.postMessage({action:"INITIALIZE"});t.addEventListener("controllerchange",s),a.onDestroy(()=>{t.removeEventListener("controllerchange",s)})}),e.runOutsideAngular(()=>{let t,{registrationStrategy:s}=o;if(typeof s=="function")t=new Promise(l=>s().subscribe(()=>l()));else{let[l,...p]=(s||"registerWhenStable:30000").split(":");switch(l){case"registerImmediately":t=Promise.resolve();break;case"registerWithDelay":t=gn(+p[0]||0);break;case"registerWhenStable":t=Promise.race([a.whenStable(),gn(+p[0])]);break;default:throw new N(5600,!1)}}t.then(()=>{a.destroyed||navigator.serviceWorker.register(d,{scope:o.scope}).catch(l=>console.error(Je(5604,!1)))})})}function gn(o){return new Promise(d=>setTimeout(d,o))}function ia(o,d){return new se(o.enabled!==!1?navigator.serviceWorker:void 0,d)}var ge=class{enabled;scope;registrationStrategy};function hn(o,d={}){return he([ta,na,{provide:un,useValue:o},{provide:ge,useValue:d},{provide:se,useFactory:ia,deps:[ge,fe]},at(aa)])}var fn=(()=>{class o{constructor(){this.maxRetries=3,this.retryDelay=1e3}intercept(e,a){return a.handle(e)}isLockError(e){if(!e)return!1;let a=e.message||e.error?.message||"";return a.includes("NavigatorLockAcquireTimeoutError")||a.includes("lock")||a.includes("timeout")||e.status===0&&a.includes("Unknown Error")}clearLocks(){try{console.log("\u{1F513} Interceptor: Limpiando locks..."),["lock:sb-auth-token","lock:sb-auth-token-resobra","sb-auth-token","supabase.auth.token","sb-"+window.location.hostname+"-auth-token"].forEach(a=>{try{localStorage.removeItem(a),sessionStorage.removeItem(a)}catch(t){console.warn(`\u26A0\uFE0F Error removing lock key ${a}:`,t)}}),console.log("\u2705 Interceptor: Locks limpiados")}catch(e){console.warn("\u274C Interceptor: Error limpiando locks:",e)}}static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275prov=w({token:o,factory:o.\u0275fac})}}return o})();var vn=(()=>{class o{constructor(){this.DEFAULT_TIMEOUT=3e4,this.MAX_RETRIES=2,this.RETRY_DELAY=2e3}intercept(e,a){let t=this.getTimeoutForRequest(e);return a.handle(e).pipe($e(t),Ye(s=>s.pipe(qe((l,p)=>{if(this.shouldRetry(l,p)){let g=this.RETRY_DELAY*Math.pow(2,p);return console.log(`\u{1F504} Reintentando request despu\xE9s de timeout (intento ${p+1}/${this.MAX_RETRIES}) en ${g}ms`),console.log(`\u{1F4CD} URL: ${e.url}`),He(g)}return de(()=>l)}))),Ze(s=>{if(s.name==="TimeoutError"){let l=new Le({error:{message:"La solicitud ha tardado demasiado tiempo. Por favor, verifica tu conexi\xF3n a internet.",code:"TIMEOUT_ERROR",originalError:s},status:0,statusText:"Timeout",url:e.url||void 0});return de(()=>l)}if(s.status===0&&s.error instanceof ProgressEvent){console.error("\u274C Error de conexi\xF3n:",{url:e.url,error:s.message});let l=new Le({error:{message:"No se pudo conectar con el servidor. Verifica tu conexi\xF3n a internet.",code:"CONNECTION_ERROR",originalError:s},status:0,statusText:"Connection Error",url:e.url||void 0});return de(()=>l)}return de(()=>s)}))}getTimeoutForRequest(e){let a=e.url.toLowerCase();return a.includes("/auth/")||a.includes("supabase.co/auth/")?45e3:e.method==="POST"&&(a.includes("/storage/")||a.includes("upload"))?6e4:this.DEFAULT_TIMEOUT}shouldRetry(e,a){return a>=this.MAX_RETRIES?!1:e.name==="TimeoutError"||e.status===0&&e.error instanceof ProgressEvent||e.status>=500&&e.status<600}static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275prov=w({token:o,factory:o.\u0275fac})}}return o})();var bn={providers:[ft(pn),mn(),mt(gt()),rn(),hn("ngsw-worker.js",{enabled:!rt(),registrationStrategy:"registerWhenStable:30000"}),{provide:je,useClass:vn,multi:!0},{provide:je,useClass:fn,multi:!0}]};function oa(o,d){o&1&&(i(0,"div",4)(1,"div",5),x(2,"div",6),i(3,"p"),r(4,"Verificando autenticaci\xF3n..."),n()()())}function ra(o,d){o&1&&(i(0,"a",33)(1,"div",15)(2,"mat-icon"),r(3,"build"),n(),i(4,"span"),r(5,"Crear Reportes"),n()()())}function sa(o,d){o&1&&(i(0,"a",34)(1,"div",15)(2,"mat-icon"),r(3,"inventory"),n(),i(4,"span"),r(5,"Administraci\xF3n de Partidas"),n()()())}function da(o,d){o&1&&(i(0,"a",35)(1,"div",15)(2,"mat-icon"),r(3,"business"),n(),i(4,"span"),r(5,"Obras"),n()()())}function ca(o,d){o&1&&(i(0,"a",36)(1,"div",15)(2,"mat-icon"),r(3,"group"),n(),i(4,"span"),r(5,"Gesti\xF3n de Usuarios"),n()()())}function la(o,d){if(o&1){let e=ee();i(0,"div",7)(1,"aside",8)(2,"div",9)(3,"div",10)(4,"mat-icon",11),r(5,"construction"),n(),i(6,"span",12),r(7,"SGR Obras viales"),n()()(),i(8,"nav",13)(9,"a",14)(10,"div",15)(11,"mat-icon"),r(12,"dashboard"),n(),i(13,"span"),r(14,"Dashboard"),n()()(),i(15,"a",16)(16,"div",15)(17,"mat-icon"),r(18,"assignment"),n(),i(19,"span"),r(20,"Actividades"),n()()(),i(21,"a",17)(22,"div",15)(23,"mat-icon"),r(24,"map"),n(),i(25,"span"),r(26,"Mapa"),n()()(),i(27,"a",18)(28,"div",15)(29,"mat-icon"),r(30,"assessment"),n(),i(31,"span"),r(32,"Evaluaciones"),n()()(),i(33,"a",19)(34,"div",15)(35,"mat-icon"),r(36,"analytics"),n(),i(37,"span"),r(38,"KPIs"),n()()(),i(39,"a",20)(40,"div",15)(41,"mat-icon"),r(42,"description"),n(),i(43,"span"),r(44,"Reportes"),n()()(),O(45,ra,6,0,"a",21)(46,sa,6,0,"a",22)(47,da,6,0,"a",23)(48,ca,6,0,"a",24),n(),i(49,"div",25)(50,"div",26)(51,"mat-icon"),r(52,"person"),n(),i(53,"div",27)(54,"span",28),r(55),n(),i(56,"span",29),r(57),n()()(),i(58,"button",30),D("click",function(){B(e);let t=S();return G(t.logout())}),i(59,"mat-icon"),r(60,"logout"),n()()()(),i(61,"div",31)(62,"main",32),x(63,"router-outlet"),n()()()}if(o&2){let e=S();c(45),u("ngIf",(e.currentProfile==null?null:e.currentProfile.rol)==="residente"),c(),u("ngIf",(e.currentProfile==null?null:e.currentProfile.rol)==="residente"),c(),u("ngIf",(e.currentProfile==null?null:e.currentProfile.rol)==="residente"),c(),u("ngIf",(e.currentProfile==null?null:e.currentProfile.rol)==="residente"),c(7),E((e.currentProfile==null?null:e.currentProfile.nombre)||(e.currentUser==null?null:e.currentUser.nombre)||"Usuario"),c(2),E((e.currentProfile==null?null:e.currentProfile.rol)||"Sin rol")}}function pa(o,d){o&1&&(i(0,"div",37),x(1,"router-outlet"),n())}var Cn=(()=>{class o{constructor(e,a,t,s){this.directAuthService=e,this.router=a,this.cdr=t,this.ngZone=s,this.title="Sistema de Gesti\xF3n de Rendimiento en Construcci\xF3n de Carreteras",this.isAuthenticated=!1,this.isInitialized=!1,this.currentUser=null,this.currentProfile=null}ngOnInit(){this.ngZone.run(()=>{this.updateAuthState()}),setTimeout(()=>{this.ngZone.run(()=>{this.isInitialized=!0,this.cdr.detectChanges()})},300),this.checkProfileUpdates()}updateAuthState(){this.isAuthenticated=this.directAuthService.isAuthenticated(),this.currentUser=this.directAuthService.getCurrentUser(),this.currentProfile=this.directAuthService.getCurrentProfile(),console.log("\u{1F504} AppComponent - Estado actualizado:",{authenticated:this.isAuthenticated,user:this.currentUser?.email,profile:this.currentProfile?.rol}),this.cdr.detectChanges()}checkProfileUpdates(){let e=setInterval(()=>{let a=this.directAuthService.getCurrentProfile();a&&(!this.currentProfile||a.rol!==this.currentProfile?.rol)&&(console.log("\u2705 AppComponent - Perfil actualizado detectado"),this.ngZone.run(()=>{this.updateAuthState()}),clearInterval(e))},1e3);setTimeout(()=>{clearInterval(e)},3e4)}getCurrentDate(){let e=new Date,a={weekday:"long",year:"numeric",month:"long",day:"numeric"};return e.toLocaleDateString("es-ES",a)}logout(){return f(this,null,function*(){try{yield this.directAuthService.logout(),this.isAuthenticated=!1,this.currentUser=null,this.currentProfile=null,this.router.navigate(["/login"]),this.cdr.detectChanges()}catch(e){console.error("Error durante logout:",e)}})}static{this.\u0275fac=function(a){return new(a||o)(P(A),P(H),P(ae),P(T))}}static{this.\u0275cmp=W({type:o,selectors:[["app-root"]],decls:4,vars:3,consts:[[1,"app-container"],["class","loading-layout",4,"ngIf"],["class","authenticated-layout",4,"ngIf"],["class","unauthenticated-layout",4,"ngIf"],[1,"loading-layout"],[1,"loading-container"],[1,"loading-spinner"],[1,"authenticated-layout"],[1,"sidebar"],[1,"sidebar-header"],[1,"logo"],[1,"logo-icon"],[1,"logo-text"],[1,"sidebar-nav"],["routerLink","/dashboard","routerLinkActive","active",1,"nav-item"],[1,"nav-link"],["routerLink","/actividades","routerLinkActive","active",1,"nav-item"],["routerLink","/mapa","routerLinkActive","active",1,"nav-item"],["routerLink","/evaluaciones","routerLinkActive","active",1,"nav-item"],["routerLink","/kpis","routerLinkActive","active",1,"nav-item"],["routerLink","/reportes","routerLinkActive","active",1,"nav-item"],["routerLink","/main","class","nav-item","routerLinkActive","active",4,"ngIf"],["routerLink","/partidas","class","nav-item","routerLinkActive","active",4,"ngIf"],["routerLink","/obras","class","nav-item","routerLinkActive","active",4,"ngIf"],["routerLink","/usuarios","class","nav-item","routerLinkActive","active",4,"ngIf"],[1,"sidebar-footer"],[1,"user-info"],[1,"user-details"],[1,"user-name"],[1,"user-role"],["mat-icon-button","","matTooltip","Cerrar sesi\xF3n",1,"logout-btn",3,"click"],[1,"main-content"],[1,"page-content"],["routerLink","/main","routerLinkActive","active",1,"nav-item"],["routerLink","/partidas","routerLinkActive","active",1,"nav-item"],["routerLink","/obras","routerLinkActive","active",1,"nav-item"],["routerLink","/usuarios","routerLinkActive","active",1,"nav-item"],[1,"unauthenticated-layout"]],template:function(a,t){a&1&&(i(0,"div",0),O(1,oa,5,0,"div",1)(2,la,64,6,"div",2)(3,pa,2,0,"div",3),n()),a&2&&(c(),u("ngIf",!t.isInitialized),c(),u("ngIf",t.isInitialized&&t.isAuthenticated),c(),u("ngIf",t.isInitialized&&!t.isAuthenticated))},dependencies:[$,V,ut,xe,ht,Y,q,Z,oe,ke,we],styles:['.app-container[_ngcontent-%COMP%]{display:flex;height:100vh;background-color:#fafafa;overflow:hidden}.loading-layout[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:linear-gradient(135deg,#2d9596,#1a6b6c)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;color:#fff}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500;margin:0}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(255,255,255,.3);border-top:4px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.authenticated-layout[_ngcontent-%COMP%]{display:flex;width:100%;height:100%}.unauthenticated-layout[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:linear-gradient(135deg,#2d9596,#1a6b6c)}.sidebar[_ngcontent-%COMP%]{width:280px;background:#fff;display:flex;flex-direction:column;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;z-index:1000;position:relative;border-right:1px solid #e5e7eb}.sidebar-header[_ngcontent-%COMP%]{padding:24px 20px;border-bottom:1px solid #e5e7eb}.sidebar-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.sidebar-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   .logo-icon[_ngcontent-%COMP%]{color:#1e3a8a;font-size:28px;background:#dbeafe;border-radius:12px}.sidebar-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   .logo-text[_ngcontent-%COMP%]{color:#1e3a8a;font-size:1.25rem;font-weight:600;letter-spacing:-.025em}.sidebar-nav[_ngcontent-%COMP%]{flex:1;padding:20px 16px;overflow-y:auto}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{display:block;margin-bottom:8px;border-radius:12px;text-decoration:none;transition:all .3s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px 20px;color:#374151;font-weight:500;font-size:.95rem;line-height:1.4;min-height:56px;border:none;background:none;width:100%;text-align:left;cursor:pointer}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px;width:22px;height:22px;transition:transform .3s ease}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{transition:transform .3s ease}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]:hover{background:#dbeafe;transform:translate(4px);box-shadow:0 2px 8px #0000001a}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]:hover   .nav-link[_ngcontent-%COMP%]{color:#1e3a8a}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]:hover   .nav-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(1.1)}.sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]:hover   .nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{transform:translate(2px)}.sidebar-nav[_ngcontent-%COMP%]   .nav-item.active[_ngcontent-%COMP%]{background:#1e3a8a;box-shadow:0 4px 12px #1e3a8a26}.sidebar-nav[_ngcontent-%COMP%]   .nav-item.active[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#fff;font-weight:600}.sidebar-nav[_ngcontent-%COMP%]   .nav-item.active[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;width:4px;height:100%;background:#1e3a8a;border-radius:0 4px 4px 0;box-shadow:0 0 8px #1e3a8a80}.sidebar-footer[_ngcontent-%COMP%]{padding:20px;border-top:1px solid #e5e7eb}.sidebar-footer[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.sidebar-footer[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#1e3a8a;font-size:32px;width:32px;height:32px}.sidebar-footer[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:space-between}.sidebar-footer[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500;font-size:.9rem}.sidebar-footer[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .logout-btn[_ngcontent-%COMP%]{color:#6b7280}.sidebar-footer[_ngcontent-%COMP%]   .user-profile[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .logout-btn[_ngcontent-%COMP%]:hover{color:#1e3a8a;background:#dbeafe}.main-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#fff}.main-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #E5E7EB;padding:24px 32px}.main-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;max-width:1400px;margin:0 auto;width:100%}.main-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;color:#2c3e50;margin:0 0 4px;letter-spacing:-.025em}.main-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .page-subtitle[_ngcontent-%COMP%]{color:#6b7280;font-size:.95rem;margin:0;font-weight:400}.main-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]{background:#1e3a8a!important;color:#fff!important;border-radius:12px;padding:12px 24px;font-weight:600;font-size:.9rem;letter-spacing:.025em;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f;transition:all .2s ease}.main-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}.main-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]:hover{background:#1e40af!important;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d}.page-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:32px;background:#fafafa}@media (max-width: 1024px){.sidebar[_ngcontent-%COMP%]{width:240px}.main-header[_ngcontent-%COMP%]{padding:20px 24px}.main-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-size:1.5rem}.page-content[_ngcontent-%COMP%]{padding:24px}}@media (max-width: 900px){.sidebar[_ngcontent-%COMP%]{width:180px}.main-content[_ngcontent-%COMP%]{margin-left:180px}.page-header[_ngcontent-%COMP%]{padding:10px 14px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.page-content[_ngcontent-%COMP%]{padding:14px}}@media (max-width: 768px){.app-container[_ngcontent-%COMP%]{flex-direction:column}.sidebar[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;width:100%;height:auto;z-index:1000;box-shadow:0 -2px 8px #0000001a;background:#fff}.sidebar[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%], .sidebar[_ngcontent-%COMP%]   .sidebar-footer[_ngcontent-%COMP%]{display:none}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:8px 4px;background:#fff;border-top:1px solid #E5E7EB;min-height:64px;margin:0}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1;margin:0;border-radius:12px;transition:all .3s cubic-bezier(.4,0,.2,1);transform:none;position:relative;overflow:hidden}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]:hover{background:#dbeafe;transform:none;box-shadow:0 2px 8px #1e3a8a33}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item.active[_ngcontent-%COMP%]{background:#dbeafe;box-shadow:0 4px 12px #1e3a8a40}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item.active[_ngcontent-%COMP%]:before{display:none}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item.active[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:50%;transform:translate(-50%);width:24px;height:3px;background:#1e3a8a;border-radius:0 0 4px 4px;box-shadow:0 2px 4px #1e3a8a80}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item.active[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:600}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{flex-direction:column;font-size:.75rem;min-height:56px;padding:12px 8px;gap:6px;color:#6b7280;text-align:center;transition:all .3s ease}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px;width:22px;height:22px;margin:0;transition:transform .3s ease}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7rem;line-height:1.2;max-width:60px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:500}.main-content[_ngcontent-%COMP%]{margin-left:0;padding-bottom:80px}.page-header[_ngcontent-%COMP%]{padding:12px 16px;background:#fff;border-bottom:1px solid #E5E7EB;position:sticky;top:0;z-index:100}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.375rem;margin:0}.page-content[_ngcontent-%COMP%]{padding:16px}}@media (max-width: 480px){.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]{padding:6px 2px;min-height:60px}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{min-height:52px;padding:10px 6px;gap:4px;transition:all .3s ease}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;transition:transform .3s ease}.sidebar[_ngcontent-%COMP%]   .sidebar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.65rem;max-width:50px;font-weight:500;line-height:1.2}.main-content[_ngcontent-%COMP%]{padding-bottom:74px}.main-header[_ngcontent-%COMP%]{padding:12px 16px}.main-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-size:1.125rem}.main-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .page-subtitle[_ngcontent-%COMP%]{font-size:.8rem}.page-content[_ngcontent-%COMP%]{padding:12px}}']})}}return o})();pt(Cn,bn).catch(o=>{});
