import{a as $}from"./chunk-6E7IQQWE.js";import{a as Z}from"./chunk-NXOYKD4N.js";import{a as U,b as z,d as R,e as j,f as B,g as G}from"./chunk-XUW3P5LX.js";import{a as T,b as N}from"./chunk-ZJYJPMQY.js";import{b as O,c as E}from"./chunk-5ME2OED7.js";import{F as y,G as I,b as M,g as C,h as _,l as v,m as b,n as L,q as S,v as x,w as F,x as k,y as D}from"./chunk-GGGSXGOB.js";import{p as h,ra as w,sa as P,ta as V,ua as A}from"./chunk-MD4YSZKI.js";import{Db as u,Mb as o,Nb as i,Ob as g,Wb as s,db as p,gc as n,ib as c,pb as f}from"./chunk-OYRL5FJJ.js";import{g as H}from"./chunk-ODN5LVDJ.js";var r=H(Z());var st=(()=>{class d{constructor(e,t,a,l,m){this.fb=e,this.mapService=t,this.snackBar=a,this.dialogRef=l,this.data=m,this.map=null,this.marker=null,this.coordinatesForm=this.fb.group({lat:[m.currentLat||-12.0464],lng:[m.currentLng||-77.0428],direccion:[""]})}ngOnInit(){this.setupLeafletIcons()}ngAfterViewInit(){setTimeout(()=>{this.initializeMap()},100)}ngOnDestroy(){this.map&&this.map.remove()}setupLeafletIcons(){let l=r.icon({iconRetinaUrl:"assets/marker-icon-2x.png",iconUrl:"assets/marker-icon.png",shadowUrl:"assets/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});r.Marker.prototype.options.icon=l}initializeMap(){let e=this.coordinatesForm.get("lat")?.value||-12.0464,t=this.coordinatesForm.get("lng")?.value||-77.0428;this.map=r.map("location-map").setView([e,t],15),r.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map),e&&t&&this.addMarker(e,t),this.map.on("click",a=>{let{lat:l,lng:m}=a.latlng;this.updateLocation(l,m)})}addMarker(e,t){this.map&&(this.marker&&this.map.removeLayer(this.marker),this.marker=r.marker([e,t]).addTo(this.map).bindPopup(`Ubicaci\xF3n seleccionada<br>Lat: ${e.toFixed(6)}<br>Lng: ${t.toFixed(6)}`))}updateLocation(e,t){this.coordinatesForm.patchValue({lat:e,lng:t}),this.addMarker(e,t)}onCoordinatesChange(){let e=this.coordinatesForm.get("lat")?.value,t=this.coordinatesForm.get("lng")?.value;e&&t&&this.isValidCoordinates(e,t)&&(this.addMarker(e,t),this.map&&this.map.setView([e,t],this.map.getZoom()))}isValidCoordinates(e,t){return e>=-90&&e<=90&&t>=-180&&t<=180}isValidLocation(){let e=this.coordinatesForm.get("lat")?.value,t=this.coordinatesForm.get("lng")?.value;return e&&t&&this.isValidCoordinates(e,t)}onCancel(){this.dialogRef.close()}onConfirm(){if(this.isValidLocation()){let e={lat:this.coordinatesForm.get("lat")?.value,lng:this.coordinatesForm.get("lng")?.value,direccion:this.coordinatesForm.get("direccion")?.value||""};this.dialogRef.close(e)}}static{this.\u0275fac=function(t){return new(t||d)(c(x),c($),c(T),c(U),c(z))}}static{this.\u0275cmp=f({type:d,selectors:[["app-location-selector-dialog"]],decls:36,vars:2,consts:[[1,"location-selector-dialog"],["mat-dialog-title",""],[1,"coordinates-form"],[1,"coordinates-inputs",3,"formGroup"],["appearance","outline"],["matInput","","type","number","formControlName","lat","step","0.000001",3,"input"],["matInput","","type","number","formControlName","lng","step","0.000001",3,"input"],["appearance","outline",1,"full-width"],["matInput","","formControlName","direccion"],[1,"map-container"],["id","location-map",1,"map"],[1,"instructions"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(t,a){t&1&&(o(0,"div",0)(1,"h2",1)(2,"mat-icon"),n(3,"location_on"),i(),n(4," Seleccionar Ubicaci\xF3n "),i(),o(5,"mat-dialog-content")(6,"div",2)(7,"form",3)(8,"mat-form-field",4)(9,"mat-label"),n(10,"Latitud"),i(),o(11,"input",5),s("input",function(){return a.onCoordinatesChange()}),i()(),o(12,"mat-form-field",4)(13,"mat-label"),n(14,"Longitud"),i(),o(15,"input",6),s("input",function(){return a.onCoordinatesChange()}),i()(),o(16,"mat-form-field",7)(17,"mat-label"),n(18,"Direcci\xF3n (opcional)"),i(),g(19,"input",8),i()()(),o(20,"div",9),g(21,"div",10),i(),o(22,"div",11)(23,"mat-icon"),n(24,"info"),i(),o(25,"span"),n(26,"Haz clic en el mapa para seleccionar una ubicaci\xF3n o ingresa las coordenadas manualmente"),i()()(),o(27,"mat-dialog-actions",12)(28,"button",13),s("click",function(){return a.onCancel()}),o(29,"mat-icon"),n(30,"cancel"),i(),n(31," Cancelar "),i(),o(32,"button",14),s("click",function(){return a.onConfirm()}),o(33,"mat-icon"),n(34,"check"),i(),n(35," Confirmar Ubicaci\xF3n "),i()()()),t&2&&(p(7),u("formGroup",a.coordinatesForm),p(25),u("disabled",!a.isValidLocation()))},dependencies:[h,F,v,M,b,C,_,k,L,S,G,R,B,j,P,w,A,V,I,y,D,E,O,N],styles:[".location-selector-dialog[_ngcontent-%COMP%]{width:100%;height:100%}mat-dialog-content[_ngcontent-%COMP%]{padding:0;margin:0;display:flex;flex-direction:column;height:70vh;min-height:500px}.coordinates-form[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #e0e0e0}.coordinates-inputs[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start}.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.map-container[_ngcontent-%COMP%]{flex:1;position:relative}.map[_ngcontent-%COMP%]{width:100%;height:100%;min-height:400px}.instructions[_ngcontent-%COMP%]{padding:12px 16px;background:#f5f5f5;display:flex;align-items:center;gap:8px;font-size:.9rem;color:#666}.instructions[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#1976d2;font-size:18px}h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0}@media (max-width: 768px){.coordinates-inputs[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return d})();export{st as a};
