import{a as D}from"./chunk-J5RBWAYA.js";import{a as vt}from"./chunk-YGZXOJW2.js";import{a as v,b as Ot,c as S,d as Mt,e as xt}from"./chunk-YW6TRTLG.js";import{a as st,b as dt,c as ct,d as mt,e as pt,f as ft,g as _t,h as bt,i as ut,j as gt,k as ht,l as Ct}from"./chunk-GRKQO4VX.js";import{a as at,b as it}from"./chunk-7ORSVDA5.js";import{c as H,g as L}from"./chunk-NB3HFZVT.js";import{a as N,b as $,c as j,f as Q,h as A}from"./chunk-Q7IKAR2H.js";import"./chunk-UZ4WZDEA.js";import"./chunk-FPI72KVE.js";import"./chunk-S62OKC6W.js";import{c as rt,g as lt}from"./chunk-XUW3P5LX.js";import"./chunk-4WQTEZOQ.js";import"./chunk-T4G463S7.js";import"./chunk-TXLZEOAT.js";import"./chunk-ZBAF6PQQ.js";import"./chunk-4SALBWPR.js";import"./chunk-SGFNFZY3.js";import{a as nt,b as ot}from"./chunk-ZJYJPMQY.js";import{b as K,c as W}from"./chunk-5ME2OED7.js";import{C as G,F as J,G as U,y as q}from"./chunk-GGGSXGOB.js";import{h as R,j as z,n as B,p as V,pa as X,ra as Y,sa as Z,ta as tt,ua as et}from"./chunk-MD4YSZKI.js";import{Db as m,Mb as i,Nb as n,Ob as h,Pb as p,Qb as f,Sb as k,Wb as _,Xb as b,ac as w,bc as y,cc as E,db as s,gc as r,hc as M,ib as g,ic as x,pa as C,pb as P,qa as O,qc as F,tc as T,vb as c,vc as I}from"./chunk-OYRL5FJJ.js";import"./chunk-X5YLR3NI.js";import{i as u}from"./chunk-ODN5LVDJ.js";var wt=()=>[5,10,20];function yt(e,l){e&1&&(i(0,"div",10),h(1,"mat-spinner",11),i(2,"p"),r(3,"Cargando obras..."),n()())}function Et(e,l){e&1&&(i(0,"th",26),r(1,"Nombre"),n())}function Tt(e,l){if(e&1&&(i(0,"td",27),r(1),n()),e&2){let t=l.$implicit;s(),M(t.nombre)}}function It(e,l){e&1&&(i(0,"th",26),r(1,"Ubicaci\xF3n"),n())}function Dt(e,l){if(e&1&&(i(0,"td",27),r(1),n()),e&2){let t=l.$implicit;s(),M(t.ubicacion)}}function Pt(e,l){e&1&&(i(0,"th",26),r(1,"Estado"),n())}function kt(e,l){if(e&1&&(i(0,"td",27)(1,"span",28),r(2),n()()),e&2){let t=l.$implicit,a=b(2);s(),m("ngClass","estado-"+t.estado),s(),x(" ",a.getEstadoLabel(t.estado)," ")}}function Ft(e,l){e&1&&(i(0,"th",26),r(1,"Fecha Inicio"),n())}function Rt(e,l){if(e&1&&(i(0,"td",27),r(1),T(2,"date"),n()),e&2){let t=l.$implicit;s(),x(" ",I(2,1,t.fecha_inicio,"dd/MM/yyyy")," ")}}function zt(e,l){e&1&&(i(0,"th",26),r(1,"Fecha Fin Estimada"),n())}function Bt(e,l){if(e&1&&(i(0,"td",27),r(1),T(2,"date"),n()),e&2){let t=l.$implicit;s(),x(" ",t.fecha_fin_estimada?I(2,1,t.fecha_fin_estimada,"dd/MM/yyyy"):"No definida"," ")}}function Vt(e,l){e&1&&(i(0,"th",29),r(1,"Acciones"),n())}function Ht(e,l){if(e&1){let t=k();i(0,"td",27)(1,"button",30),_("click",function(){let o=C(t).$implicit,d=b(2);return O(d.editObra(o))}),i(2,"mat-icon"),r(3,"edit"),n()(),i(4,"button",31),_("click",function(){let o=C(t).$implicit,d=b(2);return O(d.viewObra(o))}),i(5,"mat-icon"),r(6,"visibility"),n()(),i(7,"button",32),_("click",function(){let o=C(t).$implicit,d=b(2);return O(d.deleteObra(o))}),i(8,"mat-icon"),r(9,"delete"),n()()()}}function Lt(e,l){e&1&&h(0,"tr",33)}function Nt(e,l){e&1&&h(0,"tr",34)}function $t(e,l){e&1&&(i(0,"div",35)(1,"mat-icon"),r(2,"info"),n(),i(3,"p"),r(4,"No se encontraron obras"),n()())}function jt(e,l){if(e&1&&(i(0,"div",12)(1,"table",13),p(2,14),c(3,Et,2,0,"th",15)(4,Tt,2,1,"td",16),f(),p(5,17),c(6,It,2,0,"th",15)(7,Dt,2,1,"td",16),f(),p(8,18),c(9,Pt,2,0,"th",15)(10,kt,3,2,"td",16),f(),p(11,19),c(12,Ft,2,0,"th",15)(13,Rt,3,4,"td",16),f(),p(14,20),c(15,zt,2,0,"th",15)(16,Bt,3,4,"td",16),f(),p(17,21),c(18,Vt,2,0,"th",22)(19,Ht,10,0,"td",16),f(),c(20,Lt,1,0,"tr",23)(21,Nt,1,0,"tr",24),n(),c(22,$t,5,0,"div",25),n()),e&2){let t=b();s(),m("dataSource",t.dataSource),s(19),m("matHeaderRowDef",t.displayedColumns),s(),m("matRowDefColumns",t.displayedColumns),s(),m("ngIf",t.dataSource.data.length===0)}}function Qt(e,l){e&1&&h(0,"mat-paginator",36),e&2&&m("pageSizeOptions",F(1,wt))}var Ce=(()=>{class e{constructor(t,a,o,d){this.obrasService=t,this.dialog=a,this.snackBar=o,this.router=d,this.displayedColumns=["nombre","ubicacion","estado","fecha_inicio","fecha_fin_estimada","acciones"],this.dataSource=new Ct([]),this.loading=!1,console.log("\u{1F3D7}\uFE0F ObrasComponent: Constructor ejecutado")}ngOnInit(){console.log("ObrasComponent ngOnInit called"),this.loadObras()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}loadObras(){return u(this,null,function*(){console.log("\u{1F504} ObrasComponent: Iniciando carga de obras"),this.loading=!0;try{console.log("\u{1F50D} ObrasComponent: Llamando a obrasService.getAllObras()");let t=yield this.obrasService.getAllObras();console.log("\u{1F4CB} ObrasComponent: Obras recibidas:",t),console.log("\u{1F4CA} ObrasComponent: N\xFAmero de obras:",t?t.length:0),(!t||t.length===0)&&console.warn("\u26A0\uFE0F ObrasComponent: No se encontraron obras"),this.dataSource.data=t||[],console.log("\u2705 ObrasComponent: DataSource actualizado con",this.dataSource.data.length,"obras")}catch(t){console.error("\u274C Error loading obras:",t),console.error("\u274C Error details:",JSON.stringify(t,null,2))}finally{this.loading=!1,console.log("\u{1F3C1} ObrasComponent: Carga de obras finalizada")}})}applyFilter(t){let a=t.target.value;this.dataSource.filter=a.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}openCreateDialog(){this.dialog.open(D,{width:"600px",data:{mode:"create"}}).afterClosed().subscribe(a=>{a&&a.data&&this.createObra(a.data)})}editObra(t){this.dialog.open(D,{width:"600px",data:{mode:"edit",obra:t}}).afterClosed().subscribe(o=>{o&&o.data&&o.mode==="edit"&&this.updateObra(t.id,o.data)})}viewObra(t){this.router.navigate(["/obras",t.id])}createObra(t){return u(this,null,function*(){try{(yield this.obrasService.createObra(t))?(this.showMessage("Obra creada exitosamente"),this.loadObras()):this.showMessage("Error al crear la obra")}catch(a){console.error("Error creating obra:",a),this.showMessage("Error al crear la obra")}})}updateObra(t,a){return u(this,null,function*(){try{(yield this.obrasService.updateObra(t,a))?(this.showMessage("Obra actualizada exitosamente"),this.loadObras()):this.showMessage("Error al actualizar la obra")}catch(o){console.error("Error updating obra:",o),this.showMessage("Error al actualizar la obra")}})}deleteObra(t){return u(this,null,function*(){if(confirm(`\xBFEst\xE1 seguro de que desea eliminar la obra "${t.nombre}"?`))try{(yield this.obrasService.deleteObra(t.id))?(this.showMessage("Obra eliminada exitosamente"),this.loadObras()):this.showMessage("Error al eliminar la obra")}catch(a){console.error("Error deleting obra:",a),this.showMessage("Error al eliminar la obra")}})}getEstadoLabel(t){return{planificacion:"Planificaci\xF3n",activa:"Activa",suspendida:"Suspendida",finalizada:"Finalizada"}[t]||t}showMessage(t){this.snackBar.open(t,"Cerrar",{duration:3e3,horizontalPosition:"right",verticalPosition:"top"})}logComponentLoaded(){return console.log("\u{1F3AF} ObrasComponent: Template renderizado"),""}static{this.\u0275fac=function(a){return new(a||e)(g(vt),g(rt),g(nt),g(H))}}static{this.\u0275cmp=P({type:e,selectors:[["app-obras"]],viewQuery:function(a,o){if(a&1&&(w(v,5),w(S,5)),a&2){let d;y(d=E())&&(o.paginator=d.first),y(d=E())&&(o.sort=d.first)}},decls:22,vars:4,consts:[[1,"obras-container"],[2,"display","none"],[1,"header-content"],["mat-raised-button","","color","primary",3,"click"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Buscar por nombre, ubicaci\xF3n o contratista...",3,"keyup"],["matSuffix",""],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],["showFirstLastButtons","",3,"pageSizeOptions",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"table-container"],["mat-table","","matSort","",1,"obras-table",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","ubicacion"],["matColumnDef","estado"],["matColumnDef","fecha_inicio"],["matColumnDef","fecha_fin_estimada"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","no-data",4,"ngIf"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"estado-badge",3,"ngClass"],["mat-header-cell",""],["mat-icon-button","","matTooltip","Editar obra",3,"click"],["mat-icon-button","","matTooltip","Ver detalles",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar obra",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"],["showFirstLastButtons","",3,"pageSizeOptions"]],template:function(a,o){a&1&&(i(0,"div",0)(1,"div",1),r(2),n(),i(3,"mat-card")(4,"mat-card-header")(5,"div",2)(6,"mat-card-title"),r(7,"Gesti\xF3n de Obras"),n(),i(8,"button",3),_("click",function(){return o.openCreateDialog()}),i(9,"mat-icon"),r(10,"add"),n(),r(11," Nueva Obra "),n()()(),i(12,"mat-card-content")(13,"mat-form-field",4)(14,"mat-label"),r(15,"Buscar obras"),n(),i(16,"input",5),_("keyup",function(St){return o.applyFilter(St)}),n(),i(17,"mat-icon",6),r(18,"search"),n()(),c(19,yt,4,0,"div",7)(20,jt,23,4,"div",8)(21,Qt,1,2,"mat-paginator",9),n()()()),a&2&&(s(2),M(o.logComponentLoaded()),s(17),m("ngIf",o.loading),s(),m("ngIf",!o.loading),s(),m("ngIf",!o.loading&&o.dataSource.data.length>0))},dependencies:[V,R,z,B,A,N,j,Q,$,Z,Y,X,et,tt,ht,st,ct,_t,mt,dt,bt,pt,ft,ut,gt,Ot,v,xt,S,Mt,U,J,q,G,W,K,it,at,ot,lt,L],styles:[".obras-container[_ngcontent-%COMP%]{padding:20px;max-width:1400px;margin:0 auto}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.search-field[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:40px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.obras-table[_ngcontent-%COMP%]{width:100%}.estado-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.estado-planificacion[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.estado-activa[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.estado-finalizada[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#388e3c}.estado-suspendida[_ngcontent-%COMP%]{background-color:#fce4ec;color:#c2185b}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:40px;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}"]})}}return e})();export{Ce as ObrasComponent};
