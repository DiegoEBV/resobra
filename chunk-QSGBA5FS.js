import{a as U,b as Tt,c as P,d as kt,e as It}from"./chunk-XE6RDNXY.js";import{a as ht,b as Mt,c as xt,d as vt,e as St,f as bt,g as Et,h as wt,i as yt,j as Ut,k as Pt,l as Ot}from"./chunk-WNWKSLW4.js";import{a as Dt}from"./chunk-AIW24H5D.js";import{c as pt,g as ft}from"./chunk-JUW7GNWS.js";import"./chunk-MS4AQ6UA.js";import{a as gt,b as Ct}from"./chunk-DMZJ7K26.js";import{c as _t}from"./chunk-7BCONPA6.js";import{a as lt,c as ct,d as mt}from"./chunk-ZBUPANVT.js";import"./chunk-F5X5MWHG.js";import{a as dt,b as ut}from"./chunk-WI2E4B7N.js";import"./chunk-GOBT7UBB.js";import{a as rt,b as st}from"./chunk-AZ2U4T3U.js";import"./chunk-SGYCFQGT.js";import"./chunk-2GVF4P32.js";import{a as nt,b as ot}from"./chunk-YC5WDUOT.js";import{c as L}from"./chunk-YMTLAEZG.js";import"./chunk-G7YPFBNB.js";import{a as $,c as j,h as N}from"./chunk-SNSQLCH6.js";import{b as X,c as Y}from"./chunk-BXKJ5BTH.js";import"./chunk-3RK6DDJD.js";import{C as G,F as J,G as K,b as A,g as q,k as H,w as W,y as Q}from"./chunk-UJ3DDJ5Q.js";import{j as z,p as B,sa as Z,ua as tt,va as et,wa as it,xa as at}from"./chunk-4WMI5X77.js";import{Db as m,Fb as F,Gb as O,Nb as e,Ob as i,Pb as S,Qb as h,Rb as M,Tb as T,Xb as u,Yb as f,bc as k,cc as I,db as s,dc as D,hc as o,ib as v,ic as _,jc as b,mc as E,nc as w,oc as y,pa as g,pb as R,qa as C,rc as V,vb as p}from"./chunk-B6672ACT.js";import"./chunk-X5YLR3NI.js";import{i as x}from"./chunk-ODN5LVDJ.js";var Rt=()=>[5,10,25,50];function Ft(n,c){if(n&1&&(e(0,"div",33)(1,"mat-card",34)(2,"mat-card-content")(3,"div",35),o(4),i(),e(5,"div",36),o(6,"Total"),i()()(),e(7,"mat-card",34)(8,"mat-card-content")(9,"div",35),o(10),i(),e(11,"div",36),o(12,"Activos"),i()()(),e(13,"mat-card",34)(14,"mat-card-content")(15,"div",35),o(16),i(),e(17,"div",36),o(18,"Residentes"),i()()()()),n&2){let t=f();s(4),_(t.estadisticas.total),s(6),_(t.estadisticas.activos),s(6),_(t.estadisticas.residentes)}}function Vt(n,c){n&1&&(e(0,"mat-header-cell",37),o(1,"Usuario"),i())}function zt(n,c){if(n&1&&(e(0,"mat-cell")(1,"div",38)(2,"div",39),o(3),i(),e(4,"div",40)(5,"div",41),o(6),i(),e(7,"div",42),o(8),i()()()()),n&2){let t=c.$implicit,r=f();s(3),b(" ",r.getInitials(t.nombre)," "),s(3),_(t.nombre),s(2),_(t.email)}}function Bt(n,c){n&1&&(e(0,"mat-header-cell",37),o(1,"Rol"),i())}function Lt(n,c){if(n&1&&(e(0,"mat-cell")(1,"mat-chip-set")(2,"mat-chip"),o(3),i()()()),n&2){let t=c.$implicit,r=f();s(2),O("chip-"+t.rol),s(),b(" ",r.getRolLabel(t.rol)," ")}}function At(n,c){n&1&&(e(0,"mat-header-cell",37),o(1,"Estado"),i())}function qt(n,c){if(n&1&&(e(0,"mat-cell")(1,"mat-chip-set")(2,"mat-chip"),o(3),i()()()),n&2){let t=c.$implicit;s(2),O(t.activo!==!1?"chip-activo":"chip-inactivo"),s(),b(" ",t.activo!==!1?"Activo":"Inactivo"," ")}}function Ht(n,c){n&1&&(e(0,"mat-header-cell",37),o(1,"Creado"),i())}function Wt(n,c){if(n&1&&(e(0,"mat-cell"),o(1),i()),n&2){let t=c.$implicit,r=f();s(),b(" ",r.formatDate(t.created_at)," ")}}function $t(n,c){n&1&&(e(0,"mat-header-cell"),o(1,"Acciones"),i())}function jt(n,c){if(n&1){let t=T();e(0,"mat-cell")(1,"div",43)(2,"button",44),u("click",function(){let a=g(t).$implicit,l=f();return C(l.editarUsuario(a))}),e(3,"mat-icon"),o(4,"edit"),i()(),e(5,"button",45),u("click",function(){let a=g(t).$implicit,l=f();return C(l.toggleEstadoUsuario(a))}),e(6,"mat-icon"),o(7),i()(),e(8,"button",46),u("click",function(){let a=g(t).$implicit,l=f();return C(l.cambiarPassword(a))}),e(9,"mat-icon"),o(10,"lock_reset"),i()(),e(11,"button",47),u("click",function(){let a=g(t).$implicit,l=f();return C(l.eliminarUsuario(a))}),e(12,"mat-icon"),o(13,"delete"),i()()()()}if(n&2){let t=c.$implicit;s(5),m("matTooltip",t.activo!==!1?"Desactivar usuario":"Activar usuario")("color",t.activo!==!1?"warn":"primary"),s(2),_(t.activo!==!1?"block":"check_circle")}}function Nt(n,c){n&1&&S(0,"mat-header-row")}function Qt(n,c){n&1&&S(0,"mat-row")}function Gt(n,c){n&1&&(e(0,"div",48),S(1,"mat-spinner",49),e(2,"p"),o(3,"Cargando usuarios..."),i()())}function Jt(n,c){if(n&1){let t=T();e(0,"div",50)(1,"mat-icon"),o(2,"people_outline"),i(),e(3,"h3"),o(4,"No se encontraron usuarios"),i(),e(5,"p"),o(6,"No hay usuarios que coincidan con los filtros aplicados."),i(),e(7,"button",51),u("click",function(){g(t);let a=f();return C(a.crearUsuario())}),e(8,"mat-icon"),o(9,"add"),i(),o(10," Crear primer usuario "),i()()}}function Kt(n,c){n&1&&S(0,"mat-paginator",52),n&2&&m("pageSizeOptions",V(2,Rt))("pageSize",10)}var Ie=(()=>{class n{constructor(t,r,a,l){this.usuariosService=t,this.router=r,this.dialog=a,this.snackBar=l,this.displayedColumns=["nombre","rol","activo","created_at","acciones"],this.dataSource=new Ot([]),this.cargando=!1,this.filtros={busqueda:"",rol:"todos",activo:null},this.estadisticas=null}ngOnInit(){this.cargarUsuarios(),this.cargarEstadisticas()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}cargarUsuarios(){return x(this,null,function*(){try{this.cargando=!0;let t=yield this.usuariosService.getUsuarios(this.filtros);this.dataSource.data=t}catch(t){console.error("Error al cargar usuarios:",t),this.mostrarError("Error al cargar la lista de usuarios")}finally{this.cargando=!1}})}cargarEstadisticas(){return x(this,null,function*(){try{this.estadisticas=yield this.usuariosService.getEstadisticasUsuarios()}catch(t){console.error("Error al cargar estad\xEDsticas:",t)}})}aplicarFiltros(){clearTimeout(this.filtroTimeout),this.filtroTimeout=setTimeout(()=>{this.cargarUsuarios()},300)}crearUsuario(){this.router.navigate(["/usuarios/crear"])}editarUsuario(t){this.router.navigate(["/usuarios/editar",t.id])}toggleEstadoUsuario(t){return x(this,null,function*(){try{let r=t.activo!==!1?"desactivar":"activar";if(!confirm(`\xBFEst\xE1 seguro que desea ${r} al usuario ${t.nombre}?`))return;yield this.usuariosService.toggleUsuarioActivo(t.id),this.mostrarExito(`Usuario ${r}do exitosamente`),yield this.cargarUsuarios(),yield this.cargarEstadisticas()}catch(r){console.error("Error al cambiar estado del usuario:",r),this.mostrarError("Error al cambiar el estado del usuario")}})}cambiarPassword(t){let r=prompt(`Ingrese la nueva contrase\xF1a para ${t.nombre}:`);r&&this.usuariosService.cambiarPassword(t.id,r).then(()=>{this.mostrarExito("Contrase\xF1a cambiada exitosamente")}).catch(a=>{console.error("Error al cambiar contrase\xF1a:",a),this.mostrarError("Error al cambiar la contrase\xF1a")})}eliminarUsuario(t){return x(this,null,function*(){if(confirm(`\xBFEst\xE1 seguro que desea eliminar al usuario ${t.nombre}?

Esta acci\xF3n no se puede deshacer.`))try{yield this.usuariosService.deleteUsuario(t.id),this.mostrarExito("Usuario eliminado exitosamente"),yield this.cargarUsuarios(),yield this.cargarEstadisticas()}catch(a){console.error("Error al eliminar usuario:",a),this.mostrarError("Error al eliminar el usuario")}})}getInitials(t){return t.split(" ").map(r=>r.charAt(0)).join("").toUpperCase().substring(0,2)}getRolLabel(t){return{residente:"Residente",logistica:"Log\xEDstica"}[t]||t}formatDate(t){return t?new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}mostrarExito(t){this.snackBar.open(t,"Cerrar",{duration:3e3,panelClass:["success-snackbar"]})}mostrarError(t){this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(r){return new(r||n)(v(Dt),v(L),v(pt),v(rt))}}static{this.\u0275cmp=R({type:n,selectors:[["app-usuarios"]],viewQuery:function(r,a){if(r&1&&(k(U,5),k(P,5)),r&2){let l;I(l=D())&&(a.paginator=l.first),I(l=D())&&(a.sort=l.first)}},decls:66,vars:17,consts:[[1,"usuarios-container"],[1,"header-section"],["class","stats-cards",4,"ngIf"],[1,"filters-card"],[1,"filters-row"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Nombre o email...",3,"ngModelChange","input","ngModel"],["matSuffix",""],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],["value","todos"],["value","residente"],["value","logistica"],[3,"value"],[1,"actions-section"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-icon-button","","matTooltip","Actualizar",3,"click","disabled"],[1,"table-card"],[1,"table-container"],["matSort","",1,"usuarios-table",3,"dataSource"],["matColumnDef","nombre"],["mat-sort-header","",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","rol"],["matColumnDef","activo"],["matColumnDef","created_at"],["matColumnDef","acciones"],[4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["class","loading-spinner",4,"ngIf"],["class","no-data",4,"ngIf"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize",4,"ngIf"],[1,"stats-cards"],[1,"stat-card"],[1,"stat-number"],[1,"stat-label"],["mat-sort-header",""],[1,"user-info"],[1,"user-avatar"],[1,"user-details"],[1,"user-name"],[1,"user-email"],[1,"actions-buttons"],["mat-icon-button","","matTooltip","Editar usuario",3,"click"],["mat-icon-button","",3,"click","matTooltip","color"],["mat-icon-button","","matTooltip","Cambiar contrase\xF1a",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar usuario",3,"click"],[1,"loading-spinner"],["diameter","50"],[1,"no-data"],["mat-raised-button","","color","primary",3,"click"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"]],template:function(r,a){r&1&&(e(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Gesti\xF3n de Usuarios"),i(),p(4,Ft,19,3,"div",2),i(),e(5,"mat-card",3)(6,"mat-card-content")(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),o(10,"Buscar usuarios"),i(),e(11,"input",6),y("ngModelChange",function(d){return w(a.filtros.busqueda,d)||(a.filtros.busqueda=d),d}),u("input",function(){return a.aplicarFiltros()}),i(),e(12,"mat-icon",7),o(13,"search"),i()(),e(14,"mat-form-field",8)(15,"mat-label"),o(16,"Rol"),i(),e(17,"mat-select",9),y("ngModelChange",function(d){return w(a.filtros.rol,d)||(a.filtros.rol=d),d}),u("selectionChange",function(){return a.aplicarFiltros()}),e(18,"mat-option",10),o(19,"Todos los roles"),i(),e(20,"mat-option",11),o(21,"Residente"),i(),e(22,"mat-option",12),o(23,"Log\xEDstica"),i()()(),e(24,"mat-form-field",8)(25,"mat-label"),o(26,"Estado"),i(),e(27,"mat-select",9),y("ngModelChange",function(d){return w(a.filtros.activo,d)||(a.filtros.activo=d),d}),u("selectionChange",function(){return a.aplicarFiltros()}),e(28,"mat-option",13),o(29,"Todos"),i(),e(30,"mat-option",13),o(31,"Activos"),i(),e(32,"mat-option",13),o(33,"Inactivos"),i()()(),e(34,"div",14)(35,"button",15),u("click",function(){return a.crearUsuario()}),e(36,"mat-icon"),o(37,"add"),i(),o(38," Nuevo Usuario "),i(),e(39,"button",16),u("click",function(){return a.cargarUsuarios()}),e(40,"mat-icon"),o(41,"refresh"),i()()()()()(),e(42,"mat-card",17)(43,"mat-card-content")(44,"div",18)(45,"mat-table",19),h(46,20),p(47,Vt,2,0,"mat-header-cell",21)(48,zt,9,3,"mat-cell",22),M(),h(49,23),p(50,Bt,2,0,"mat-header-cell",21)(51,Lt,4,3,"mat-cell",22),M(),h(52,24),p(53,At,2,0,"mat-header-cell",21)(54,qt,4,3,"mat-cell",22),M(),h(55,25),p(56,Ht,2,0,"mat-header-cell",21)(57,Wt,2,1,"mat-cell",22),M(),h(58,26),p(59,$t,2,0,"mat-header-cell",27)(60,jt,14,3,"mat-cell",22),M(),p(61,Nt,1,0,"mat-header-row",28)(62,Qt,1,0,"mat-row",29),i(),p(63,Gt,4,0,"div",30)(64,Jt,11,0,"div",31),i(),p(65,Kt,1,3,"mat-paginator",32),i()()()),r&2&&(s(4),m("ngIf",a.estadisticas),s(7),E("ngModel",a.filtros.busqueda),s(6),E("ngModel",a.filtros.rol),s(10),E("ngModel",a.filtros.activo),s(),m("value",null),s(2),m("value",!0),s(2),m("value",!1),s(3),m("disabled",a.cargando),s(4),m("disabled",a.cargando),s(6),F("loading",a.cargando),m("dataSource",a.dataSource),s(16),m("matHeaderRowDef",a.displayedColumns),s(),m("matRowDefColumns",a.displayedColumns),s(),m("ngIf",a.cargando),s(),m("ngIf",!a.cargando&&a.dataSource.data.length===0),s(),m("ngIf",!a.cargando&&a.dataSource.data.length>0))},dependencies:[B,z,W,A,q,H,N,$,j,et,tt,Z,at,it,Pt,ht,xt,Et,vt,Mt,wt,St,bt,yt,Ut,Tt,U,It,P,kt,Y,X,J,Q,G,K,Ct,gt,_t,mt,lt,ct,ft,st,ot,nt,ut,dt],styles:[".usuarios-container[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto}.header-section[_ngcontent-%COMP%]{margin-bottom:24px}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 16px;font-size:2rem;font-weight:500;color:#333}.stats-cards[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:8px}.stat-card[_ngcontent-%COMP%]{min-width:120px;text-align:center}.stat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px!important}.stat-number[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#1976d2}.stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:#666;margin-top:4px}.filters-card[_ngcontent-%COMP%]{margin-bottom:24px}.filters-row[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;flex-wrap:wrap}.search-field[_ngcontent-%COMP%]{flex:1;min-width:250px}.actions-section[_ngcontent-%COMP%]{display:flex;gap:8px;margin-left:auto}.table-card[_ngcontent-%COMP%]{overflow:hidden}.table-container[_ngcontent-%COMP%]{position:relative;min-height:400px}.usuarios-table[_ngcontent-%COMP%]{width:100%}.usuarios-table.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.user-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:14px}.user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{font-weight:500;color:#333}.user-email[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.chip-residente[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.chip-logistica[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.chip-activo[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#2e7d32}.chip-inactivo[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828}.actions-buttons[_ngcontent-%COMP%]{display:flex;gap:4px}.loading-spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}.loading-spinner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.no-data[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px;opacity:.5}.no-data[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-weight:500}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 24px;font-size:.875rem}@media (max-width: 768px){.usuarios-container[_ngcontent-%COMP%]{padding:16px}.stats-cards[_ngcontent-%COMP%]{flex-direction:column}.filters-row[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.actions-section[_ngcontent-%COMP%]{margin-left:0;justify-content:center}.search-field[_ngcontent-%COMP%]{min-width:auto}}"]})}}return n})();export{Ie as UsuariosComponent};
