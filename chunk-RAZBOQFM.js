import{a as vt}from"./chunk-OEJNJFL5.js";import{a as I}from"./chunk-C7WGTOZS.js";import{a as v,b as Mt,c as S,d as xt,e as Ot}from"./chunk-XE6RDNXY.js";import{a as dt,b as st,c as mt,d as ct,e as pt,f as ft,g as _t,h as ut,i as bt,j as ht,k as gt,l as Ct}from"./chunk-WNWKSLW4.js";import"./chunk-EPNA6SYW.js";import"./chunk-ZLVJQ2UH.js";import"./chunk-SXXER37Y.js";import{c as rt,g as lt}from"./chunk-JUW7GNWS.js";import"./chunk-DMZJ7K26.js";import"./chunk-7BCONPA6.js";import"./chunk-WI2E4B7N.js";import"./chunk-CSWWTQFU.js";import"./chunk-GOBT7UBB.js";import{a as nt,b as ot}from"./chunk-AZ2U4T3U.js";import"./chunk-SGYCFQGT.js";import"./chunk-2GVF4P32.js";import"./chunk-WFXXN3GR.js";import{a as it,b as at}from"./chunk-YC5WDUOT.js";import{c as H,g as $}from"./chunk-YMTLAEZG.js";import"./chunk-G7YPFBNB.js";import{a as L,b as j,c as N,f as Q,h as A}from"./chunk-SNSQLCH6.js";import{b as K,c as W}from"./chunk-BXKJ5BTH.js";import"./chunk-3RK6DDJD.js";import{C as G,F as U,G as J,y as q}from"./chunk-UJ3DDJ5Q.js";import{h as R,j as B,n as z,p as V,sa as X,ua as Y,va as Z,wa as tt,xa as et}from"./chunk-4WMI5X77.js";import{Db as c,Nb as i,Ob as n,Pb as g,Qb as p,Rb as f,Tb as k,Xb as _,Yb as u,bc as w,cc as y,db as d,dc as E,hc as r,ib as h,ic as x,jc as O,pa as C,pb as P,qa as M,rc as F,uc as T,vb as m,wc as D}from"./chunk-B6672ACT.js";import"./chunk-X5YLR3NI.js";import{i as b}from"./chunk-ODN5LVDJ.js";var wt=()=>[5,10,20];function yt(e,l){e&1&&(i(0,"div",10),g(1,"mat-spinner",11),i(2,"p"),r(3,"Cargando obras..."),n()())}function Et(e,l){e&1&&(i(0,"th",26),r(1,"Nombre"),n())}function Tt(e,l){if(e&1&&(i(0,"td",27),r(1),n()),e&2){let t=l.$implicit;d(),x(t.nombre)}}function Dt(e,l){e&1&&(i(0,"th",26),r(1,"Ubicaci\xF3n"),n())}function It(e,l){if(e&1&&(i(0,"td",27),r(1),n()),e&2){let t=l.$implicit;d(),x(t.ubicacion)}}function Pt(e,l){e&1&&(i(0,"th",26),r(1,"Estado"),n())}function kt(e,l){if(e&1&&(i(0,"td",27)(1,"span",28),r(2),n()()),e&2){let t=l.$implicit,a=u(2);d(),c("ngClass","estado-"+t.estado),d(),O(" ",a.getEstadoLabel(t.estado)," ")}}function Ft(e,l){e&1&&(i(0,"th",26),r(1,"Fecha Inicio"),n())}function Rt(e,l){if(e&1&&(i(0,"td",27),r(1),T(2,"date"),n()),e&2){let t=l.$implicit;d(),O(" ",D(2,1,t.fecha_inicio,"dd/MM/yyyy")," ")}}function Bt(e,l){e&1&&(i(0,"th",26),r(1,"Fecha Fin Estimada"),n())}function zt(e,l){if(e&1&&(i(0,"td",27),r(1),T(2,"date"),n()),e&2){let t=l.$implicit;d(),O(" ",t.fecha_fin_estimada?D(2,1,t.fecha_fin_estimada,"dd/MM/yyyy"):"No definida"," ")}}function Vt(e,l){e&1&&(i(0,"th",29),r(1,"Acciones"),n())}function Ht(e,l){if(e&1){let t=k();i(0,"td",27)(1,"button",30),_("click",function(){let o=C(t).$implicit,s=u(2);return M(s.editObra(o))}),i(2,"mat-icon"),r(3,"edit"),n()(),i(4,"button",31),_("click",function(){let o=C(t).$implicit,s=u(2);return M(s.viewObra(o))}),i(5,"mat-icon"),r(6,"visibility"),n()(),i(7,"button",32),_("click",function(){let o=C(t).$implicit,s=u(2);return M(s.deleteObra(o))}),i(8,"mat-icon"),r(9,"delete"),n()()()}}function $t(e,l){e&1&&g(0,"tr",33)}function Lt(e,l){e&1&&g(0,"tr",34)}function jt(e,l){e&1&&(i(0,"div",35)(1,"mat-icon"),r(2,"info"),n(),i(3,"p"),r(4,"No se encontraron obras"),n()())}function Nt(e,l){if(e&1&&(i(0,"div",12)(1,"table",13),p(2,14),m(3,Et,2,0,"th",15)(4,Tt,2,1,"td",16),f(),p(5,17),m(6,Dt,2,0,"th",15)(7,It,2,1,"td",16),f(),p(8,18),m(9,Pt,2,0,"th",15)(10,kt,3,2,"td",16),f(),p(11,19),m(12,Ft,2,0,"th",15)(13,Rt,3,4,"td",16),f(),p(14,20),m(15,Bt,2,0,"th",15)(16,zt,3,4,"td",16),f(),p(17,21),m(18,Vt,2,0,"th",22)(19,Ht,10,0,"td",16),f(),m(20,$t,1,0,"tr",23)(21,Lt,1,0,"tr",24),n(),m(22,jt,5,0,"div",25),n()),e&2){let t=u();d(),c("dataSource",t.dataSource),d(19),c("matHeaderRowDef",t.displayedColumns),d(),c("matRowDefColumns",t.displayedColumns),d(),c("ngIf",t.dataSource.data.length===0)}}function Qt(e,l){e&1&&g(0,"mat-paginator",36),e&2&&c("pageSizeOptions",F(1,wt))}var Ce=(()=>{class e{constructor(t,a,o,s){this.obrasService=t,this.dialog=a,this.snackBar=o,this.router=s,this.displayedColumns=["nombre","ubicacion","estado","fecha_inicio","fecha_fin_estimada","acciones"],this.dataSource=new Ct([]),this.loading=!1}ngOnInit(){this.loadObras()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}loadObras(){return b(this,null,function*(){this.loading=!0;try{let t=yield this.obrasService.getAllObras();!t||t.length,this.dataSource.data=t||[]}catch{}finally{this.loading=!1}})}applyFilter(t){let a=t.target.value;this.dataSource.filter=a.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}openCreateDialog(){this.dialog.open(I,{width:"600px",data:{mode:"create"}}).afterClosed().subscribe(a=>{a&&a.data&&this.createObra(a.data)})}editObra(t){this.dialog.open(I,{width:"600px",data:{mode:"edit",obra:t}}).afterClosed().subscribe(o=>{o&&o.data&&o.mode==="edit"&&this.updateObra(t.id,o.data)})}viewObra(t){this.router.navigate(["/obras",t.id])}createObra(t){return b(this,null,function*(){try{(yield this.obrasService.createObra(t))?(this.showMessage("Obra creada exitosamente"),this.loadObras()):this.showMessage("Error al crear la obra")}catch{this.showMessage("Error al crear la obra")}})}updateObra(t,a){return b(this,null,function*(){try{(yield this.obrasService.updateObra(t,a))?(this.showMessage("Obra actualizada exitosamente"),this.loadObras()):this.showMessage("Error al actualizar la obra")}catch{this.showMessage("Error al actualizar la obra")}})}deleteObra(t){return b(this,null,function*(){if(confirm(`\xBFEst\xE1 seguro de que desea eliminar la obra "${t.nombre}"?`))try{(yield this.obrasService.deleteObra(t.id))?(this.showMessage("Obra eliminada exitosamente"),this.loadObras()):this.showMessage("Error al eliminar la obra")}catch{this.showMessage("Error al eliminar la obra")}})}getEstadoLabel(t){return{planificacion:"Planificaci\xF3n",activa:"Activa",suspendida:"Suspendida",finalizada:"Finalizada"}[t]||t}showMessage(t){this.snackBar.open(t,"Cerrar",{duration:3e3,horizontalPosition:"right",verticalPosition:"top"})}logComponentLoaded(){return""}static{this.\u0275fac=function(a){return new(a||e)(h(vt),h(rt),h(nt),h(H))}}static{this.\u0275cmp=P({type:e,selectors:[["app-obras"]],viewQuery:function(a,o){if(a&1&&(w(v,5),w(S,5)),a&2){let s;y(s=E())&&(o.paginator=s.first),y(s=E())&&(o.sort=s.first)}},decls:22,vars:4,consts:[[1,"obras-container"],[2,"display","none"],[1,"header-content"],["mat-raised-button","","color","primary",3,"click"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Buscar por nombre, ubicaci\xF3n o contratista...",3,"keyup"],["matSuffix",""],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],["showFirstLastButtons","",3,"pageSizeOptions",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"table-container"],["mat-table","","matSort","",1,"obras-table",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","ubicacion"],["matColumnDef","estado"],["matColumnDef","fecha_inicio"],["matColumnDef","fecha_fin_estimada"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","no-data",4,"ngIf"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"estado-badge",3,"ngClass"],["mat-header-cell",""],["mat-icon-button","","matTooltip","Editar obra",3,"click"],["mat-icon-button","","matTooltip","Ver detalles",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar obra",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"],["showFirstLastButtons","",3,"pageSizeOptions"]],template:function(a,o){a&1&&(i(0,"div",0)(1,"div",1),r(2),n(),i(3,"mat-card")(4,"mat-card-header")(5,"div",2)(6,"mat-card-title"),r(7,"Gesti\xF3n de Obras"),n(),i(8,"button",3),_("click",function(){return o.openCreateDialog()}),i(9,"mat-icon"),r(10,"add"),n(),r(11," Nueva Obra "),n()()(),i(12,"mat-card-content")(13,"mat-form-field",4)(14,"mat-label"),r(15,"Buscar obras"),n(),i(16,"input",5),_("keyup",function(St){return o.applyFilter(St)}),n(),i(17,"mat-icon",6),r(18,"search"),n()(),m(19,yt,4,0,"div",7)(20,Nt,23,4,"div",8)(21,Qt,1,2,"mat-paginator",9),n()()()),a&2&&(d(2),x(o.logComponentLoaded()),d(17),c("ngIf",o.loading),d(),c("ngIf",!o.loading),d(),c("ngIf",!o.loading&&o.dataSource.data.length>0))},dependencies:[V,R,B,z,A,L,N,Q,j,Z,Y,X,et,tt,gt,dt,mt,_t,ct,st,ut,pt,ft,bt,ht,Mt,v,Ot,S,xt,J,U,q,G,W,K,at,it,ot,lt,$],styles:[".obras-container[_ngcontent-%COMP%]{padding:20px;max-width:1400px;margin:0 auto}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.search-field[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:40px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.obras-table[_ngcontent-%COMP%]{width:100%}.estado-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.estado-planificacion[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.estado-activa[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.estado-finalizada[_ngcontent-%COMP%]{background-color:#e8f5e8;color:#388e3c}.estado-suspendida[_ngcontent-%COMP%]{background-color:#fce4ec;color:#c2185b}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:40px;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}"]})}}return e})();export{Ce as ObrasComponent};
