import{a as d}from"./chunk-GOBT7UBB.js";import{a as f}from"./chunk-WFXXN3GR.js";import{E as h,ba as l,g as n,ga as o,j as b,q as u}from"./chunk-B6672ACT.js";import{i as a}from"./chunk-ODN5LVDJ.js";var g=(()=>{class s{constructor(t,r){this.supabase=t,this.directAuthService=r,this.obrasSubject=new n([]),this.obras$=this.obrasSubject.asObservable(),this.loadObras()}loadObras(){return a(this,null,function*(){try{let t=this.directAuthService.getCurrentUser();if(!t){this.obrasSubject.next([]);return}let{data:r,error:e}=yield this.supabase.client.from("user_obras").select("obra_id").eq("user_id",t.id);if(e)throw e;if(!r||r.length===0){this.obrasSubject.next([]);return}let i=r.map(m=>m.obra_id),{data:p,error:c}=yield this.supabase.client.from("obras").select("*").in("id",i).order("nombre");if(c)throw c;this.obrasSubject.next(p||[])}catch{this.obrasSubject.next([])}})}getObraById(t){return b(this.supabase.client.from("obras").select("*").eq("id",t).single()).pipe(u(({data:r,error:e})=>e?null:r),h(r=>[null]))}getAllObras(){return a(this,null,function*(){try{let{data:t,error:r}=yield this.supabase.client.from("obras").select("*").order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(t){throw t}})}createObra(t){return a(this,null,function*(){try{let{data:r,error:e}=yield this.supabase.client.from("obras").insert([t]).select().single();if(e)throw e;return yield this.loadObras(),r}catch{return null}})}updateObra(t,r){return a(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.client.from("obras").update(r).eq("id",t).select().single();if(i)throw i;return yield this.loadObras(),e}catch{return null}})}deleteObra(t){return a(this,null,function*(){try{let{error:r}=yield this.supabase.client.from("obras").delete().eq("id",t);if(r)throw r;return yield this.loadObras(),!0}catch{return!1}})}static{this.\u0275fac=function(r){return new(r||s)(o(f),o(d))}}static{this.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{g as a};
